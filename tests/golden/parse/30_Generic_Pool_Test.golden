Module {modName = "GenericPoolTest", modExports = [ExposeValue "main"], modImports = [Import {impName = "Lune.IO", impAs = Just "IO", impExposing = Nothing},Import {impName = "Lune.Task", impAs = Just "Task", impExposing = Nothing},Import {impName = "Lune.Prelude", impAs = Nothing, impExposing = Just [ExposeType "Result" ExposeAll,ExposeType "Unit" ExposeOpaque,ExposeType "Maybe" ExposeAll]},Import {impName = "Lune.Database.Postgres.Pool", impAs = Just "Pool", impExposing = Nothing},Import {impName = "Lune.Database.Postgres.Query", impAs = Just "Query", impExposing = Nothing},Import {impName = "Lune.Database.Postgres.Connection", impAs = Just "Conn", impExposing = Nothing},Import {impName = "Lune.Json.Encode", impAs = Just "Encode", impExposing = Nothing}], modDecls = [DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeApp (TypeCon "Task") (TypeCon "Unit")) (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "=== Generic Pool Test ===")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Creating pool with max 5 connections...")),BindStmt (PVar "pool") (App (FieldAccess (Var "Task") "fromIO") (App (FieldAccess (Var "Pool") "createPool") (RecordLiteral [("host",StringLit "localhost"),("port",IntLit 5432),("database",StringLit "postgres"),("user",StringLit "postgres"),("password",Var "Nothing"),("maxConnections",IntLit 5)]))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Pool created successfully!")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Using connection from pool to query SELECT 1...")),BindStmt (PVar "result") (App (FieldAccess (Var "Task") "fromIO") (App (App (FieldAccess (Var "Pool") "withConnection") (Var "pool")) (Lam [PVar "conn"] (App (App (FieldAccess (Var "Query") "query") (Var "conn")) (StringLit "SELECT 1"))))),ExprStmt (Case (Var "result") [Alt (PCon "Err" [PVar "e"]) (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Encode") "encode") (IntLit 0)) (App (FieldAccess (Var "Conn") "errorEncoder") (Var "e"))))]),Alt (PCon "Ok" [PVar "rows"]) (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Query successful!")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Result:")),ExprStmt (App (FieldAccess (Var "IO") "println") (App (FieldAccess (Var "Query") "debugRows") (Var "rows")))])]),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Destroying pool...")),ExprStmt (App (FieldAccess (Var "Task") "fromIO") (App (FieldAccess (Var "Pool") "destroyPool") (Var "pool"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Done!"))])]}
