Module {modName = "STMExample", modExports = [ExposeValue "main"], modImports = [Import {impName = "Lune.Prelude", impAs = Nothing, impExposing = Just [ExposeType "Unit" ExposeOpaque,ExposeValue "unit",ExposeType "Int" ExposeOpaque,ExposeType "String" ExposeOpaque,ExposeType "IO" ExposeOpaque,ExposeValue "putStrLn",ExposeValue "sleepMs",ExposeValue "addInt",ExposeValue "appendString",ExposeValue "showInt",ExposeType "Fiber" ExposeOpaque,ExposeValue "spawn",ExposeValue "yield",ExposeType "STM" ExposeOpaque,ExposeType "TVar" ExposeOpaque,ExposeValue "atomically",ExposeValue "newTVar",ExposeValue "readTVar",ExposeValue "writeTVar"]}], modDecls = [DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [BindStmt (PVar "tv") (App (Var "atomically") (App (Var "newTVar") (IntLit 0))),DiscardBindStmt (App (Var "spawn") (App (Var "loop") (Var "tv"))),DiscardBindStmt (App (Var "spawn") (App (Var "loop") (Var "tv"))),DiscardBindStmt (App (Var "sleepMs") (IntLit 1000)),BindStmt (PVar "n") (App (Var "atomically") (App (Var "readTVar") (Var "tv"))),ExprStmt (App (Var "putStrLn") (App (App (Var "appendString") (StringLit "counter=")) (App (Var "showInt") (Var "n"))))]),DeclTypeSig "loop" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeCon "TVar") (TypeCon "Int")) (TypeApp (TypeCon "IO") (TypeCon "Unit"))}),DeclValue "loop" [PVar "tv"] (DoBlock [DiscardBindStmt (App (Var "atomically") (DoBlock [BindStmt (PVar "n") (App (Var "readTVar") (Var "tv")),DiscardBindStmt (App (App (Var "writeTVar") (Var "tv")) (App (App (Var "addInt") (Var "n")) (IntLit 1))),ExprStmt (App (Var "pure") (Var "unit"))])),DiscardBindStmt (Var "yield"),ExprStmt (App (Var "loop") (Var "tv"))])]}
