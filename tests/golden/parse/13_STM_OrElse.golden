Module {modName = "STMOrElse", modExports = [ExposeValue "main"], modImports = [Import {impName = "Lune.IO", impAs = Just "IO", impExposing = Nothing},Import {impName = "Lune.Atomic", impAs = Just "Atomic", impExposing = Nothing},Import {impName = "Lune.String", impAs = Just "Str", impExposing = Nothing},Import {impName = "Lune.Int", impAs = Just "Int", impExposing = Nothing},Import {impName = "Lune.Prelude", impAs = Nothing, impExposing = Just [ExposeType "Shared" ExposeOpaque,ExposeType "Atomic" ExposeOpaque]}], modDecls = [DeclTypeSig "tryFirst" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeCon "Shared") (TypeCon "Int")) (TypeApp (TypeCon "Atomic") (TypeCon "Unit"))}),DeclValue "tryFirst" [PVar "tv"] (DoBlock [BindStmt (PVar "n") (App (FieldAccess (Var "Atomic") "read") (Var "tv")),ExprStmt (Case (App (App (FieldAccess (Var "Int") "eq") (Var "n")) (IntLit 0)) [Alt (PCon "True" []) (FieldAccess (Var "Atomic") "wait"),Alt (PCon "False" []) (App (App (FieldAccess (Var "Atomic") "write") (Var "tv")) (IntLit 100))])]),DeclTypeSig "trySecond" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeCon "Shared") (TypeCon "Int")) (TypeApp (TypeCon "Atomic") (TypeCon "Unit"))}),DeclValue "trySecond" [PVar "tv"] (App (App (FieldAccess (Var "Atomic") "write") (Var "tv")) (IntLit 42)),DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeApp (TypeCon "Task") (TypeCon "Unit")) (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Testing orElse:")),BindStmt (PVar "tv") (App (FieldAccess (Var "Atomic") "commit") (App (FieldAccess (Var "Atomic") "new") (IntLit 0))),DiscardBindStmt (App (FieldAccess (Var "Atomic") "commit") (App (App (FieldAccess (Var "Atomic") "orElse") (App (Var "tryFirst") (Var "tv"))) (App (Var "trySecond") (Var "tv")))),BindStmt (PVar "final") (App (FieldAccess (Var "Atomic") "commit") (App (FieldAccess (Var "Atomic") "read") (Var "tv"))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Final value: ")) (App (FieldAccess (Var "Str") "fromInt") (Var "final"))))])]}
