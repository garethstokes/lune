Module {modName = "Main", modExports = [ExposeValue "main"], modImports = [Import {impName = "Lune.IO", impAs = Just "IO", impExposing = Nothing},Import {impName = "Lune.List", impAs = Just "List", impExposing = Nothing},Import {impName = "Lune.String", impAs = Just "Str", impExposing = Nothing},Import {impName = "Lune.Task", impAs = Just "Task", impExposing = Nothing},Import {impName = "Lune.System", impAs = Just "System", impExposing = Just [ExposeType "Error" ExposeAll,ExposeType "OS" ExposeAll]}], modDecls = [DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeApp (TypeCon "Task") (TypeCon "Unit")) (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [BindStmt (PVar "r1") (App (FieldAccess (Var "Task") "result") (FieldAccess (Var "System") "sample")),ExprStmt (Case (Var "r1") [Alt (PCon "Err" [PVar "e"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "sample error: ")) (App (Var "errorToString") (Var "e")))),Alt (PCon "Ok" [PVar "s1"]) (DoBlock [DiscardBindStmt (App (FieldAccess (Var "IO") "sleepMs") (IntLit 500)),BindStmt (PVar "r2") (App (FieldAccess (Var "Task") "result") (FieldAccess (Var "System") "sample")),ExprStmt (Case (Var "r2") [Alt (PCon "Err" [PVar "e"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "sample error: ")) (App (Var "errorToString") (Var "e")))),Alt (PCon "Ok" [PVar "s2"]) (DoBlock [LetStmt "d" (App (App (FieldAccess (Var "System") "diff") (Var "s1")) (Var "s2")),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "dt_ms=")) (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (Var "d") "dtMs")))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "cpu_usage_percent=")) (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (FieldAccess (Var "d") "cpu") "usagePercent")))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "net_rx_bytes_per_sec=")) (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (FieldAccess (Var "d") "net") "rxBytesPerSec")))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "net_tx_bytes_per_sec=")) (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (FieldAccess (Var "d") "net") "txBytesPerSec")))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "disk_read_bytes_per_sec=")) (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (FieldAccess (Var "d") "disk") "readBytesPerSec")))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "disk_write_bytes_per_sec=")) (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (FieldAccess (Var "d") "disk") "writeBytesPerSec")))),ExprStmt (App (Var "printGpuMetrics") (FieldAccess (FieldAccess (Var "d") "gpu") "devices"))])])])])]),DeclTypeSig "errorToString" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "System.Error") (TypeCon "String")}),DeclValue "errorToString" [PVar "err"] (Case (Var "err") [Alt (PCon "NotImplemented" [PVar "os"]) (App (App (FieldAccess (Var "Str") "append") (StringLit "NotImplemented(")) (App (App (FieldAccess (Var "Str") "append") (App (Var "osToString") (Var "os"))) (StringLit ")"))),Alt (PCon "ReadError" [PVar "msg"]) (App (App (FieldAccess (Var "Str") "append") (StringLit "ReadError(")) (App (App (FieldAccess (Var "Str") "append") (Var "msg")) (StringLit ")"))),Alt (PCon "ParseError" [PVar "msg"]) (App (App (FieldAccess (Var "Str") "append") (StringLit "ParseError(")) (App (App (FieldAccess (Var "Str") "append") (Var "msg")) (StringLit ")"))),Alt (PCon "PermissionDenied" [PVar "msg"]) (App (App (FieldAccess (Var "Str") "append") (StringLit "PermissionDenied(")) (App (App (FieldAccess (Var "Str") "append") (Var "msg")) (StringLit ")")))]),DeclTypeSig "osToString" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "System.OS") (TypeCon "String")}),DeclValue "osToString" [PVar "os"] (Case (Var "os") [Alt (PCon "Linux" []) (StringLit "linux"),Alt (PCon "Darwin" []) (StringLit "darwin"),Alt (PCon "Windows" []) (StringLit "windows")]),DeclTypeSig "printGpuMetrics" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeCon "List") (TypeCon "System.GpuDeviceMetrics")) (TypeApp (TypeApp (TypeCon "Task") (TypeCon "Unit")) (TypeCon "Unit"))}),DeclValue "printGpuMetrics" [PVar "devs"] (Case (Var "devs") [Alt (PCon "Nil" []) (App (FieldAccess (Var "IO") "println") (StringLit "gpu_metrics=[]")),Alt PWildcard (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "gpu_metrics=")),ExprStmt (App (Var "printGpuLines") (Var "devs"))])]),DeclTypeSig "printGpuLines" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeCon "List") (TypeCon "System.GpuDeviceMetrics")) (TypeApp (TypeApp (TypeCon "Task") (TypeCon "Unit")) (TypeCon "Unit"))}),DeclValue "printGpuLines" [PVar "devs"] (Case (Var "devs") [Alt (PCon "Nil" []) (App (FieldAccess (Var "Task") "succeed") (Var "unit")),Alt (PCon "Cons" [PVar "d",PVar "rest"]) (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "formatGpuDevice") (Var "d"))),ExprStmt (App (Var "printGpuLines") (Var "rest"))])]),DeclTypeSig "formatGpuDevice" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "System.GpuDeviceMetrics") (TypeCon "String")}),DeclValue "formatGpuDevice" [PVar "d"] (App (App (FieldAccess (Var "Str") "join") (StringLit " ")) (App (App (Var "Cons") (StringLit "gpu")) (App (App (Var "Cons") (App (App (FieldAccess (Var "Str") "append") (StringLit "pci=")) (App (Var "pciToString") (FieldAccess (Var "d") "pci")))) (App (App (Var "Cons") (App (App (FieldAccess (Var "Str") "append") (StringLit "busy_percent=")) (App (App (Var "maybeInt") (StringLit "-")) (FieldAccess (Var "d") "busyPercent")))) (App (App (Var "Cons") (App (App (FieldAccess (Var "Str") "append") (StringLit "temp_c=")) (App (App (Var "maybeFloat") (StringLit "-")) (FieldAccess (Var "d") "tempC")))) (App (App (Var "Cons") (App (App (FieldAccess (Var "Str") "append") (StringLit "power_w=")) (App (App (Var "maybeFloat") (StringLit "-")) (FieldAccess (Var "d") "powerW")))) (Var "Nil"))))))),DeclTypeSig "pciToString" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeCon "Maybe") (TypeCon "System.PciAddress")) (TypeCon "String")}),DeclValue "pciToString" [PVar "mpci"] (Case (Var "mpci") [Alt (PCon "Nothing" []) (StringLit "-"),Alt (PCon "Just" [PVar "p"]) (App (App (FieldAccess (Var "Str") "join") (StringLit ":")) (App (App (Var "Cons") (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (Var "p") "domain"))) (App (App (Var "Cons") (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (Var "p") "bus"))) (App (App (Var "Cons") (App (App (FieldAccess (Var "Str") "append") (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (Var "p") "device"))) (App (App (FieldAccess (Var "Str") "append") (StringLit ".")) (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (Var "p") "function"))))) (Var "Nil")))))]),DeclTypeSig "maybeInt" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "String") (TypeArrow (TypeApp (TypeCon "Maybe") (TypeCon "Int")) (TypeCon "String"))}),DeclValue "maybeInt" [PVar "def",PVar "m"] (Case (Var "m") [Alt (PCon "Nothing" []) (Var "def"),Alt (PCon "Just" [PVar "n"]) (App (FieldAccess (Var "Str") "fromInt") (Var "n"))]),DeclTypeSig "maybeFloat" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "String") (TypeArrow (TypeApp (TypeCon "Maybe") (TypeCon "Float")) (TypeCon "String"))}),DeclValue "maybeFloat" [PVar "def",PVar "m"] (Case (Var "m") [Alt (PCon "Nothing" []) (Var "def"),Alt (PCon "Just" [PVar "f"]) (App (FieldAccess (Var "Str") "fromFloat") (Var "f"))])]}
