Module {modName = "FiberBasic", modExports = [ExposeValue "main"], modImports = [Import {impName = "Lune.IO", impAs = Just "IO", impExposing = Nothing},Import {impName = "Lune.Fiber", impAs = Just "Fiber", impExposing = Nothing},Import {impName = "Lune.String", impAs = Just "Str", impExposing = Nothing}], modDecls = [DeclTypeSig "worker" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "String") (TypeApp (TypeApp (TypeCon "Task") (TypeCon "Unit")) (TypeCon "Unit"))}),DeclValue "worker" [PVar "name"] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (Var "name")) (StringLit " started"))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (Var "name")) (StringLit " finished")))]),DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeApp (TypeCon "Task") (TypeCon "Unit")) (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Main: spawning tasks")),BindStmt (PVar "t1") (App (FieldAccess (Var "Fiber") "spawn") (App (Var "worker") (StringLit "Task1"))),BindStmt (PVar "t2") (App (FieldAccess (Var "Fiber") "spawn") (App (Var "worker") (StringLit "Task2"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Main: yielding to let tasks run")),DiscardBindStmt (FieldAccess (Var "Fiber") "yield"),DiscardBindStmt (FieldAccess (Var "Fiber") "yield"),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Main: awaiting results")),DiscardBindStmt (App (FieldAccess (Var "Fiber") "await") (Var "t1")),DiscardBindStmt (App (FieldAccess (Var "Fiber") "await") (Var "t2")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Main: done"))])]}
