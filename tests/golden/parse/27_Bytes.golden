Module {modName = "BytesExample", modExports = [ExposeValue "main"], modImports = [Import {impName = "Lune.IO", impAs = Just "IO", impExposing = Nothing},Import {impName = "Lune.Prelude", impAs = Nothing, impExposing = Just [ExposeType "IO" ExposeOpaque,ExposeType "Result" ExposeAll,ExposeType "Unit" ExposeOpaque,ExposeType "List" ExposeAll,ExposeType "Int" ExposeOpaque,ExposeType "String" ExposeOpaque]},Import {impName = "Lune.Bytes", impAs = Just "Bytes", impExposing = Just [ExposeType "Bytes" ExposeOpaque]},Import {impName = "Lune.String", impAs = Just "Str", impExposing = Nothing}], modDecls = [DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "=== Bytes Manipulation Example ===")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (Var "demoFromList"),ExprStmt (Var "demoPack32"),ExprStmt (Var "demoPack16"),ExprStmt (Var "demoConcat"),ExprStmt (Var "demoSlice"),ExprStmt (Var "demoWireProtocol")]),DeclTypeSig "demoFromList" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "demoFromList" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Creating bytes from [72, 101, 108, 108, 111] (ASCII 'Hello')")),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Length: ")) (App (FieldAccess (Var "Str") "fromInt") (App (FieldAccess (Var "Bytes") "length") (Var "helloBytes"))))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit ""))]),DeclTypeSig "helloBytes" (QualType {qualConstraints = [], qualType = TypeCon "Bytes"}),DeclValue "helloBytes" [] (App (FieldAccess (Var "Bytes") "fromList") (App (App (Var "Cons") (IntLit 72)) (App (App (Var "Cons") (IntLit 101)) (App (App (Var "Cons") (IntLit 108)) (App (App (Var "Cons") (IntLit 108)) (App (App (Var "Cons") (IntLit 111)) (Var "Nil"))))))),DeclTypeSig "demoPack32" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "demoPack32" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Packing 305419896 (0x12345678) as 4 bytes big-endian")),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Bytes: ")) (App (Var "showIntList") (App (FieldAccess (Var "Bytes") "toList") (Var "packed32"))))),ExprStmt (Case (App (FieldAccess (Var "Bytes") "unpackInt32BE") (Var "packed32")) [Alt (PCon "Ok" [PVar "n"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Unpacked back: ")) (App (FieldAccess (Var "Str") "fromInt") (Var "n")))),Alt (PCon "Err" [PWildcard]) (App (FieldAccess (Var "IO") "println") (StringLit "Error unpacking"))]),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit ""))]),DeclTypeSig "packed32" (QualType {qualConstraints = [], qualType = TypeCon "Bytes"}),DeclValue "packed32" [] (App (FieldAccess (Var "Bytes") "packInt32BE") (IntLit 305419896)),DeclTypeSig "demoPack16" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "demoPack16" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Packing 1000 as 2 bytes big-endian")),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Bytes: ")) (App (Var "showIntList") (App (FieldAccess (Var "Bytes") "toList") (Var "packed16"))))),ExprStmt (Case (App (FieldAccess (Var "Bytes") "unpackInt16BE") (Var "packed16")) [Alt (PCon "Ok" [PVar "n"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Unpacked back: ")) (App (FieldAccess (Var "Str") "fromInt") (Var "n")))),Alt (PCon "Err" [PWildcard]) (App (FieldAccess (Var "IO") "println") (StringLit "Error unpacking"))]),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit ""))]),DeclTypeSig "packed16" (QualType {qualConstraints = [], qualType = TypeCon "Bytes"}),DeclValue "packed16" [] (App (FieldAccess (Var "Bytes") "packInt16BE") (IntLit 1000)),DeclTypeSig "demoConcat" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "demoConcat" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Concatenating 2-byte and 4-byte sequences")),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Total length: ")) (App (FieldAccess (Var "Str") "fromInt") (App (FieldAccess (Var "Bytes") "length") (Var "header"))))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit ""))]),DeclTypeSig "header" (QualType {qualConstraints = [], qualType = TypeCon "Bytes"}),DeclValue "header" [] (App (App (FieldAccess (Var "Bytes") "concat") (Var "packed16")) (Var "packed32")),DeclTypeSig "demoSlice" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "demoSlice" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Slicing bytes 2-6 (the 32-bit portion from header)")),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Slice length: ")) (App (FieldAccess (Var "Str") "fromInt") (App (FieldAccess (Var "Bytes") "length") (Var "sliced"))))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit ""))]),DeclTypeSig "sliced" (QualType {qualConstraints = [], qualType = TypeCon "Bytes"}),DeclValue "sliced" [] (App (App (App (FieldAccess (Var "Bytes") "slice") (IntLit 2)) (IntLit 4)) (Var "header")),DeclTypeSig "demoWireProtocol" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "demoWireProtocol" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "=== Wire Protocol Pattern ===")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "1. Read 1 byte for message type")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "2. Read 4 bytes, unpack as Int32 for length")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "3. Read (length - 4) bytes for payload")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "4. Decode payload based on message type")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Done!"))]),DeclTypeSig "showIntList" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeCon "List") (TypeCon "Int")) (TypeCon "String")}),DeclValue "showIntList" [PVar "xs"] (Case (Var "xs") [Alt (PCon "Nil" []) (StringLit "[]"),Alt (PCon "Cons" [PVar "n",PVar "rest"]) (App (App (FieldAccess (Var "Str") "append") (StringLit "[")) (App (App (Var "showIntListHelper") (Var "n")) (Var "rest")))]),DeclTypeSig "showIntListHelper" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "Int") (TypeArrow (TypeApp (TypeCon "List") (TypeCon "Int")) (TypeCon "String"))}),DeclValue "showIntListHelper" [PVar "n",PVar "rest"] (Case (Var "rest") [Alt (PCon "Nil" []) (App (App (FieldAccess (Var "Str") "append") (App (FieldAccess (Var "Str") "fromInt") (Var "n"))) (StringLit "]")),Alt (PCon "Cons" [PVar "m",PVar "more"]) (App (App (FieldAccess (Var "Str") "append") (App (FieldAccess (Var "Str") "fromInt") (Var "n"))) (App (App (FieldAccess (Var "Str") "append") (StringLit ", ")) (App (App (Var "showIntListHelper") (Var "m")) (Var "more"))))])]}
