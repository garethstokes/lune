Module {modName = "NovaDemo", modExports = [ExposeValue "main"], modImports = [Import {impName = "Lune.IO", impAs = Just "IO", impExposing = Nothing},Import {impName = "Lune.Task", impAs = Just "Task", impExposing = Nothing},Import {impName = "Lune.String", impAs = Just "Str", impExposing = Nothing},Import {impName = "Lune.Json", impAs = Just "RawJson", impExposing = Nothing},Import {impName = "Nova", impAs = Nothing, impExposing = Just [ExposeValue "defaultClient",ExposeValue "withOllamaBaseUrl",ExposeValue "withProvider",ExposeValue "withModel",ExposeValue "openrouter",ExposeValue "ollama",ExposeValue "ask",ExposeValue "json",ExposeValue "tool"]},Import {impName = "Nova.Core", impAs = Nothing, impExposing = Just [ExposeType "Error" ExposeAll]}], modDecls = [DeclTypeSig "toResult" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeApp (TypeCon "Task") (TypeVar "e")) (TypeVar "a")) (TypeApp (TypeApp (TypeCon "Task") (TypeVar "x")) (TypeApp (TypeApp (TypeCon "Result") (TypeVar "e")) (TypeVar "a")))}),DeclValue "toResult" [PVar "task"] (App (App (FieldAccess (Var "Task") "onError") (App (App (FieldAccess (Var "Task") "map") (Var "Ok")) (Var "task"))) (Lam [PVar "e"] (App (FieldAccess (Var "Task") "succeed") (App (Var "Err") (Var "e"))))),DeclTypeSig "showError" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "Error") (TypeCon "String")}),DeclValue "showError" [PVar "e"] (Case (Var "e") [Alt (PCon "NetworkError" [PVar "msg"]) (App (App (FieldAccess (Var "Str") "append") (StringLit "NetworkError ")) (Var "msg")),Alt (PCon "RateLimited" []) (StringLit "RateLimited"),Alt (PCon "Unauthorized" []) (StringLit "Unauthorized"),Alt (PCon "BadRequest" [PVar "msg"]) (App (App (FieldAccess (Var "Str") "append") (StringLit "BadRequest ")) (Var "msg")),Alt (PCon "ProviderError" [PVar "msg"]) (App (App (FieldAccess (Var "Str") "append") (StringLit "ProviderError ")) (Var "msg")),Alt (PCon "DecodeError" [PVar "msg"]) (App (App (FieldAccess (Var "Str") "append") (StringLit "DecodeError ")) (Var "msg"))]),DeclTypeSig "showAskResult" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeApp (TypeCon "Result") (TypeCon "Error")) (TypeCon "String")) (TypeCon "String")}),DeclValue "showAskResult" [PVar "r"] (Case (Var "r") [Alt (PCon "Err" [PVar "e"]) (App (Var "showError") (Var "e")),Alt (PCon "Ok" [PVar "s"]) (Var "s")]),DeclTypeSig "showJsonResult" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeApp (TypeCon "Result") (TypeCon "Error")) (TypeCon "RawJson.Json")) (TypeCon "String")}),DeclValue "showJsonResult" [PVar "r"] (Case (Var "r") [Alt (PCon "Err" [PVar "e"]) (App (Var "showError") (Var "e")),Alt (PCon "Ok" [PVar "j"]) (App (FieldAccess (Var "RawJson") "stringify") (Var "j"))]),DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeApp (TypeCon "Task") (TypeCon "Unit")) (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [LetStmt "baseClient" (App (App (Var "withOllamaBaseUrl") (StringLit "mock://")) (Var "defaultClient")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "routing_openrouter_missing_key:")),LetStmt "openrouterClient" (App (App (Var "|>") (App (App (Var "withProvider") (Var "openrouter")) (Var "baseClient"))) (App (Var "withModel") (StringLit "x"))),BindStmt (PVar "r1") (App (App (Var "|>") (App (App (Var "ask") (Var "openrouterClient")) (StringLit "hi"))) (Var "toResult")),ExprStmt (App (App (Var "<|") (FieldAccess (Var "IO") "println")) (App (Var "showAskResult") (Var "r1"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "routing_ollama_mock:")),LetStmt "pureClient" (App (App (Var "|>") (App (App (Var "withProvider") (Var "ollama")) (Var "baseClient"))) (App (Var "withModel") (StringLit "mock-pure"))),BindStmt (PVar "r2") (App (App (Var "|>") (App (App (Var "ask") (Var "pureClient")) (StringLit "hi"))) (Var "toResult")),ExprStmt (App (App (Var "<|") (FieldAccess (Var "IO") "println")) (App (Var "showAskResult") (Var "r2"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "tool_wrapper_counts:")),LetStmt "toolWrapperClient" (App (App (Var "|>") (App (App (Var "withProvider") (Var "ollama")) (Var "baseClient"))) (App (Var "withModel") (StringLit "mock-tool-wrapper"))),BindStmt (PVar "countsR") (App (App (Var "|>") (App (App (Var "tool") (Var "toolWrapperClient")) (StringLit "user"))) (Var "toResult")),ExprStmt (App (App (Var "<|") (FieldAccess (Var "IO") "println")) (App (Var "showJsonResult") (Var "countsR"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "json_pure:")),BindStmt (PVar "jp") (App (App (Var "|>") (App (App (Var "json") (Var "pureClient")) (StringLit "p"))) (Var "toResult")),ExprStmt (App (App (Var "<|") (FieldAccess (Var "IO") "println")) (App (Var "showJsonResult") (Var "jp"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "tool_pure:")),BindStmt (PVar "tp") (App (App (Var "|>") (App (App (Var "tool") (Var "pureClient")) (StringLit "p"))) (Var "toResult")),ExprStmt (App (App (Var "<|") (FieldAccess (Var "IO") "println")) (App (Var "showJsonResult") (Var "tp"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "json_prose_prefix:")),LetStmt "prosePrefixClient" (App (App (Var "|>") (App (App (Var "withProvider") (Var "ollama")) (Var "baseClient"))) (App (Var "withModel") (StringLit "mock-prose-prefix"))),BindStmt (PVar "jpp") (App (App (Var "|>") (App (App (Var "json") (Var "prosePrefixClient")) (StringLit "p"))) (Var "toResult")),ExprStmt (App (App (Var "<|") (FieldAccess (Var "IO") "println")) (App (Var "showJsonResult") (Var "jpp"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "tool_prose_prefix:")),BindStmt (PVar "tpp") (App (App (Var "|>") (App (App (Var "tool") (Var "prosePrefixClient")) (StringLit "p"))) (Var "toResult")),ExprStmt (App (App (Var "<|") (FieldAccess (Var "IO") "println")) (App (Var "showJsonResult") (Var "tpp"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "json_prose_suffix:")),LetStmt "proseSuffixClient" (App (App (Var "|>") (App (App (Var "withProvider") (Var "ollama")) (Var "baseClient"))) (App (Var "withModel") (StringLit "mock-prose-suffix"))),BindStmt (PVar "jps") (App (App (Var "|>") (App (App (Var "json") (Var "proseSuffixClient")) (StringLit "p"))) (Var "toResult")),ExprStmt (App (App (Var "<|") (FieldAccess (Var "IO") "println")) (App (Var "showJsonResult") (Var "jps"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "tool_prose_suffix:")),BindStmt (PVar "tps") (App (App (Var "|>") (App (App (Var "tool") (Var "proseSuffixClient")) (StringLit "p"))) (Var "toResult")),ExprStmt (App (App (Var "<|") (FieldAccess (Var "IO") "println")) (App (Var "showJsonResult") (Var "tps"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "tool_invalid:")),LetStmt "invalidClient" (App (App (Var "|>") (App (App (Var "withProvider") (Var "ollama")) (Var "baseClient"))) (App (Var "withModel") (StringLit "mock-invalid"))),BindStmt (PVar "ti") (App (App (Var "|>") (App (App (Var "tool") (Var "invalidClient")) (StringLit "p"))) (Var "toResult")),ExprStmt (App (App (Var "<|") (FieldAccess (Var "IO") "println")) (App (Var "showJsonResult") (Var "ti"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "tool_no_json:")),LetStmt "noJsonClient" (App (App (Var "|>") (App (App (Var "withProvider") (Var "ollama")) (Var "baseClient"))) (App (Var "withModel") (StringLit "mock-no-json"))),BindStmt (PVar "tn") (App (App (Var "|>") (App (App (Var "tool") (Var "noJsonClient")) (StringLit "p"))) (Var "toResult")),ExprStmt (App (App (Var "<|") (FieldAccess (Var "IO") "println")) (App (Var "showJsonResult") (Var "tn")))])]}
