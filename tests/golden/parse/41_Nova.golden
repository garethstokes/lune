Module {modName = "NovaDemo", modExports = [ExposeValue "main"], modImports = [Import {impName = "Lune.IO", impAs = Just "IO", impExposing = Nothing},Import {impName = "Lune.Task", impAs = Just "Task", impExposing = Nothing},Import {impName = "Lune.String", impAs = Just "Str", impExposing = Nothing},Import {impName = "Lune.Json", impAs = Just "RawJson", impExposing = Nothing},Import {impName = "Nova", impAs = Nothing, impExposing = Just [ExposeType "Provider" ExposeAll,ExposeType "Model" ExposeOpaque,ExposeType "Response" ExposeOpaque,ExposeType "Error" ExposeAll,ExposeValue "defaultClient",ExposeValue "withOllamaBaseUrl",ExposeValue "openrouterModel",ExposeValue "ollamaModel",ExposeValue "ask",ExposeValue "json",ExposeValue "tool"]}], modDecls = [DeclTypeSig "showProvider" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "Provider") (TypeCon "String")}),DeclValue "showProvider" [PVar "p"] (Case (Var "p") [Alt (PCon "OpenRouter" []) (StringLit "openrouter"),Alt (PCon "Ollama" []) (StringLit "ollama")]),DeclTypeSig "showModel" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "Model") (TypeCon "String")}),DeclValue "showModel" [PVar "m"] (App (App (FieldAccess (Var "Str") "append") (App (Var "showProvider") (FieldAccess (Var "m") "provider"))) (App (App (FieldAccess (Var "Str") "append") (StringLit ":")) (FieldAccess (Var "m") "id"))),DeclTypeSig "showError" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "Error") (TypeCon "String")}),DeclValue "showError" [PVar "e"] (Case (Var "e") [Alt (PCon "NetworkError" [PVar "msg"]) (App (App (FieldAccess (Var "Str") "append") (StringLit "NetworkError ")) (Var "msg")),Alt (PCon "RateLimited" []) (StringLit "RateLimited"),Alt (PCon "Unauthorized" []) (StringLit "Unauthorized"),Alt (PCon "BadRequest" [PVar "msg"]) (App (App (FieldAccess (Var "Str") "append") (StringLit "BadRequest ")) (Var "msg")),Alt (PCon "ProviderError" [PVar "msg"]) (App (App (FieldAccess (Var "Str") "append") (StringLit "ProviderError ")) (Var "msg")),Alt (PCon "DecodeError" [PVar "msg"]) (App (App (FieldAccess (Var "Str") "append") (StringLit "DecodeError ")) (Var "msg"))]),DeclTypeSig "showAskResult" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeApp (TypeCon "Result") (TypeCon "Error")) (TypeCon "Response")) (TypeCon "String")}),DeclValue "showAskResult" [PVar "r"] (Case (Var "r") [Alt (PCon "Err" [PVar "e"]) (App (Var "showError") (Var "e")),Alt (PCon "Ok" [PVar "resp"]) (FieldAccess (Var "resp") "text")]),DeclTypeSig "showJsonResult" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeApp (TypeCon "Result") (TypeCon "Error")) (TypeCon "RawJson.Json")) (TypeCon "String")}),DeclValue "showJsonResult" [PVar "r"] (Case (Var "r") [Alt (PCon "Err" [PVar "e"]) (App (Var "showError") (Var "e")),Alt (PCon "Ok" [PVar "j"]) (App (FieldAccess (Var "RawJson") "stringify") (Var "j"))]),DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeApp (TypeCon "Task") (TypeCon "Unit")) (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [LetStmt "client" (App (App (Var "withOllamaBaseUrl") (StringLit "mock://")) (Var "defaultClient")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "model_builders_openrouter:")),LetStmt "m1" (App (Var "openrouterModel") (StringLit "x")),ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "showModel") (Var "m1"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "model_builders_ollama:")),LetStmt "m2" (App (Var "ollamaModel") (StringLit "y")),ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "showModel") (Var "m2"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "routing_openrouter_missing_key:")),BindStmt (PVar "r1") (App (FieldAccess (Var "Task") "fromIO") (App (App (Var "ask") (Var "client")) (RecordLiteral [("model",Var "m1"),("prompt",TemplateLit TemplateBlock [TemplateText "hi"])]))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "showAskResult") (Var "r1"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "routing_ollama_mock:")),BindStmt (PVar "r2") (App (FieldAccess (Var "Task") "fromIO") (App (App (Var "ask") (Var "client")) (RecordLiteral [("model",App (Var "ollamaModel") (StringLit "mock-pure")),("prompt",TemplateLit TemplateBlock [TemplateText "hi"])]))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "showAskResult") (Var "r2"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "tool_wrapper_counts:")),BindStmt (PVar "countsR") (App (FieldAccess (Var "Task") "fromIO") (App (App (Var "tool") (Var "client")) (RecordLiteral [("model",App (Var "ollamaModel") (StringLit "mock-tool-wrapper")),("prompt",TemplateLit TemplateBlock [TemplateText "user"])]))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "showJsonResult") (Var "countsR"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "json_pure:")),BindStmt (PVar "jp") (App (FieldAccess (Var "Task") "fromIO") (App (App (Var "json") (Var "client")) (RecordLiteral [("model",App (Var "ollamaModel") (StringLit "mock-pure")),("prompt",TemplateLit TemplateBlock [TemplateText "p"])]))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "showJsonResult") (Var "jp"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "tool_pure:")),BindStmt (PVar "tp") (App (FieldAccess (Var "Task") "fromIO") (App (App (Var "tool") (Var "client")) (RecordLiteral [("model",App (Var "ollamaModel") (StringLit "mock-pure")),("prompt",TemplateLit TemplateBlock [TemplateText "p"])]))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "showJsonResult") (Var "tp"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "json_prose_prefix:")),BindStmt (PVar "jpp") (App (FieldAccess (Var "Task") "fromIO") (App (App (Var "json") (Var "client")) (RecordLiteral [("model",App (Var "ollamaModel") (StringLit "mock-prose-prefix")),("prompt",TemplateLit TemplateBlock [TemplateText "p"])]))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "showJsonResult") (Var "jpp"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "tool_prose_prefix:")),BindStmt (PVar "tpp") (App (FieldAccess (Var "Task") "fromIO") (App (App (Var "tool") (Var "client")) (RecordLiteral [("model",App (Var "ollamaModel") (StringLit "mock-prose-prefix")),("prompt",TemplateLit TemplateBlock [TemplateText "p"])]))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "showJsonResult") (Var "tpp"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "json_prose_suffix:")),BindStmt (PVar "jps") (App (FieldAccess (Var "Task") "fromIO") (App (App (Var "json") (Var "client")) (RecordLiteral [("model",App (Var "ollamaModel") (StringLit "mock-prose-suffix")),("prompt",TemplateLit TemplateBlock [TemplateText "p"])]))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "showJsonResult") (Var "jps"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "tool_prose_suffix:")),BindStmt (PVar "tps") (App (FieldAccess (Var "Task") "fromIO") (App (App (Var "tool") (Var "client")) (RecordLiteral [("model",App (Var "ollamaModel") (StringLit "mock-prose-suffix")),("prompt",TemplateLit TemplateBlock [TemplateText "p"])]))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "showJsonResult") (Var "tps"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "tool_invalid:")),BindStmt (PVar "ti") (App (FieldAccess (Var "Task") "fromIO") (App (App (Var "tool") (Var "client")) (RecordLiteral [("model",App (Var "ollamaModel") (StringLit "mock-invalid")),("prompt",TemplateLit TemplateBlock [TemplateText "p"])]))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "showJsonResult") (Var "ti"))),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "tool_no_json:")),BindStmt (PVar "tn") (App (FieldAccess (Var "Task") "fromIO") (App (App (Var "tool") (Var "client")) (RecordLiteral [("model",App (Var "ollamaModel") (StringLit "mock-no-json")),("prompt",TemplateLit TemplateBlock [TemplateText "p"])]))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (Var "showJsonResult") (Var "tn")))])]}
