Module {modName = "DatabaseDecode", modExports = [ExposeValue "main"], modImports = [Import {impName = "Lune.IO", impAs = Just "IO", impExposing = Nothing},Import {impName = "Lune.Prelude", impAs = Nothing, impExposing = Just [ExposeType "IO" ExposeOpaque,ExposeType "Result" ExposeAll,ExposeType "Unit" ExposeOpaque,ExposeType "List" ExposeAll,ExposeType "Maybe" ExposeAll,ExposeType "Int" ExposeOpaque,ExposeType "String" ExposeOpaque,ExposeType "Bool" ExposeAll]},Import {impName = "Lune.Database", impAs = Just "Database", impExposing = Just [ExposeType "DbValue" ExposeAll]},Import {impName = "Lune.Database.Decode", impAs = Just "Decode", impExposing = Just [ExposeType "Decoder" ExposeOpaque,ExposeType "DecodeError" ExposeOpaque]},Import {impName = "Lune.String", impAs = Just "Str", impExposing = Nothing}], modDecls = [DeclTypeAlias "User" [] (TypeRecord [("id",TypeCon "Int"),("name",TypeCon "String"),("email",TypeCon "String")]),DeclTypeSig "userDecoder" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "Decoder") (TypeCon "User")}),DeclValue "userDecoder" [] (App (App (App (App (FieldAccess (Var "Decode") "map3") (Lam [PVar "id",PVar "name",PVar "email"] (RecordLiteral [("id",Var "id"),("name",Var "name"),("email",Var "email")]))) (App (App (FieldAccess (Var "Decode") "index") (IntLit 0)) (FieldAccess (Var "Decode") "int"))) (App (App (FieldAccess (Var "Decode") "index") (IntLit 1)) (FieldAccess (Var "Decode") "string"))) (App (App (FieldAccess (Var "Decode") "index") (IntLit 2)) (FieldAccess (Var "Decode") "string"))),DeclTypeAlias "Product" [] (TypeRecord [("id",TypeCon "Int"),("name",TypeCon "String"),("description",TypeApp (TypeCon "Maybe") (TypeCon "String"))]),DeclTypeSig "productDecoder" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "Decoder") (TypeCon "Product")}),DeclValue "productDecoder" [] (App (App (App (App (FieldAccess (Var "Decode") "map3") (Lam [PVar "id",PVar "name",PVar "desc"] (RecordLiteral [("id",Var "id"),("name",Var "name"),("description",Var "desc")]))) (App (App (FieldAccess (Var "Decode") "index") (IntLit 0)) (FieldAccess (Var "Decode") "int"))) (App (App (FieldAccess (Var "Decode") "index") (IntLit 1)) (FieldAccess (Var "Decode") "string"))) (App (App (FieldAccess (Var "Decode") "index") (IntLit 2)) (App (FieldAccess (Var "Decode") "nullable") (FieldAccess (Var "Decode") "string")))),DeclTypeSig "userRow" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "List") (TypeCon "DbValue")}),DeclValue "userRow" [] (App (App (Var "Cons") (App (Var "DbInt") (IntLit 42))) (App (App (Var "Cons") (App (Var "DbString") (StringLit "Alice"))) (App (App (Var "Cons") (App (Var "DbString") (StringLit "alice@example.com"))) (Var "Nil")))),DeclTypeSig "productRowWithDesc" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "List") (TypeCon "DbValue")}),DeclValue "productRowWithDesc" [] (App (App (Var "Cons") (App (Var "DbInt") (IntLit 1))) (App (App (Var "Cons") (App (Var "DbString") (StringLit "Widget"))) (App (App (Var "Cons") (App (Var "DbString") (StringLit "A useful widget"))) (Var "Nil")))),DeclTypeSig "productRowNullDesc" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "List") (TypeCon "DbValue")}),DeclValue "productRowNullDesc" [] (App (App (Var "Cons") (App (Var "DbInt") (IntLit 2))) (App (App (Var "Cons") (App (Var "DbString") (StringLit "Gadget"))) (App (App (Var "Cons") (Var "DbNull")) (Var "Nil")))),DeclTypeSig "badRow" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "List") (TypeCon "DbValue")}),DeclValue "badRow" [] (App (App (Var "Cons") (App (Var "DbString") (StringLit "not-an-int"))) (App (App (Var "Cons") (App (Var "DbString") (StringLit "Bob"))) (App (App (Var "Cons") (App (Var "DbString") (StringLit "bob@example.com"))) (Var "Nil")))),DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "=== Database Decode Examples ===")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (Var "decodeUserExample"),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (Var "decodeProductWithDesc"),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (Var "decodeProductNullDesc"),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (Var "decodeErrorExample"),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Done!"))]),DeclTypeSig "decodeUserExample" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "decodeUserExample" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Decoding user row: [42, 'Alice', 'alice@example.com']")),ExprStmt (Case (App (App (FieldAccess (Var "Decode") "decodeRow") (Var "userDecoder")) (Var "userRow")) [Alt (PCon "Err" [PVar "err"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Error: ")) (App (FieldAccess (Var "Decode") "errorToString") (Var "err")))),Alt (PCon "Ok" [PVar "user"]) (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "  id: ")) (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (Var "user") "id")))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "  name: ")) (FieldAccess (Var "user") "name"))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "  email: ")) (FieldAccess (Var "user") "email")))])])]),DeclTypeSig "decodeProductWithDesc" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "decodeProductWithDesc" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Decoding product with description: [1, 'Widget', 'A useful widget']")),ExprStmt (Case (App (App (FieldAccess (Var "Decode") "decodeRow") (Var "productDecoder")) (Var "productRowWithDesc")) [Alt (PCon "Err" [PVar "err"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Error: ")) (App (FieldAccess (Var "Decode") "errorToString") (Var "err")))),Alt (PCon "Ok" [PVar "product"]) (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "  id: ")) (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (Var "product") "id")))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "  name: ")) (FieldAccess (Var "product") "name"))),ExprStmt (App (Var "printDescription") (FieldAccess (Var "product") "description"))])])]),DeclTypeSig "decodeProductNullDesc" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "decodeProductNullDesc" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Decoding product with NULL description: [2, 'Gadget', NULL]")),ExprStmt (Case (App (App (FieldAccess (Var "Decode") "decodeRow") (Var "productDecoder")) (Var "productRowNullDesc")) [Alt (PCon "Err" [PVar "err"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Error: ")) (App (FieldAccess (Var "Decode") "errorToString") (Var "err")))),Alt (PCon "Ok" [PVar "product"]) (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "  id: ")) (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (Var "product") "id")))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "  name: ")) (FieldAccess (Var "product") "name"))),ExprStmt (App (Var "printDescription") (FieldAccess (Var "product") "description"))])])]),DeclTypeSig "printDescription" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeCon "Maybe") (TypeCon "String")) (TypeApp (TypeCon "IO") (TypeCon "Unit"))}),DeclValue "printDescription" [PVar "desc"] (Case (Var "desc") [Alt (PCon "Nothing" []) (App (FieldAccess (Var "IO") "println") (StringLit "  description: (none)")),Alt (PCon "Just" [PVar "d"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "  description: ")) (Var "d")))]),DeclTypeSig "decodeErrorExample" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "decodeErrorExample" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Decoding bad row (string instead of int): ['not-an-int', 'Bob', 'bob@example.com']")),ExprStmt (Case (App (App (FieldAccess (Var "Decode") "decodeRow") (Var "userDecoder")) (Var "badRow")) [Alt (PCon "Err" [PVar "err"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Expected error: ")) (App (FieldAccess (Var "Decode") "errorToString") (Var "err")))),Alt (PCon "Ok" [PWildcard]) (App (FieldAccess (Var "IO") "println") (StringLit "Unexpected success!"))])])]}
