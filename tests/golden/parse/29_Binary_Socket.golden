Module {modName = "BinarySocketExample", modExports = [ExposeValue "main"], modImports = [Import {impName = "Lune.IO", impAs = Just "IO", impExposing = Nothing},Import {impName = "Lune.Prelude", impAs = Nothing, impExposing = Just [ExposeType "IO" ExposeOpaque,ExposeType "Result" ExposeAll,ExposeType "Unit" ExposeOpaque,ExposeType "List" ExposeAll,ExposeType "Int" ExposeOpaque,ExposeType "String" ExposeOpaque]},Import {impName = "Lune.Bytes", impAs = Just "Bytes", impExposing = Just [ExposeType "Bytes" ExposeOpaque]},Import {impName = "Lune.Net.Socket", impAs = Just "Socket", impExposing = Just [ExposeType "Connection" ExposeOpaque]},Import {impName = "Lune.String", impAs = Just "Str", impExposing = Nothing}], modDecls = [DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "=== Binary TCP Socket Example ===")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Binary sockets enable wire protocol implementations.")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "=== API Overview ===")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "sendBytes : Connection -> Bytes -> IO (Result Error Unit)")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "  Send raw bytes over TCP connection")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "recvBytes : Connection -> Int -> IO (Result Error Bytes)")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "  Receive up to N bytes (returns when data available)")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "=== Example: Simple Protocol Client ===")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "-- Connect to a server")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "result <- Socket.connect \"localhost\" 5000")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "case result of")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "  Err e -> IO.println \"Connection failed\"")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "  Ok conn ->")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "    do")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "      -- Build a message with length prefix")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "      let payload = Bytes.fromList [72, 101, 108, 108, 111]  -- \"Hello\"")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "      let lenPrefix = Bytes.packInt32BE (Bytes.length payload)")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "      let message = Bytes.concat lenPrefix payload")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "      -- Send the message")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "      _ <- Socket.sendBytes conn message")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "      -- Read response length (4 bytes)")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "      lenResult <- Socket.recvBytes conn 4")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "      case lenResult of")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "        Err e -> IO.println \"Read failed\"")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "        Ok lenBytes ->")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "          case Bytes.unpackInt32BE lenBytes of")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "            Err e -> IO.println \"Invalid length\"")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "            Ok len ->")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "              do")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "                -- Read response payload")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "                payloadResult <- Socket.recvBytes conn len")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "                -- Process response...")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "                Socket.closeConn conn")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "=== Use Case: Wire Protocol Implementation ===")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Binary sockets + Bytes enable implementing protocols like:")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "- PostgreSQL wire protocol (message framing)")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "- Redis RESP protocol")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "- Custom binary protocols")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "For TLS-encrypted protocols, use Lune.Net.Tls instead.")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Done!"))])]}
