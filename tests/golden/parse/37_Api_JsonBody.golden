Module {modName = "ApiJsonBody", modExports = [ExposeValue "main"], modImports = [Import {impName = "Lune.IO", impAs = Just "IO", impExposing = Nothing},Import {impName = "Lune.Http.Api", impAs = Just "Api", impExposing = Nothing},Import {impName = "Lune.Http", impAs = Nothing, impExposing = Just [ExposeType "Method" ExposeAll]},Import {impName = "Lune.Json", impAs = Just "Json", impExposing = Nothing},Import {impName = "Lune.Json.Decode", impAs = Just "D", impExposing = Nothing},Import {impName = "Lune.String", impAs = Just "Str", impExposing = Nothing},Import {impName = "Lune.Prelude", impAs = Nothing, impExposing = Just [ExposeType "IO" ExposeOpaque,ExposeType "Unit" ExposeOpaque,ExposeType "Result" ExposeAll,ExposeType "Int" ExposeOpaque,ExposeType "String" ExposeOpaque]}], modDecls = [DeclType "AppError" [] [TypeCtor "ParseError" [TypeCon "String"]],DeclTypeSig "userDecoder" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "D.Decoder") (TypeRecord [("name",TypeCon "String"),("age",TypeCon "Int")])}),DeclValue "userDecoder" [] (App (App (App (FieldAccess (Var "D") "map2") (Lam [PVar "n",PVar "a"] (RecordLiteral [("name",Var "n"),("age",Var "a")]))) (App (App (FieldAccess (Var "D") "field") (StringLit "name")) (FieldAccess (Var "D") "string"))) (App (App (FieldAccess (Var "D") "field") (StringLit "age")) (FieldAccess (Var "D") "int"))),DeclTypeSig "goodReq" (QualType {qualConstraints = [], qualType = TypeRecord [("method",TypeCon "Method"),("path",TypeCon "String"),("headers",TypeApp (TypeCon "List") (TypeRecord [("key",TypeCon "String"),("value",TypeCon "String")])),("body",TypeCon "String")]}),DeclValue "goodReq" [] (RecordLiteral [("method",Var "GET"),("path",StringLit "/"),("headers",Var "Nil"),("body",StringLit "{\"name\":\"Alice\",\"age\":30}")]),DeclTypeSig "badReq" (QualType {qualConstraints = [], qualType = TypeRecord [("method",TypeCon "Method"),("path",TypeCon "String"),("headers",TypeApp (TypeCon "List") (TypeRecord [("key",TypeCon "String"),("value",TypeCon "String")])),("body",TypeCon "String")]}),DeclValue "badReq" [] (RecordLiteral [("method",Var "GET"),("path",StringLit "/"),("headers",Var "Nil"),("body",StringLit "{\"name\":\"Bob\"}")]),DeclTypeSig "testGoodRequest" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "testGoodRequest" [] (Case (App (App (App (FieldAccess (Var "Api") "jsonBody") (Var "ParseError")) (Var "userDecoder")) (Var "goodReq")) [Alt (PCon "Ok" [PVar "user"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (FieldAccess (Var "user") "name")) (App (App (FieldAccess (Var "Str") "append") (StringLit " age ")) (App (FieldAccess (Var "Str") "fromInt") (FieldAccess (Var "user") "age"))))),Alt (PCon "Err" [PCon "ParseError" [PVar "msg"]]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "ERROR: ")) (Var "msg")))]),DeclTypeSig "testBadRequest" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "testBadRequest" [] (Case (App (App (App (FieldAccess (Var "Api") "jsonBody") (Var "ParseError")) (Var "userDecoder")) (Var "badReq")) [Alt (PCon "Ok" [PVar "user"]) (App (FieldAccess (Var "IO") "println") (StringLit "unexpected success")),Alt (PCon "Err" [PCon "ParseError" [PVar "msg"]]) (App (FieldAccess (Var "IO") "println") (StringLit "parse failed as expected"))]),DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [ExprStmt (Var "testGoodRequest"),ExprStmt (Var "testBadRequest")])]}
