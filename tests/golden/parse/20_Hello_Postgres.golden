Module {modName = "HelloPostgres", modExports = [ExposeValue "main"], modImports = [Import {impName = "Lune.IO", impAs = Just "IO", impExposing = Nothing},Import {impName = "Lune.Prelude", impAs = Nothing, impExposing = Just [ExposeType "IO" ExposeOpaque,ExposeType "Result" ExposeAll,ExposeType "Unit" ExposeOpaque,ExposeType "List" ExposeAll,ExposeType "Bool" ExposeAll]},Import {impName = "Lune.Database", impAs = Just "Database", impExposing = Just [ExposeType "DbConn" ExposeOpaque,ExposeType "DbError" ExposeOpaque,ExposeType "DbValue" ExposeAll,ExposeValue "errorToString"]},Import {impName = "Lune.Database.Postgres", impAs = Just "Postgres", impExposing = Nothing},Import {impName = "Lune.String", impAs = Just "Str", impExposing = Nothing}], modDecls = [DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Connecting to PostgreSQL...")),BindStmt (PVar "result") (App (FieldAccess (Var "Postgres") "connect") (StringLit "postgresql://localhost/testdb")),ExprStmt (Case (Var "result") [Alt (PCon "Err" [PVar "e"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Connection error: ")) (App (Var "errorToString") (Var "e")))),Alt (PCon "Ok" [PVar "conn"]) (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Connected!")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Running: SELECT 1 as num")),BindStmt (PVar "queryResult") (App (App (App (FieldAccess (Var "Postgres") "query") (Var "conn")) (StringLit "SELECT 1 as num")) (Var "Nil")),ExprStmt (Case (Var "queryResult") [Alt (PCon "Err" [PVar "e"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Query error: ")) (App (Var "errorToString") (Var "e")))),Alt (PCon "Ok" [PVar "rows"]) (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Query succeeded!")),ExprStmt (App (Var "printRows") (Var "rows"))])]),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Running: SELECT $1 as greeting")),BindStmt (PVar "paramResult") (App (App (App (FieldAccess (Var "Postgres") "query") (Var "conn")) (StringLit "SELECT $1 as greeting")) (App (App (Var "Cons") (App (FieldAccess (Var "Database") "string") (StringLit "Hello from Lune!"))) (Var "Nil"))),ExprStmt (Case (Var "paramResult") [Alt (PCon "Err" [PVar "e"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Param query error: ")) (App (Var "errorToString") (Var "e")))),Alt (PCon "Ok" [PVar "rows"]) (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "Parameterized query succeeded!")),ExprStmt (App (Var "printRows") (Var "rows"))])]),BindStmt (PVar "closeResult") (App (FieldAccess (Var "Postgres") "close") (Var "conn")),ExprStmt (Case (Var "closeResult") [Alt (PCon "Err" [PVar "e"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Close error: ")) (App (Var "errorToString") (Var "e")))),Alt (PCon "Ok" [PWildcard]) (App (FieldAccess (Var "IO") "println") (StringLit "Connection closed."))])])])]),DeclTypeSig "printRows" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeCon "List") (TypeApp (TypeCon "List") (TypeCon "DbValue"))) (TypeApp (TypeCon "IO") (TypeCon "Unit"))}),DeclValue "printRows" [PVar "rows"] (Case (Var "rows") [Alt (PCon "Nil" []) (App (FieldAccess (Var "IO") "println") (StringLit "(no rows)")),Alt (PCon "Cons" [PVar "row",PVar "rest"]) (DoBlock [ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "  Row: ")) (App (Var "showRow") (Var "row")))),ExprStmt (App (Var "printRows") (Var "rest"))])]),DeclTypeSig "showRow" (QualType {qualConstraints = [], qualType = TypeArrow (TypeApp (TypeCon "List") (TypeCon "DbValue")) (TypeCon "String")}),DeclValue "showRow" [PVar "cols"] (Case (Var "cols") [Alt (PCon "Nil" []) (StringLit ""),Alt (PCon "Cons" [PVar "val",PCon "Nil" []]) (App (Var "showDbValue") (Var "val")),Alt (PCon "Cons" [PVar "val",PVar "rest"]) (App (App (FieldAccess (Var "Str") "append") (App (Var "showDbValue") (Var "val"))) (App (App (FieldAccess (Var "Str") "append") (StringLit ", ")) (App (Var "showRow") (Var "rest"))))]),DeclTypeSig "showDbValue" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "DbValue") (TypeCon "String")}),DeclValue "showDbValue" [PVar "val"] (Case (Var "val") [Alt (PCon "DbNull" []) (StringLit "NULL"),Alt (PCon "DbInt" [PVar "n"]) (App (FieldAccess (Var "Str") "fromInt") (Var "n")),Alt (PCon "DbFloat" [PVar "f"]) (App (FieldAccess (Var "Str") "fromFloat") (Var "f")),Alt (PCon "DbString" [PVar "s"]) (Var "s"),Alt (PCon "DbBool" [PVar "b"]) (Case (Var "b") [Alt (PCon "True" []) (StringLit "true"),Alt (PCon "False" []) (StringLit "false")])])]}
