Module {modName = "JsonDecodeDemo", modExports = [ExposeValue "main",ExposeValue "demo",ExposeValue "demoMissing",ExposeValue "demoNested"], modImports = [Import {impName = "Lune.Prelude", impAs = Nothing, impExposing = Just [ExposeType "IO" ExposeOpaque,ExposeType "Result" ExposeAll,ExposeType "Unit" ExposeOpaque,ExposeValue "unit",ExposeType "List" ExposeAll,ExposeType "Bool" ExposeAll,ExposeType "String" ExposeOpaque,ExposeType "Int" ExposeOpaque,ExposeType "Maybe" ExposeAll]},Import {impName = "Lune.IO", impAs = Just "IO", impExposing = Nothing},Import {impName = "Lune.String", impAs = Just "Str", impExposing = Nothing},Import {impName = "Lune.Json", impAs = Just "Json", impExposing = Nothing},Import {impName = "Lune.Json", impAs = Nothing, impExposing = Just [ExposeType "Json" ExposeOpaque]},Import {impName = "Lune.Json.Decode", impAs = Just "D", impExposing = Nothing}], modDecls = [DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [DiscardBindStmt (App (FieldAccess (Var "IO") "println") (StringLit "=== Decode Tests ===")),DiscardBindStmt (Var "testBasicDecode"),DiscardBindStmt (Var "testMissingField"),DiscardBindStmt (Var "testListIndexError"),DiscardBindStmt (Var "testNestedAt"),DiscardBindStmt (Var "testOneOf"),DiscardBindStmt (Var "testMaybe"),ExprStmt (App (Var "pure") (Var "unit"))]),DeclTypeSig "testBasicDecode" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "testBasicDecode" [] (Case (App (FieldAccess (Var "Json") "parse") (StringLit "{\"name\":\"Alice\",\"age\":30}")) [Alt (PCon "Err" [PWildcard]) (App (FieldAccess (Var "IO") "println") (StringLit "Parse failed")),Alt (PCon "Ok" [PVar "json"]) (Case (App (App (FieldAccess (Var "D") "decodeValue") (App (App (FieldAccess (Var "D") "field") (StringLit "name")) (FieldAccess (Var "D") "string"))) (Var "json")) [Alt (PCon "Ok" [PVar "name"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Name: ")) (Var "name"))),Alt (PCon "Err" [PVar "err"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Decode error: ")) (FieldAccess (Var "err") "message")))])]),DeclTypeSig "testMissingField" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "testMissingField" [] (Case (App (FieldAccess (Var "Json") "parse") (StringLit "{\"name\":\"Bob\"}")) [Alt (PCon "Err" [PWildcard]) (App (FieldAccess (Var "IO") "println") (StringLit "Parse failed")),Alt (PCon "Ok" [PVar "json"]) (Case (App (App (FieldAccess (Var "D") "decodeValue") (App (App (FieldAccess (Var "D") "field") (StringLit "email")) (FieldAccess (Var "D") "string"))) (Var "json")) [Alt (PCon "Ok" [PWildcard]) (App (FieldAccess (Var "IO") "println") (StringLit "Unexpected success")),Alt (PCon "Err" [PVar "err"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Expected error (missing field): ")) (FieldAccess (Var "err") "message")))])]),DeclTypeSig "testListIndexError" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "testListIndexError" [] (Case (App (FieldAccess (Var "Json") "parse") (StringLit "[1,2,\"bad\"]")) [Alt (PCon "Err" [PWildcard]) (App (FieldAccess (Var "IO") "println") (StringLit "Parse failed")),Alt (PCon "Ok" [PVar "json"]) (Case (App (App (FieldAccess (Var "D") "decodeValue") (App (FieldAccess (Var "D") "list") (FieldAccess (Var "D") "int"))) (Var "json")) [Alt (PCon "Ok" [PWildcard]) (App (FieldAccess (Var "IO") "println") (StringLit "Unexpected success")),Alt (PCon "Err" [PVar "err"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Expected error (list element): ")) (FieldAccess (Var "err") "message")))])]),DeclTypeSig "testNestedAt" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "testNestedAt" [] (Case (App (FieldAccess (Var "Json") "parse") (StringLit "{\"user\":{\"profile\":{\"email\":\"test@example.com\"}}}")) [Alt (PCon "Err" [PWildcard]) (App (FieldAccess (Var "IO") "println") (StringLit "Parse failed")),Alt (PCon "Ok" [PVar "json"]) (Case (App (App (FieldAccess (Var "D") "decodeValue") (App (App (FieldAccess (Var "D") "at") (App (App (Var "Cons") (StringLit "user")) (App (App (Var "Cons") (StringLit "profile")) (App (App (Var "Cons") (StringLit "email")) (Var "Nil"))))) (FieldAccess (Var "D") "string"))) (Var "json")) [Alt (PCon "Ok" [PVar "email"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Nested email: ")) (Var "email"))),Alt (PCon "Err" [PVar "err"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Decode error: ")) (FieldAccess (Var "err") "message")))])]),DeclTypeSig "testOneOf" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "testOneOf" [] (Case (App (FieldAccess (Var "Json") "parse") (StringLit "42")) [Alt (PCon "Err" [PWildcard]) (App (FieldAccess (Var "IO") "println") (StringLit "Parse failed")),Alt (PCon "Ok" [PVar "json"]) (App (Var "runOneOfDecoder") (Var "json"))]),DeclTypeSig "runOneOfDecoder" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "Json") (TypeApp (TypeCon "IO") (TypeCon "Unit"))}),DeclValue "runOneOfDecoder" [PVar "json"] (Case (App (App (FieldAccess (Var "D") "decodeValue") (App (FieldAccess (Var "D") "oneOf") (App (App (Var "Cons") (App (App (FieldAccess (Var "D") "map") (Var "showBool")) (FieldAccess (Var "D") "bool"))) (App (App (Var "Cons") (App (App (FieldAccess (Var "D") "map") (Var "showInt")) (FieldAccess (Var "D") "int"))) (Var "Nil"))))) (Var "json")) [Alt (PCon "Ok" [PVar "s"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "oneOf result: ")) (Var "s"))),Alt (PCon "Err" [PVar "err"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "oneOf error: ")) (FieldAccess (Var "err") "message")))]),DeclTypeSig "testMaybe" (QualType {qualConstraints = [], qualType = TypeApp (TypeCon "IO") (TypeCon "Unit")}),DeclValue "testMaybe" [] (Case (App (FieldAccess (Var "Json") "parse") (StringLit "null")) [Alt (PCon "Err" [PWildcard]) (App (FieldAccess (Var "IO") "println") (StringLit "Parse failed")),Alt (PCon "Ok" [PVar "json"]) (Case (App (App (FieldAccess (Var "D") "decodeValue") (App (FieldAccess (Var "D") "maybe") (FieldAccess (Var "D") "string"))) (Var "json")) [Alt (PCon "Ok" [PCon "Nothing" []]) (App (FieldAccess (Var "IO") "println") (StringLit "Maybe null -> Nothing")),Alt (PCon "Ok" [PCon "Just" [PVar "s"]]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Maybe value: ")) (Var "s"))),Alt (PCon "Err" [PVar "err"]) (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "Str") "append") (StringLit "Decode error: ")) (FieldAccess (Var "err") "message")))])]),DeclTypeSig "showBool" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "Bool") (TypeCon "String")}),DeclValue "showBool" [PVar "b"] (Case (Var "b") [Alt (PCon "True" []) (StringLit "true"),Alt (PCon "False" []) (StringLit "false")]),DeclTypeSig "showInt" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "Int") (TypeCon "String")}),DeclValue "showInt" [] (FieldAccess (Var "Str") "fromInt"),DeclTypeSig "demo" (QualType {qualConstraints = [], qualType = TypeCon "String"}),DeclValue "demo" [] (Case (App (FieldAccess (Var "Json") "parse") (StringLit "{\"name\":\"Test\"}")) [Alt (PCon "Err" [PWildcard]) (StringLit "parse failed"),Alt (PCon "Ok" [PVar "json"]) (Case (App (App (FieldAccess (Var "D") "decodeValue") (App (App (FieldAccess (Var "D") "field") (StringLit "name")) (FieldAccess (Var "D") "string"))) (Var "json")) [Alt (PCon "Ok" [PVar "s"]) (Var "s"),Alt (PCon "Err" [PWildcard]) (StringLit "decode failed")])]),DeclTypeSig "demoMissing" (QualType {qualConstraints = [], qualType = TypeCon "String"}),DeclValue "demoMissing" [] (Case (App (FieldAccess (Var "Json") "parse") (StringLit "{\"name\":\"Test\"}")) [Alt (PCon "Err" [PWildcard]) (StringLit "parse failed"),Alt (PCon "Ok" [PVar "json"]) (Case (App (App (FieldAccess (Var "D") "decodeValue") (App (App (FieldAccess (Var "D") "field") (StringLit "missing")) (FieldAccess (Var "D") "string"))) (Var "json")) [Alt (PCon "Ok" [PVar "s"]) (Var "s"),Alt (PCon "Err" [PVar "err"]) (FieldAccess (Var "err") "message")])]),DeclTypeSig "demoNested" (QualType {qualConstraints = [], qualType = TypeCon "String"}),DeclValue "demoNested" [] (Case (App (FieldAccess (Var "Json") "parse") (StringLit "{\"a\":{\"b\":{\"c\":\"deep\"}}}")) [Alt (PCon "Err" [PWildcard]) (StringLit "parse failed"),Alt (PCon "Ok" [PVar "json"]) (Case (App (App (FieldAccess (Var "D") "decodeValue") (App (App (FieldAccess (Var "D") "at") (App (App (Var "Cons") (StringLit "a")) (App (App (Var "Cons") (StringLit "b")) (App (App (Var "Cons") (StringLit "c")) (Var "Nil"))))) (FieldAccess (Var "D") "string"))) (Var "json")) [Alt (PCon "Ok" [PVar "s"]) (Var "s"),Alt (PCon "Err" [PVar "err"]) (FieldAccess (Var "err") "message")])])]}
