Module {modName = "ParallelFibers", modExports = [ExposeValue "main"], modImports = [Import {impName = "Lune.Prelude", impAs = Nothing, impExposing = Just [ExposeType "Task" ExposeOpaque,ExposeType "Unit" ExposeOpaque,ExposeValue "unit",ExposeType "Int" ExposeOpaque,ExposeType "Bool" ExposeAll,ExposeType "Applicative" ExposeAll,ExposeType "Monad" ExposeAll]},Import {impName = "Lune.IO", impAs = Just "IO", impExposing = Nothing},Import {impName = "Lune.Fiber", impAs = Just "Fiber", impExposing = Nothing},Import {impName = "Lune.Int", impAs = Just "Int", impExposing = Nothing},Import {impName = "Lune.String", impAs = Just "String", impExposing = Nothing}], modDecls = [DeclTypeSig "main" (QualType {qualConstraints = [], qualType = TypeApp (TypeApp (TypeCon "Task") (TypeCon "Unit")) (TypeCon "Unit")}),DeclValue "main" [] (DoBlock [DiscardBindStmt (App (FieldAccess (Var "IO") "println") (StringLit "Spawning 4 CPU-bound fibers...")),BindStmt (PVar "f1") (App (FieldAccess (Var "Fiber") "spawn") (App (App (Var "cpuWork") (StringLit "A")) (IntLit 20))),BindStmt (PVar "f2") (App (FieldAccess (Var "Fiber") "spawn") (App (App (Var "cpuWork") (StringLit "B")) (IntLit 20))),BindStmt (PVar "f3") (App (FieldAccess (Var "Fiber") "spawn") (App (App (Var "cpuWork") (StringLit "C")) (IntLit 20))),BindStmt (PVar "f4") (App (FieldAccess (Var "Fiber") "spawn") (App (App (Var "cpuWork") (StringLit "D")) (IntLit 20))),DiscardBindStmt (App (FieldAccess (Var "IO") "println") (StringLit "Awaiting results...")),DiscardBindStmt (App (FieldAccess (Var "Fiber") "await") (Var "f1")),DiscardBindStmt (App (FieldAccess (Var "Fiber") "await") (Var "f2")),DiscardBindStmt (App (FieldAccess (Var "Fiber") "await") (Var "f3")),DiscardBindStmt (App (FieldAccess (Var "Fiber") "await") (Var "f4")),ExprStmt (App (FieldAccess (Var "IO") "println") (StringLit "All done!"))]),DeclTypeSig "cpuWork" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "String") (TypeArrow (TypeCon "Int") (TypeApp (TypeApp (TypeCon "Task") (TypeCon "Unit")) (TypeCon "Unit")))}),DeclValue "cpuWork" [PVar "name",PVar "n"] (DoBlock [DiscardBindStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "String") "append") (Var "name")) (StringLit ": starting"))),LetStmt "result" (App (Var "fib") (Var "n")),DiscardBindStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "String") "append") (Var "name")) (App (App (FieldAccess (Var "String") "append") (StringLit ": fib result = ")) (App (FieldAccess (Var "String") "fromInt") (Var "result"))))),ExprStmt (App (FieldAccess (Var "IO") "println") (App (App (FieldAccess (Var "String") "append") (Var "name")) (StringLit ": done")))]),DeclTypeSig "fib" (QualType {qualConstraints = [], qualType = TypeArrow (TypeCon "Int") (TypeCon "Int")}),DeclValue "fib" [PVar "n"] (Case (App (App (FieldAccess (Var "Int") "lte") (Var "n")) (IntLit 1)) [Alt (PCon "True" []) (Var "n"),Alt (PCon "False" []) (App (App (FieldAccess (Var "Int") "add") (App (Var "fib") (App (App (FieldAccess (Var "Int") "sub") (Var "n")) (IntLit 1)))) (App (Var "fib") (App (App (FieldAccess (Var "Int") "sub") (Var "n")) (IntLit 2))))])]}
