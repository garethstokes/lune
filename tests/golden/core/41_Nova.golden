CoreModule {coreName = "NovaDemo", coreDecls = [CoreDecl "$dictFunctor_IO" (CRecord [("map",CLam [PVar "f",PVar "ma"] (CApp (CApp (CVar "$primIOBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primIOPure") (CApp (CVar "f") (CVar "a"))))))]),CoreDecl "$dictApplicative_IO" (CRecord [("$superFunctor",CVar "$dictFunctor_IO"),("pure",CVar "$primIOPure"),("apply",CLam [PVar "mf",PVar "ma"] (CApp (CApp (CVar "$primIOBind") (CVar "mf")) (CLam [PVar "f"] (CApp (CApp (CVar "$primIOBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primIOPure") (CApp (CVar "f") (CVar "a"))))))))]),CoreDecl "$dictMonad_IO" (CRecord [("$superApplicative",CVar "$dictApplicative_IO"),("andThen",CVar "$primIOBind"),("then",CVar "$primIOThen")]),CoreDecl "$dictFunctor_Task" (CRecord [("map",CLam [PVar "f",PVar "ta"] (CCase (CVar "ta") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "$primIOBind") (CVar "io")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a"))))]))))]))]),CoreDecl "$dictApplicative_Task" (CRecord [("$superFunctor",CVar "$dictFunctor_Task"),("pure",CLam [PVar "a"] (CApp (CVar "Lune.Prelude.Task") (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))))),("apply",CLam [PVar "tf",PVar "ta"] (CCase (CVar "tf") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "ioF"]) (CCase (CVar "ta") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "ioA"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "$primIOBind") (CVar "ioF")) (CLam [PVar "rf"] (CCase (CVar "rf") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "f"]) (CApp (CApp (CVar "$primIOBind") (CVar "ioA")) (CLam [PVar "ra"] (CCase (CVar "ra") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a"))))])))]))))])]))]),CoreDecl "$dictMonad_Task" (CRecord [("$superApplicative",CVar "$dictApplicative_Task"),("andThen",CLam [PVar "ta",PVar "k"] (CCase (CVar "ta") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "$primIOBind") (CVar "io")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CVar "k") (CVar "a")) [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io2"]) (CVar "io2")])]))))])),("then",CLam [PVar "ta",PVar "tb"] (CCase (CVar "ta") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "ioA"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "$primIOBind") (CVar "ioA")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PWildcard]) (CCase (CVar "tb") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "ioB"]) (CVar "ioB")])]))))]))]),CoreDecl "$dictFunctor_Result" (CRecord [("map",CLam [PVar "f",PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a")))]))]),CoreDecl "$dictApplicative_Result" (CRecord [("$superFunctor",CVar "$dictFunctor_Result"),("pure",CLam [PVar "a"] (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))),("apply",CLam [PVar "rf",PVar "ra"] (CCase (CVar "rf") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "f"]) (CCase (CVar "ra") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a")))])]))]),CoreDecl "$dictMonad_Result" (CRecord [("$superApplicative",CVar "$dictApplicative_Result"),("andThen",CLam [PVar "m",PVar "k"] (CCase (CVar "m") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "k") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e"))])),("then",CLam [PVar "ra",PVar "rb"] (CCase (CVar "ra") [CoreAlt (PCon "Lune.Prelude.Ok" [PWildcard]) (CVar "rb"),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e"))]))]),CoreDecl "$dictFunctor_STM" (CRecord [("map",CLam [PVar "f",PVar "ma"] (CApp (CApp (CVar "$primSTMBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primSTMPure") (CApp (CVar "f") (CVar "a"))))))]),CoreDecl "$dictApplicative_STM" (CRecord [("$superFunctor",CVar "$dictFunctor_STM"),("pure",CVar "$primSTMPure"),("apply",CLam [PVar "mf",PVar "ma"] (CApp (CApp (CVar "$primSTMBind") (CVar "mf")) (CLam [PVar "f"] (CApp (CApp (CVar "$primSTMBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primSTMPure") (CApp (CVar "f") (CVar "a"))))))))]),CoreDecl "$dictMonad_STM" (CRecord [("$superApplicative",CVar "$dictApplicative_STM"),("andThen",CVar "$primSTMBind"),("then",CLam [PVar "ma",PVar "mb"] (CApp (CApp (CVar "$primSTMBind") (CVar "ma")) (CLam [PWildcard] (CVar "mb"))))]),CoreDecl "$dictJson.Decode_Bool" (CRecord [("decoder",CVar "Lune.Json.Decode.bool")]),CoreDecl "$dictJson.Decode_Float" (CRecord [("decoder",CVar "Lune.Json.Decode.float")]),CoreDecl "$dictJson.Decode_Int" (CRecord [("decoder",CVar "Lune.Json.Decode.int")]),CoreDecl "$dictJson.Decode_Json" (CRecord [("decoder",CLam [PVar "j"] (CApp (CVar "Lune.Prelude.Ok") (CVar "j")))]),CoreDecl "$dictJson.Decode_String" (CRecord [("decoder",CVar "Lune.Json.Decode.string")]),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Prelude.unit" (CVar "Lune.Prelude.Unit"),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Prelude.fst" (CLam [PVar "p"] (CCase (CVar "p") [CoreAlt (PCon "Lune.Prelude.Pair" [PVar "x",PWildcard]) (CVar "x")])),CoreDecl "" (CInt 0),CoreDecl "Lune.Prelude.snd" (CLam [PVar "p"] (CCase (CVar "p") [CoreAlt (PCon "Lune.Prelude.Pair" [PWildcard,PVar "y"]) (CVar "y")])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.println" (CLam [PVar "s"] (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_ioBind") (CApp (CVar "prim_putStrLn") (CVar "s"))) (CLam [PVar "u"] (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CVar "u"))))))),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.readLine" (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_ioBind") (CVar "prim_readLine")) (CLam [PVar "s"] (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CVar "s")))))),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.readInt" (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_ioBind") (CVar "prim_readInt")) (CLam [PVar "n"] (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CVar "n")))))),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.sleepMs" (CLam [PVar "ms"] (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_ioBind") (CApp (CVar "prim_sleepMs") (CVar "ms"))) (CLam [PVar "u"] (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CVar "u"))))))),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.readFile" (CLam [PVar "path"] (CApp (CVar "Lune.Prelude.Task") (CApp (CVar "prim_readFile") (CVar "path")))),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.writeFile" (CLam [PVar "path",PVar "contents"] (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_writeFile") (CVar "path")) (CVar "contents")))),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.succeed" (CLam [PVar "a"] (CApp (CVar "Lune.Prelude.Task") (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.fail" (CLam [PVar "e"] (CApp (CVar "Lune.Prelude.Task") (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.fromIO" (CLam [PVar "io"] (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_ioBind") (CVar "io")) (CLam [PVar "a"] (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))))))),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.map" (CLam [PVar "f",PVar "task"] (CCase (CVar "task") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_ioBind") (CVar "io")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a"))))]))))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.andThen" (CLam [PVar "task",PVar "k"] (CCase (CVar "task") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_ioBind") (CVar "io")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CVar "k") (CVar "a")) [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io2"]) (CVar "io2")])]))))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.then" (CLam [PVar "ta",PVar "tb"] (CApp (CApp (CVar "Lune.Task.andThen") (CVar "ta")) (CLam [PWildcard] (CVar "tb")))),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.mapError" (CLam [PVar "f",PVar "task"] (CCase (CVar "task") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_ioBind") (CVar "io")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "f") (CVar "e")))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CVar "a")))]))))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.onError" (CLam [PVar "task",PVar "handler"] (CCase (CVar "task") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_ioBind") (CVar "io")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CCase (CApp (CVar "handler") (CVar "e")) [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io2"]) (CVar "io2")])]))))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.attempt" (CLam [PVar "task"] (CCase (CVar "task") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CVar "io")])),CoreDecl "" (CInt 0),CoreDecl "Lune.Char.toInt" (CVar "prim_charToInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Char.fromInt" (CVar "prim_intToChar"),CoreDecl "" (CInt 0),CoreDecl "Lune.Char.toLower" (CLam [PVar "c"] (CCase (CApp (CApp (CVar "prim_and") (CApp (CApp (CVar "prim_geInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 65))) (CApp (CApp (CVar "prim_leInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 90))) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Char.fromInt") (CApp (CApp (CVar "prim_addInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 32))),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "c")])),CoreDecl "" (CInt 0),CoreDecl "Lune.Char.toUpper" (CLam [PVar "c"] (CCase (CApp (CApp (CVar "prim_and") (CApp (CApp (CVar "prim_geInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 97))) (CApp (CApp (CVar "prim_leInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 122))) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Char.fromInt") (CApp (CApp (CVar "prim_subInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 32))),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "c")])),CoreDecl "" (CInt 0),CoreDecl "Lune.Char.isSpace" (CLam [PVar "c"] (CCase (CApp (CApp (CVar "prim_eqInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 32)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "prim_eqInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 9)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "prim_eqInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 10)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "prim_eqInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 13)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.False")])])])])),CoreDecl "" (CInt 0),CoreDecl "Lune.Char.eq" (CLam [PVar "a",PVar "b"] (CApp (CApp (CVar "prim_eqInt") (CApp (CVar "Lune.Char.toInt") (CVar "a"))) (CApp (CVar "Lune.Char.toInt") (CVar "b")))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.append" (CVar "prim_appendString"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.eq" (CVar "prim_eqString"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.fromInt" (CVar "prim_showInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.fromFloat" (CVar "prim_showFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.toInt" (CVar "prim_parseInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.toChars" (CVar "prim_stringToChars"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.fromChars" (CVar "prim_charsToString"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.fromChar" (CLam [PVar "c"] (CApp (CVar "Lune.String.fromChars") (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "c")) (CVar "Lune.Prelude.Nil")))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.length" (CLam [PVar "s"] (CApp (CVar "Lune.String.listLength") (CApp (CVar "Lune.String.toChars") (CVar "s")))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.isEmpty" (CLam [PVar "s"] (CCase (CApp (CVar "Lune.String.toChars") (CVar "s")) [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.True"),CoreAlt PWildcard (CVar "Lune.Prelude.False")])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.toLower" (CLam [PVar "s"] (CApp (CVar "Lune.String.fromChars") (CApp (CApp (CVar "Lune.String.listMap") (CVar "Lune.Char.toLower")) (CApp (CVar "Lune.String.toChars") (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.toUpper" (CLam [PVar "s"] (CApp (CVar "Lune.String.fromChars") (CApp (CApp (CVar "Lune.String.listMap") (CVar "Lune.Char.toUpper")) (CApp (CVar "Lune.String.toChars") (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.startsWith" (CLam [PVar "prefix",PVar "s"] (CApp (CApp (CVar "Lune.String.charsStartsWith") (CApp (CVar "Lune.String.toChars") (CVar "prefix"))) (CApp (CVar "Lune.String.toChars") (CVar "s")))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.endsWith" (CLam [PVar "suffix",PVar "s"] (CApp (CApp (CVar "Lune.String.charsStartsWith") (CApp (CVar "Lune.String.listReverse") (CApp (CVar "Lune.String.toChars") (CVar "suffix")))) (CApp (CVar "Lune.String.listReverse") (CApp (CVar "Lune.String.toChars") (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.contains" (CLam [PVar "needle",PVar "haystack"] (CApp (CApp (CVar "Lune.String.charsContains") (CApp (CVar "Lune.String.toChars") (CVar "needle"))) (CApp (CVar "Lune.String.toChars") (CVar "haystack")))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.split" (CLam [PVar "delimiter",PVar "s"] (CCase (CApp (CVar "Lune.String.isEmpty") (CVar "delimiter")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "s")) (CVar "Lune.Prelude.Nil")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CVar "Lune.String.splitHelper") (CApp (CVar "Lune.String.toChars") (CVar "delimiter"))) (CApp (CVar "Lune.String.toChars") (CVar "s"))) (CVar "Lune.Prelude.Nil"))])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.join" (CLam [PVar "sep",PVar "parts"] (CCase (CVar "parts") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CString ""),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "first",PVar "rest"]) (CApp (CApp (CApp (CVar "Lune.String.listFoldl") (CLam [PVar "acc",PVar "x"] (CApp (CApp (CVar "Lune.String.append") (CApp (CApp (CVar "Lune.String.append") (CVar "acc")) (CVar "sep"))) (CVar "x")))) (CVar "first")) (CVar "rest"))])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.trim" (CLam [PVar "s"] (CApp (CVar "Lune.String.trimLeft") (CApp (CVar "Lune.String.trimRight") (CVar "s")))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.trimLeft" (CLam [PVar "s"] (CApp (CVar "Lune.String.fromChars") (CApp (CApp (CVar "Lune.String.dropWhileChars") (CVar "Lune.Char.isSpace")) (CApp (CVar "Lune.String.toChars") (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.trimRight" (CLam [PVar "s"] (CApp (CVar "Lune.String.fromChars") (CApp (CVar "Lune.String.listReverse") (CApp (CApp (CVar "Lune.String.dropWhileChars") (CVar "Lune.Char.isSpace")) (CApp (CVar "Lune.String.listReverse") (CApp (CVar "Lune.String.toChars") (CVar "s"))))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.drop" (CLam [PVar "n",PVar "s"] (CApp (CVar "Lune.String.fromChars") (CApp (CApp (CVar "Lune.String.listDrop") (CVar "n")) (CApp (CVar "Lune.String.toChars") (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.take" (CLam [PVar "n",PVar "s"] (CApp (CVar "Lune.String.fromChars") (CApp (CApp (CVar "Lune.String.listTake") (CVar "n")) (CApp (CVar "Lune.String.toChars") (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.indexOf" (CLam [PVar "needle",PVar "haystack"] (CApp (CApp (CApp (CVar "Lune.String.indexOfHelper") (CApp (CVar "Lune.String.toChars") (CVar "needle"))) (CApp (CVar "Lune.String.toChars") (CVar "haystack"))) (CInt 0))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.lines" (CLam [PVar "s"] (CApp (CApp (CVar "Lune.String.split") (CString "\n")) (CVar "s"))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.unlines" (CLam [PVar "ls"] (CApp (CApp (CVar "Lune.String.join") (CString "\n")) (CVar "ls"))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.charsStartsWith" (CLam [PVar "prefix",PVar "str"] (CCase (CVar "prefix") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "p",PVar "ps"]) (CCase (CVar "str") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.False"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "s",PVar "ss"]) (CCase (CApp (CApp (CVar "Lune.Char.eq") (CVar "p")) (CVar "s")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.String.charsStartsWith") (CVar "ps")) (CVar "ss")),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.False")])])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.charsContains" (CLam [PVar "needle",PVar "haystack"] (CCase (CVar "needle") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.True"),CoreAlt PWildcard (CCase (CVar "haystack") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.False"),CoreAlt (PCon "Lune.Prelude.Cons" [PWildcard,PVar "rest"]) (CCase (CApp (CApp (CVar "Lune.String.charsStartsWith") (CVar "needle")) (CVar "haystack")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.String.charsContains") (CVar "needle")) (CVar "rest"))])])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.splitHelper" (CLam [PVar "delim",PVar "chars",PVar "acc"] (CCase (CVar "chars") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "Lune.String.fromChars") (CApp (CVar "Lune.String.listReverse") (CVar "acc")))) (CVar "Lune.Prelude.Nil")),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "c",PVar "rest"]) (CCase (CApp (CApp (CVar "Lune.String.charsStartsWith") (CVar "delim")) (CVar "chars")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "Lune.String.fromChars") (CApp (CVar "Lune.String.listReverse") (CVar "acc")))) (CApp (CApp (CApp (CVar "Lune.String.splitHelper") (CVar "delim")) (CApp (CApp (CVar "Lune.String.listDrop") (CApp (CVar "Lune.String.listLength") (CVar "delim"))) (CVar "chars"))) (CVar "Lune.Prelude.Nil"))),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CVar "Lune.String.splitHelper") (CVar "delim")) (CVar "rest")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "c")) (CVar "acc")))])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.indexOfHelper" (CLam [PVar "needle",PVar "haystack",PVar "idx"] (CCase (CVar "needle") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CVar "Lune.Prelude.Just") (CVar "idx")),CoreAlt PWildcard (CCase (CVar "haystack") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nothing"),CoreAlt (PCon "Lune.Prelude.Cons" [PWildcard,PVar "rest"]) (CCase (CApp (CApp (CVar "Lune.String.charsStartsWith") (CVar "needle")) (CVar "haystack")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Just") (CVar "idx")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CVar "Lune.String.indexOfHelper") (CVar "needle")) (CVar "rest")) (CApp (CApp (CVar "prim_addInt") (CVar "idx")) (CInt 1)))])])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.dropWhileChars" (CLam [PVar "pred",PVar "chars"] (CCase (CVar "chars") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "c",PVar "rest"]) (CCase (CApp (CVar "pred") (CVar "c")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.String.dropWhileChars") (CVar "pred")) (CVar "rest")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "c")) (CVar "rest"))])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listLength" (CLam [PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CInt 0),CoreAlt (PCon "Lune.Prelude.Cons" [PWildcard,PVar "rest"]) (CApp (CApp (CVar "prim_addInt") (CInt 1)) (CApp (CVar "Lune.String.listLength") (CVar "rest")))])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listMap" (CLam [PVar "f",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "f") (CVar "x"))) (CApp (CApp (CVar "Lune.String.listMap") (CVar "f")) (CVar "rest")))])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listReverse" (CLam [PVar "xs"] (CApp (CApp (CVar "Lune.String.listReverseHelper") (CVar "xs")) (CVar "Lune.Prelude.Nil"))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listReverseHelper" (CLam [PVar "xs",PVar "acc"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CVar "Lune.String.listReverseHelper") (CVar "rest")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "x")) (CVar "acc")))])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listDrop" (CLam [PVar "n",PVar "xs"] (CCase (CApp (CApp (CVar "prim_leInt") (CVar "n")) (CInt 0)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "xs"),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PWildcard,PVar "rest"]) (CApp (CApp (CVar "Lune.String.listDrop") (CApp (CApp (CVar "prim_subInt") (CVar "n")) (CInt 1))) (CVar "rest"))])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listTake" (CLam [PVar "n",PVar "xs"] (CCase (CApp (CApp (CVar "prim_leInt") (CVar "n")) (CInt 0)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "x")) (CApp (CApp (CVar "Lune.String.listTake") (CApp (CApp (CVar "prim_subInt") (CVar "n")) (CInt 1))) (CVar "rest")))])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listFoldl" (CLam [PVar "f",PVar "acc",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CApp (CVar "Lune.String.listFoldl") (CVar "f")) (CApp (CApp (CVar "f") (CVar "acc")) (CVar "x"))) (CVar "rest"))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.parse" (CVar "prim_jsonParse"),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.stringify" (CVar "prim_jsonStringify"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.add" (CVar "prim_addInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.sub" (CVar "prim_subInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.mul" (CVar "prim_mulInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.div" (CVar "prim_divInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.mod" (CVar "prim_modInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.eq" (CVar "prim_eqInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.gte" (CVar "prim_geInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.lte" (CVar "prim_leInt"),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.decodeValue" (CLam [PVar "decoder",PVar "json"] (CApp (CVar "decoder") (CVar "json"))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.succeed" (CLam [PVar "value"] (CLam [PWildcard] (CApp (CVar "Lune.Prelude.Ok") (CVar "value")))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.fail" (CLam [PVar "message"] (CLam [PWildcard] (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "message"),("path",CVar "Lune.Prelude.Nil")])))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.bool" (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonToBool") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "b")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")]))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.int" (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonToInt") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "n"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "n")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")]))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.float" (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonToFloat") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "f"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "f")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")]))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.string" (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonToString") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "s"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "s")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")]))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.null" (CLam [PVar "defaultValue"] (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonIsNull") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CVar "defaultValue")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CString "expected null"),("path",CVar "Lune.Prelude.Nil")]))]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.list" (CLam [PVar "elemDecoder"] (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonToArray") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")])),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "elements"]) (CApp (CApp (CApp (CVar "Lune.Json.Decode.decodeList") (CVar "elemDecoder")) (CInt 0)) (CVar "elements"))]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.decodeList" (CLam [PVar "decoder",PVar "idx",PVar "elements"] (CCase (CVar "elements") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CVar "Lune.Prelude.Ok") (CVar "Lune.Prelude.Nil")),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "xs"]) (CCase (CApp (CVar "decoder") (CVar "x")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CApp (CApp (CVar "Lune.Json.Decode.prependPath") (CApp (CVar "Lune.Json.Decode.Index") (CVar "idx"))) (CVar "err"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CApp (CApp (CVar "Lune.Json.Decode.decodeList") (CVar "decoder")) (CApp (CApp (CVar "Lune.Int.add") (CVar "idx")) (CInt 1))) (CVar "xs")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "rest"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "a")) (CVar "rest")))])])])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.maybe" (CLam [PVar "decoder"] (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonIsNull") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CVar "Lune.Prelude.Nothing")),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CVar "decoder") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "Lune.Prelude.Just") (CVar "a"))),CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err"))])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.field" (CLam [PVar "name",PVar "decoder"] (CLam [PVar "json"] (CCase (CApp (CApp (CVar "prim_jsonGetField") (CVar "name")) (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "Lune.Json.Decode.Field") (CVar "name"))) (CVar "Lune.Prelude.Nil"))])),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "fieldJson"]) (CCase (CApp (CVar "decoder") (CVar "fieldJson")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CApp (CApp (CVar "Lune.Json.Decode.prependPath") (CApp (CVar "Lune.Json.Decode.Field") (CVar "name"))) (CVar "err"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.index" (CLam [PVar "idx",PVar "decoder"] (CLam [PVar "json"] (CCase (CApp (CApp (CVar "prim_jsonGetIndex") (CVar "idx")) (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "Lune.Json.Decode.Index") (CVar "idx"))) (CVar "Lune.Prelude.Nil"))])),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "elemJson"]) (CCase (CApp (CVar "decoder") (CVar "elemJson")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CApp (CApp (CVar "Lune.Json.Decode.prependPath") (CApp (CVar "Lune.Json.Decode.Index") (CVar "idx"))) (CVar "err"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.at" (CLam [PVar "path",PVar "decoder"] (CCase (CVar "path") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "decoder"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "name",PVar "rest"]) (CApp (CApp (CVar "Lune.Json.Decode.field") (CVar "name")) (CApp (CApp (CVar "Lune.Json.Decode.at") (CVar "rest")) (CVar "decoder")))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.map" (CLam [PVar "f",PVar "decoder"] (CLam [PVar "json"] (CCase (CApp (CVar "decoder") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a")))]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.map2" (CLam [PVar "f",PVar "decoderA",PVar "decoderB"] (CLam [PVar "json"] (CCase (CApp (CVar "decoderA") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CVar "decoderB") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CVar "f") (CVar "a")) (CVar "b")))])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.map3" (CLam [PVar "f",PVar "da",PVar "db",PVar "dc"] (CLam [PVar "json"] (CCase (CApp (CVar "da") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CVar "db") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CCase (CApp (CVar "dc") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "c"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CApp (CVar "f") (CVar "a")) (CVar "b")) (CVar "c")))])])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.map4" (CLam [PVar "f",PVar "da",PVar "db",PVar "dc",PVar "dd"] (CLam [PVar "json"] (CCase (CApp (CVar "da") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CVar "db") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CCase (CApp (CVar "dc") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "c"]) (CCase (CApp (CVar "dd") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "d"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CApp (CApp (CVar "f") (CVar "a")) (CVar "b")) (CVar "c")) (CVar "d")))])])])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.map5" (CLam [PVar "fn",PVar "da",PVar "db",PVar "dc",PVar "dd",PVar "de"] (CLam [PVar "json"] (CCase (CApp (CVar "da") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CVar "db") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CCase (CApp (CVar "dc") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "c"]) (CCase (CApp (CVar "dd") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "d"]) (CCase (CApp (CVar "de") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "e"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CApp (CApp (CApp (CVar "fn") (CVar "a")) (CVar "b")) (CVar "c")) (CVar "d")) (CVar "e")))])])])])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.andThen" (CLam [PVar "continuation",PVar "decoder"] (CLam [PVar "json"] (CCase (CApp (CVar "decoder") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CApp (CVar "continuation") (CVar "a")) (CVar "json"))]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.oneOf" (CLam [PVar "decoders"] (CLam [PVar "json"] (CApp (CApp (CApp (CVar "Lune.Json.Decode.tryDecoders") (CVar "decoders")) (CRecord [("message",CString "oneOf: no decoders provided"),("path",CVar "Lune.Prelude.Nil")])) (CVar "json")))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.tryDecoders" (CLam [PVar "decoders",PVar "lastErr",PVar "json"] (CCase (CVar "decoders") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CVar "Lune.Prelude.Err") (CVar "lastErr")),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "decoder",PVar "rest"]) (CCase (CApp (CVar "decoder") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CApp (CApp (CVar "Lune.Json.Decode.tryDecoders") (CVar "rest")) (CVar "err")) (CVar "json"))])])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.prependPath" (CLam [PVar "item",PVar "err"] (CRecord [("message",CSelect (CVar "err") "message"),("path",CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "item")) (CSelect (CVar "err") "path"))])),CoreDecl "" (CInt 0),CoreDecl "Lune.List.map" (CLam [PVar "f",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "xt"]) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "f") (CVar "x"))) (CApp (CApp (CVar "Lune.List.map") (CVar "f")) (CVar "xt")))])),CoreDecl "" (CInt 0),CoreDecl "Lune.List.foldl" (CLam [PVar "f",PVar "acc",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "xt"]) (CApp (CApp (CApp (CVar "Lune.List.foldl") (CVar "f")) (CApp (CApp (CVar "f") (CVar "acc")) (CVar "x"))) (CVar "xt"))])),CoreDecl "" (CInt 0),CoreDecl "Lune.List.length" (CLam [PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CInt 0),CoreAlt (PCon "Lune.Prelude.Cons" [PWildcard,PVar "xt"]) (CApp (CApp (CVar "Lune.Int.add") (CInt 1)) (CApp (CVar "Lune.List.length") (CVar "xt")))])),CoreDecl "" (CInt 0),CoreDecl "Lune.List.reverse" (CLam [PVar "xs"] (CApp (CApp (CVar "Lune.List.reverseHelper") (CVar "xs")) (CVar "Lune.Prelude.Nil"))),CoreDecl "" (CInt 0),CoreDecl "Lune.List.reverseHelper" (CLam [PVar "xs",PVar "acc"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "xt"]) (CApp (CApp (CVar "Lune.List.reverseHelper") (CVar "xt")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "x")) (CVar "acc")))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.null" (CVar "prim_jsonNull"),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.bool" (CVar "prim_jsonBool"),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.int" (CVar "prim_jsonInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.float" (CVar "prim_jsonFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.string" (CVar "prim_jsonString"),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.list" (CLam [PVar "encoder",PVar "items"] (CApp (CVar "prim_jsonArray") (CApp (CApp (CVar "Lune.List.map") (CVar "encoder")) (CVar "items")))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.object" (CLam [PVar "pairs"] (CApp (CVar "prim_jsonObject") (CVar "pairs"))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.dictEmpty" (CVar "Lune.Prelude.Nil"),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.dictFromList" (CLam [PVar "pairs"] (CVar "pairs")),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.dictGet" (CLam [PVar "eq",PVar "key",PVar "dict"] (CCase (CVar "dict") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nothing"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "entry",PVar "rest"]) (CCase (CApp (CApp (CVar "eq") (CVar "key")) (CSelect (CVar "entry") "key")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Just") (CSelect (CVar "entry") "value")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CVar "Nova.Core.dictGet") (CVar "eq")) (CVar "key")) (CVar "rest"))])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.dictInsert" (CLam [PVar "eq",PVar "key",PVar "value",PVar "dict"] (CCase (CVar "dict") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CVar "key"),("value",CVar "value")])) (CVar "Lune.Prelude.Nil")),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "entry",PVar "rest"]) (CCase (CApp (CApp (CVar "eq") (CVar "key")) (CSelect (CVar "entry") "key")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CVar "key"),("value",CVar "value")])) (CVar "rest")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "entry")) (CApp (CApp (CApp (CApp (CVar "Nova.Core.dictInsert") (CVar "eq")) (CVar "key")) (CVar "value")) (CVar "rest")))])])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.setEmpty" (CVar "Lune.Prelude.Nil"),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.setFromList" (CLam [PVar "eq",PVar "xs"] (CApp (CApp (CApp (CVar "Nova.Core.setFromListGo") (CVar "eq")) (CVar "xs")) (CVar "Lune.Prelude.Nil"))),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.setFromListGo" (CLam [PVar "eq",PVar "xs",PVar "acc"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CCase (CApp (CApp (CApp (CVar "Nova.Core.setMember") (CVar "eq")) (CVar "x")) (CVar "acc")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CApp (CVar "Nova.Core.setFromListGo") (CVar "eq")) (CVar "rest")) (CVar "acc")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CVar "Nova.Core.setFromListGo") (CVar "eq")) (CVar "rest")) (CApp (CApp (CApp (CVar "Nova.Core.setInsert") (CVar "eq")) (CVar "x")) (CVar "acc")))])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.setMember" (CLam [PVar "eq",PVar "x",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.False"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "y",PVar "rest"]) (CCase (CApp (CApp (CVar "eq") (CVar "x")) (CVar "y")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CVar "Nova.Core.setMember") (CVar "eq")) (CVar "x")) (CVar "rest"))])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.setInsert" (CLam [PVar "eq",PVar "x",PVar "xs"] (CCase (CApp (CApp (CApp (CVar "Nova.Core.setMember") (CVar "eq")) (CVar "x")) (CVar "xs")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "xs"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "x")) (CVar "xs"))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.providerId" (CLam [PVar "p"] (CCase (CVar "p") [CoreAlt (PCon "Nova.Core.Provider" [PVar "s"]) (CVar "s")])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.eqProvider" (CLam [PVar "a",PVar "b"] (CApp (CApp (CVar "Lune.String.eq") (CApp (CVar "Nova.Core.providerId") (CVar "a"))) (CApp (CVar "Nova.Core.providerId") (CVar "b")))),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.openrouter" (CApp (CVar "Nova.Core.Provider") (CString "openrouter")),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.ollama" (CApp (CVar "Nova.Core.Provider") (CString "ollama")),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.defaultProviderConfig" (CApp (CVar "Nova.Core.dictFromList") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CVar "Nova.Core.openrouter"),("value",CRecord [("baseUrl",CString "https://openrouter.ai/api/v1"),("apiKey",CVar "Lune.Prelude.Nothing"),("appName",CVar "Lune.Prelude.Nothing")])])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CVar "Nova.Core.ollama"),("value",CRecord [("baseUrl",CString "http://localhost:11434"),("apiKey",CVar "Lune.Prelude.Nothing"),("appName",CVar "Lune.Prelude.Nothing")])])) (CVar "Lune.Prelude.Nil")))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.eqCapability" (CLam [PVar "a",PVar "b"] (CCase (CVar "a") [CoreAlt (PCon "Nova.Core.SupportsTools" []) (CCase (CVar "b") [CoreAlt (PCon "Nova.Core.SupportsTools" []) (CVar "Lune.Prelude.True"),CoreAlt PWildcard (CVar "Lune.Prelude.False")]),CoreAlt (PCon "Nova.Core.SupportsStreaming" []) (CCase (CVar "b") [CoreAlt (PCon "Nova.Core.SupportsStreaming" []) (CVar "Lune.Prelude.True"),CoreAlt PWildcard (CVar "Lune.Prelude.False")]),CoreAlt (PCon "Nova.Core.SupportsJsonMode" []) (CCase (CVar "b") [CoreAlt (PCon "Nova.Core.SupportsJsonMode" []) (CVar "Lune.Prelude.True"),CoreAlt PWildcard (CVar "Lune.Prelude.False")])])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.defaultProviderRegistry" (CApp (CVar "Nova.Core.dictFromList") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CVar "Nova.Core.openrouter"),("value",CVar "Nova.Core.openrouterImpl")])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CVar "Nova.Core.ollama"),("value",CVar "Nova.Core.ollamaImpl")])) (CVar "Lune.Prelude.Nil")))),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.callProvider" (CLam [PVar "registry",PVar "cfg",PVar "provider",PVar "model",PVar "prompt"] (CCase (CApp (CApp (CApp (CVar "Nova.Core.dictGet") (CVar "Nova.Core.eqProvider")) (CVar "provider")) (CVar "registry")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Core.ProviderError") (CApp (CApp (CVar "Lune.String.append") (CString "Unknown provider: ")) (CApp (CVar "Nova.Core.providerId") (CVar "provider")))))),CoreAlt (PCon "Lune.Prelude.Just" [PVar "impl"]) (CApp (CApp (CApp (CSelect (CVar "impl") "call") (CVar "cfg")) (CVar "model")) (CVar "prompt"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.getSettings" (CLam [PVar "provider",PVar "cfg"] (CCase (CApp (CApp (CApp (CVar "Nova.Core.dictGet") (CVar "Nova.Core.eqProvider")) (CVar "provider")) (CVar "cfg")) [CoreAlt (PCon "Lune.Prelude.Just" [PVar "s"]) (CVar "s"),CoreAlt (PCon "Lune.Prelude.Nothing" []) (CRecord [("baseUrl",CString ""),("apiKey",CVar "Lune.Prelude.Nothing"),("appName",CVar "Lune.Prelude.Nothing")])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.openrouterImpl" (CRecord [("id",CVar "Nova.Core.openrouter"),("call",CVar "Nova.Core.callOpenRouter"),("capabilities",CApp (CApp (CVar "Nova.Core.setFromList") (CVar "Nova.Core.eqCapability")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "Nova.Core.SupportsJsonMode")) (CVar "Lune.Prelude.Nil")))]),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.ollamaImpl" (CRecord [("id",CVar "Nova.Core.ollama"),("call",CVar "Nova.Core.callOllama"),("capabilities",CVar "Nova.Core.setEmpty")]),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.callOpenRouter" (CLam [PVar "cfg",PWildcard,PWildcard] (CLet "settings" (CApp (CApp (CVar "Nova.Core.getSettings") (CVar "Nova.Core.openrouter")) (CVar "cfg")) (CCase (CSelect (CVar "settings") "apiKey") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Err") (CVar "Nova.Core.Unauthorized"))),CoreAlt (PCon "Lune.Prelude.Just" [PWildcard]) (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Core.ProviderError") (CString "OpenRouter: HTTP client not implemented (v2)."))))]))),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.callOllama" (CLam [PVar "cfg",PVar "modelId",PVar "prompt"] (CLet "settings" (CApp (CApp (CVar "Nova.Core.getSettings") (CVar "Nova.Core.ollama")) (CVar "cfg")) (CCase (CApp (CApp (CVar "Lune.String.startsWith") (CString "mock://")) (CSelect (CVar "settings") "baseUrl")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "prim_ioPure") (CApp (CApp (CVar "Nova.Core.mockOllama") (CVar "modelId")) (CVar "prompt"))),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Core.ProviderError") (CString "Ollama: HTTP client not implemented (v2)."))))]))),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.mockOllama" (CLam [PVar "modelId",PVar "prompt"] (CCase (CApp (CApp (CVar "Lune.String.eq") (CVar "modelId")) (CString "mock-tool-wrapper")) [CoreAlt (PCon "Lune.Prelude.True" []) (CLet "pre" (CApp (CApp (CVar "Nova.Core.countOccurrences") (CString "You must output exactly one JSON value and nothing else.")) (CVar "prompt")) (CLet "post" (CApp (CApp (CVar "Nova.Core.countOccurrences") (CString "Output ONLY JSON now.")) (CVar "prompt")) (CApp (CVar "Lune.Prelude.Ok") (CRecord [("text",CApp (CApp (CVar "Lune.String.append") (CApp (CApp (CVar "Lune.String.append") (CString "[")) (CApp (CVar "Lune.String.fromInt") (CVar "pre")))) (CApp (CApp (CVar "Lune.String.append") (CApp (CApp (CVar "Lune.String.append") (CString ",")) (CApp (CVar "Lune.String.fromInt") (CVar "post")))) (CString "]"))),("usage",CVar "Lune.Prelude.Nothing")])))),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "Lune.String.eq") (CVar "modelId")) (CString "mock-pure")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CRecord [("text",CString "{\"n\":1}"),("usage",CVar "Lune.Prelude.Nothing")])),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "Lune.String.eq") (CVar "modelId")) (CString "mock-prose-prefix")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CRecord [("text",CString "Sure.\n{\"n\":1}"),("usage",CVar "Lune.Prelude.Nothing")])),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "Lune.String.eq") (CVar "modelId")) (CString "mock-prose-suffix")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CRecord [("text",CString "{\"n\":1}\nThanks!"),("usage",CVar "Lune.Prelude.Nothing")])),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "Lune.String.eq") (CVar "modelId")) (CString "mock-invalid")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CRecord [("text",CString "Ok: {not json}"),("usage",CVar "Lune.Prelude.Nothing")])),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "Lune.String.eq") (CVar "modelId")) (CString "mock-no-json")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CRecord [("text",CString "No JSON here."),("usage",CVar "Lune.Prelude.Nothing")])),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Core.ProviderError") (CString "Unknown mock model id.")))])])])])])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.countOccurrences" (CLam [PVar "needle",PVar "haystack"] (CCase (CApp (CVar "Lune.String.isEmpty") (CVar "needle")) [CoreAlt (PCon "Lune.Prelude.True" []) (CInt 0),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CApp (CVar "Nova.Core.countOccurrencesFrom") (CVar "needle")) (CApp (CVar "Lune.String.length") (CVar "needle"))) (CInt 0)) (CVar "haystack"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.countOccurrencesFrom" (CLam [PVar "needle",PVar "needleLen",PVar "acc",PVar "s"] (CCase (CApp (CApp (CVar "Lune.String.indexOf") (CVar "needle")) (CVar "s")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "i"]) (CLet "next" (CApp (CApp (CVar "Lune.String.drop") (CApp (CApp (CVar "Lune.Int.add") (CVar "i")) (CVar "needleLen"))) (CVar "s")) (CApp (CApp (CApp (CApp (CVar "Nova.Core.countOccurrencesFrom") (CVar "needle")) (CVar "needleLen")) (CApp (CApp (CVar "Lune.Int.add") (CVar "acc")) (CInt 1))) (CVar "next")))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Tool.toolId" (CLam [PVar "name",PVar "version"] (CRecord [("name",CVar "name"),("version",CVar "version")])),CoreDecl "" (CInt 0),CoreDecl "Nova.Tool.eqToolId" (CLam [PVar "a",PVar "b"] (CCase (CApp (CApp (CVar "Lune.String.eq") (CSelect (CVar "a") "name")) (CSelect (CVar "b") "name")) [CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.False"),CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.String.eq") (CSelect (CVar "a") "version")) (CSelect (CVar "b") "version"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Tool.toolIdToString" (CLam [PVar "id"] (CApp (CApp (CVar "Lune.String.append") (CSelect (CVar "id") "name")) (CApp (CApp (CVar "Lune.String.append") (CString "@")) (CSelect (CVar "id") "version")))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Tool.decodeJsonString" (CLam [PVar "decoder",PVar "raw"] (CCase (CApp (CVar "Lune.Json.parse") (CVar "raw")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")])),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "json"]) (CApp (CApp (CVar "Lune.Json.Decode.decodeValue") (CVar "decoder")) (CVar "json"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.toolPreamble" (CApp (CVar "Lune.String.unlines") (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "You must output exactly one JSON value and nothing else.")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "Rules:")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "- Output ONLY valid JSON.")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "- No markdown.")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "- No code fences.")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "- No prose or explanations.")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "- No leading or trailing text.")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "- Do not add extra keys beyond the requested schema.")) (CVar "Lune.Prelude.Nil"))))))))))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.toolPostamble" (CApp (CVar "Lune.String.unlines") (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "Output ONLY JSON now.")) (CVar "Lune.Prelude.Nil"))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.composeToolPrompt" (CLam [PVar "spec",PVar "userPrompt"] (CApp (CVar "Lune.String.unlines") (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "Nova.Prompt.toolPreamble")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CApp (CVar "Lune.String.append") (CString "Tool: ")) (CApp (CVar "Nova.Tool.toolIdToString") (CSelect (CVar "spec") "id")))) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CApp (CVar "Lune.String.append") (CString "Description: ")) (CSelect (CVar "spec") "description"))) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CApp (CVar "Lune.String.append") (CString "Schema: ")) (CApp (CVar "Lune.Json.stringify") (CSelect (CVar "spec") "schema")))) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "User:")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "userPrompt")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "Nova.Prompt.toolPostamble")) (CVar "Lune.Prelude.Nil"))))))))))))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.extractJson" (CLam [PVar "s"] (CCase (CApp (CVar "Nova.Prompt.extractJsonTrimmed") (CApp (CVar "Lune.String.trim") (CVar "s"))) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "raw"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "raw")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Core.DecodeError") (CVar "msg")))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.extractJsonTrimmed" (CLam [PVar "t"] (CCase (CApp (CVar "Nova.Prompt.startsLikeJsonContainer") (CVar "t")) [CoreAlt (PCon "Lune.Prelude.True" []) (CCase (CApp (CVar "Nova.Prompt.validateJson") (CVar "t")) [CoreAlt (PCon "Lune.Prelude.Ok" [PWildcard]) (CApp (CVar "Lune.Prelude.Ok") (CVar "t")),CoreAlt (PCon "Lune.Prelude.Err" [PWildcard]) (CApp (CVar "Nova.Prompt.extractViaSlice") (CVar "t"))]),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Nova.Prompt.extractViaSlice") (CVar "t"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.startsLikeJsonContainer" (CLam [PVar "t"] (CCase (CApp (CApp (CVar "Lune.String.startsWith") (CString "{")) (CVar "t")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.String.startsWith") (CString "[")) (CVar "t"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.extractViaSlice" (CLam [PVar "t"] (CCase (CApp (CVar "Nova.Prompt.findJsonSlice") (CVar "t")) [CoreAlt (PCon "Lune.Prelude.Err" [PWildcard]) (CApp (CVar "Lune.Prelude.Err") (CApp (CApp (CVar "Lune.String.append") (CString "Could not find JSON in response: ")) (CApp (CApp (CVar "Nova.Prompt.snippet") (CInt 240)) (CVar "t")))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "raw"]) (CCase (CApp (CVar "Nova.Prompt.validateJson") (CVar "raw")) [CoreAlt (PCon "Lune.Prelude.Ok" [PWildcard]) (CApp (CVar "Lune.Prelude.Ok") (CVar "raw")),CoreAlt (PCon "Lune.Prelude.Err" [PWildcard]) (CApp (CVar "Lune.Prelude.Err") (CApp (CApp (CVar "Lune.String.append") (CString "Could not parse JSON in response: ")) (CApp (CApp (CVar "Nova.Prompt.snippet") (CInt 240)) (CVar "raw"))))])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.validateJson" (CLam [PVar "raw"] (CApp (CVar "Lune.Json.parse") (CVar "raw"))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.findJsonSlice" (CLam [PVar "t"] (CCase (CApp (CVar "Nova.Prompt.firstJsonStart") (CVar "t")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Prelude.Err") (CString "no start")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "start"]) (CCase (CApp (CVar "Nova.Prompt.lastJsonEnd") (CVar "t")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Prelude.Err") (CString "no end")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "end"]) (CCase (CApp (CApp (CVar "Nova.Prompt.ltInt") (CVar "start")) (CVar "end")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CApp (CVar "Nova.Prompt.sliceInclusive") (CVar "start")) (CVar "end")) (CVar "t"))),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Err") (CString "invalid slice"))])])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.firstJsonStart" (CLam [PVar "t"] (CApp (CApp (CVar "Nova.Prompt.minMaybe") (CApp (CApp (CVar "Lune.String.indexOf") (CString "{")) (CVar "t"))) (CApp (CApp (CVar "Lune.String.indexOf") (CString "[")) (CVar "t")))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.lastJsonEnd" (CLam [PVar "t"] (CApp (CApp (CVar "Nova.Prompt.maxMaybe") (CApp (CApp (CVar "Nova.Prompt.lastIndexOfChar") (CApp (CVar "prim_intToChar") (CInt 125))) (CVar "t"))) (CApp (CApp (CVar "Nova.Prompt.lastIndexOfChar") (CApp (CVar "prim_intToChar") (CInt 93))) (CVar "t")))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.lastIndexOfChar" (CLam [PVar "c",PVar "s"] (CApp (CApp (CApp (CApp (CVar "Nova.Prompt.lastIndexOfCharGo") (CVar "c")) (CApp (CVar "Lune.String.toChars") (CVar "s"))) (CInt 0)) (CVar "Lune.Prelude.Nothing"))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.lastIndexOfCharGo" (CLam [PVar "c",PVar "chars",PVar "idx",PVar "last"] (CCase (CVar "chars") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "last"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "xs"]) (CCase (CApp (CApp (CVar "prim_eqInt") (CApp (CVar "prim_charToInt") (CVar "x"))) (CApp (CVar "prim_charToInt") (CVar "c"))) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CApp (CApp (CVar "Nova.Prompt.lastIndexOfCharGo") (CVar "c")) (CVar "xs")) (CApp (CApp (CVar "Lune.Int.add") (CVar "idx")) (CInt 1))) (CApp (CVar "Lune.Prelude.Just") (CVar "idx"))),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CApp (CVar "Nova.Prompt.lastIndexOfCharGo") (CVar "c")) (CVar "xs")) (CApp (CApp (CVar "Lune.Int.add") (CVar "idx")) (CInt 1))) (CVar "last"))])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.minMaybe" (CLam [PVar "a",PVar "b"] (CCase (CVar "a") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "b"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "x"]) (CCase (CVar "b") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "a"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "y"]) (CCase (CApp (CApp (CVar "prim_leInt") (CVar "x")) (CVar "y")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Just") (CVar "x")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Just") (CVar "y"))])])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.maxMaybe" (CLam [PVar "a",PVar "b"] (CCase (CVar "a") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "b"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "x"]) (CCase (CVar "b") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "a"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "y"]) (CCase (CApp (CApp (CVar "prim_leInt") (CVar "x")) (CVar "y")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Just") (CVar "y")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Just") (CVar "x"))])])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.sliceInclusive" (CLam [PVar "start",PVar "end",PVar "s"] (CLet "len" (CApp (CApp (CVar "Lune.Int.add") (CApp (CApp (CVar "Lune.Int.sub") (CVar "end")) (CVar "start"))) (CInt 1)) (CApp (CApp (CVar "Lune.String.take") (CVar "len")) (CApp (CApp (CVar "Lune.String.drop") (CVar "start")) (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.ltInt" (CLam [PVar "a",PVar "b"] (CCase (CApp (CApp (CVar "prim_leInt") (CVar "a")) (CVar "b")) [CoreAlt (PCon "Lune.Prelude.True" []) (CCase (CApp (CApp (CVar "prim_eqInt") (CVar "a")) (CVar "b")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.False"),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.True")]),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.False")])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.snippet" (CLam [PVar "n",PVar "s"] (CCase (CApp (CApp (CVar "prim_leInt") (CApp (CVar "Lune.String.length") (CVar "s"))) (CVar "n")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "s"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.String.append") (CApp (CApp (CVar "Lune.String.take") (CVar "n")) (CVar "s"))) (CString "\8230"))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Fiber.spawn" (CLam [PVar "task"] (CCase (CVar "task") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_ioBind") (CApp (CVar "prim_spawn") (CVar "io"))) (CLam [PVar "fib"] (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CVar "fib"))))))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Fiber.await" (CLam [PVar "fib"] (CApp (CVar "Lune.Prelude.Task") (CApp (CVar "prim_await") (CVar "fib")))),CoreDecl "" (CInt 0),CoreDecl "Lune.Fiber.yield" (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_ioBind") (CVar "prim_yield")) (CLam [PVar "u"] (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CVar "u")))))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Atomic.commit" (CLam [PVar "ma"] (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_ioBind") (CApp (CVar "prim_atomically") (CVar "ma"))) (CLam [PVar "a"] (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))))))),CoreDecl "" (CInt 0),CoreDecl "Lune.Atomic.new" (CVar "prim_newTVar"),CoreDecl "" (CInt 0),CoreDecl "Lune.Atomic.read" (CVar "prim_readTVar"),CoreDecl "" (CInt 0),CoreDecl "Lune.Atomic.write" (CVar "prim_writeTVar"),CoreDecl "" (CInt 0),CoreDecl "Lune.Atomic.wait" (CVar "prim_retry"),CoreDecl "" (CInt 0),CoreDecl "Lune.Atomic.orElse" (CVar "prim_orElse"),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.executeWithGuards" (CLam [PVar "cfg",PVar "spec",PVar "input"] (CApp (CApp (CApp (CApp (CVar "Nova.Runtime.executeWithGuardsUsing") (CVar "cfg")) (CVar "spec")) (CLam [PWildcard] (CApp (CVar "Lune.Task.fail") (CApp (CVar "Nova.Runtime.ToolNotImplemented") (CSelect (CVar "spec") "id"))))) (CVar "input"))),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.executeWithGuardsUsing" (CLam [PVar "cfg",PVar "spec",PVar "exec",PVar "input"] (CCase (CApp (CApp (CVar "Nova.Runtime.guardTool") (CVar "cfg")) (CSelect (CVar "spec") "id")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Task.fail") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PWildcard]) (CApp (CApp (CApp (CVar "Nova.Runtime.withTimeout") (CSelect (CVar "cfg") "toolTimeoutMs")) (CSelect (CVar "spec") "id")) (CApp (CVar "exec") (CVar "input")))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.guardTool" (CLam [PVar "cfg",PVar "toolId"] (CCase (CApp (CApp (CVar "prim_leInt") (CSelect (CVar "cfg") "maxTurns")) (CInt 0)) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Runtime.MaxTurnsExceeded") (CSelect (CVar "cfg") "maxTurns"))),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CApp (CVar "Nova.Core.setMember") (CVar "Nova.Tool.eqToolId")) (CVar "toolId")) (CSelect (CVar "cfg") "allowedTools")) [CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Runtime.ToolNotAllowed") (CVar "toolId"))),CoreAlt (PCon "Lune.Prelude.True" []) (CCase (CApp (CApp (CApp (CVar "Nova.Core.setMember") (CVar "Nova.Tool.eqToolId")) (CVar "toolId")) (CSelect (CVar "cfg") "requireApproval")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Runtime.ApprovalRequired") (CVar "toolId"))),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Ok") (CVar "Lune.Prelude.unit"))])])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.withTimeout" (CLam [PVar "timeoutMs",PVar "toolId",PVar "task"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Atomic.commit") (CApp (CVar "Lune.Atomic.new") (CVar "Lune.Prelude.Nothing")))) (CLam [PVar "resultVar"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Fiber.spawn") (CApp (CApp (CVar "Nova.Runtime.writeToolResult") (CVar "resultVar")) (CVar "task")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Fiber.spawn") (CApp (CApp (CApp (CVar "Nova.Runtime.writeTimeoutResult") (CVar "resultVar")) (CVar "timeoutMs")) (CVar "toolId")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Atomic.commit") (CApp (CVar "Nova.Runtime.awaitJust") (CVar "resultVar")))) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Task.succeed") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Task.fail") (CVar "e"))])))))))))),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.writeToolResult" (CLam [PVar "resultVar",PVar "task"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Task.fromIO") (CApp (CVar "Lune.Task.attempt") (CVar "task")))) (CLam [PVar "r"] (CApp (CVar "Lune.Atomic.commit") (CApp (CApp (CVar "Nova.Runtime.writeIfNothing") (CVar "resultVar")) (CVar "r")))))),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.writeTimeoutResult" (CLam [PVar "resultVar",PVar "timeoutMs",PVar "toolId"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.sleepMs") (CVar "timeoutMs"))) (CLam [PWildcard] (CApp (CVar "Lune.Atomic.commit") (CApp (CApp (CVar "Nova.Runtime.writeIfNothing") (CVar "resultVar")) (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Runtime.ToolTimedOut") (CVar "toolId")))))))),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.writeIfNothing" (CLam [PVar "var",PVar "value"] (CApp (CApp (CSelect (CVar "$dictMonad_STM") "andThen") (CApp (CVar "Lune.Atomic.read") (CVar "var"))) (CLam [PVar "current"] (CCase (CVar "current") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CApp (CVar "Lune.Atomic.write") (CVar "var")) (CApp (CVar "Lune.Prelude.Just") (CVar "value"))),CoreAlt (PCon "Lune.Prelude.Just" [PWildcard]) (CApp (CSelect (CVar "$dictApplicative_STM") "pure") (CVar "Lune.Prelude.unit"))])))),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.awaitJust" (CLam [PVar "var"] (CApp (CApp (CSelect (CVar "$dictMonad_STM") "andThen") (CApp (CVar "Lune.Atomic.read") (CVar "var"))) (CLam [PVar "v"] (CCase (CVar "v") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "Lune.Atomic.wait"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "x"]) (CApp (CSelect (CVar "$dictApplicative_STM") "pure") (CVar "x"))])))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Json.decode" (CLam [PVar "$dictJson.Decode0",PVar "s"] (CCase (CApp (CApp (CVar "Json.decodeDetailed") (CVar "$dictJson.Decode0")) (CVar "s")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CSelect (CVar "err") "message"))])),CoreDecl "" (CInt 0),CoreDecl "Json.decodeDetailed" (CLam [PVar "$dictJson.Decode0",PVar "s"] (CCase (CApp (CVar "Lune.Json.parse") (CVar "s")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")])),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "json"]) (CApp (CApp (CVar "Lune.Json.Decode.decodeValue") (CSelect (CVar "$dictJson.Decode0") "decoder")) (CVar "json"))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.openrouter" (CVar "Nova.Core.openrouter"),CoreDecl "" (CInt 0),CoreDecl "Nova.ollama" (CVar "Nova.Core.ollama"),CoreDecl "" (CInt 0),CoreDecl "Nova.provider" (CLam [PVar "s"] (CApp (CVar "Nova.Core.Provider") (CVar "s"))),CoreDecl "" (CInt 0),CoreDecl "Nova.providerId" (CVar "Nova.Core.providerId"),CoreDecl "" (CInt 0),CoreDecl "Nova.providerEq" (CVar "Nova.eqProvider"),CoreDecl "" (CInt 0),CoreDecl "Nova.showProvider" (CVar "Nova.providerId"),CoreDecl "" (CInt 0),CoreDecl "Nova.showError" (CLam [PVar "e"] (CCase (CVar "e") [CoreAlt (PCon "Nova.Core.NetworkError" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "NetworkError ")) (CVar "msg")),CoreAlt (PCon "Nova.Core.RateLimited" []) (CString "RateLimited"),CoreAlt (PCon "Nova.Core.Unauthorized" []) (CString "Unauthorized"),CoreAlt (PCon "Nova.Core.BadRequest" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "BadRequest ")) (CVar "msg")),CoreAlt (PCon "Nova.Core.ProviderError" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "ProviderError ")) (CVar "msg")),CoreAlt (PCon "Nova.Core.DecodeError" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "DecodeError ")) (CVar "msg"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.showAskResult" (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Nova.showError") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "s"]) (CVar "s")])),CoreDecl "" (CInt 0),CoreDecl "Nova.showJsonResult" (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Nova.showError") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "j"]) (CApp (CVar "Lune.Json.stringify") (CVar "j"))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.newClient" (CLam [PVar "providers",PVar "provider",PVar "model"] (CRecord [("provider",CVar "provider"),("model",CVar "model"),("providerConfig",CVar "Nova.Core.defaultProviderConfig"),("providers",CVar "providers"),("hooks",CVar "Lune.Prelude.Nothing")])),CoreDecl "" (CInt 0),CoreDecl "Nova.defaultClient" (CApp (CApp (CApp (CVar "Nova.newClient") (CVar "Nova.Core.defaultProviderRegistry")) (CVar "Nova.ollama")) (CString "llama3")),CoreDecl "" (CInt 0),CoreDecl "Nova.withProvider" (CLam [PVar "provider",PVar "client"] (CRecord [("provider",CVar "provider"),("model",CSelect (CVar "client") "model"),("providerConfig",CSelect (CVar "client") "providerConfig"),("providers",CSelect (CVar "client") "providers"),("hooks",CSelect (CVar "client") "hooks")])),CoreDecl "" (CInt 0),CoreDecl "Nova.withModel" (CLam [PVar "model",PVar "client"] (CRecord [("provider",CSelect (CVar "client") "provider"),("model",CVar "model"),("providerConfig",CSelect (CVar "client") "providerConfig"),("providers",CSelect (CVar "client") "providers"),("hooks",CSelect (CVar "client") "hooks")])),CoreDecl "" (CInt 0),CoreDecl "Nova.withHooks" (CLam [PVar "hooks",PVar "client"] (CRecord [("provider",CSelect (CVar "client") "provider"),("model",CSelect (CVar "client") "model"),("providerConfig",CSelect (CVar "client") "providerConfig"),("providers",CSelect (CVar "client") "providers"),("hooks",CApp (CVar "Lune.Prelude.Just") (CVar "hooks"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.withoutHooks" (CLam [PVar "client"] (CRecord [("provider",CSelect (CVar "client") "provider"),("model",CSelect (CVar "client") "model"),("providerConfig",CSelect (CVar "client") "providerConfig"),("providers",CSelect (CVar "client") "providers"),("hooks",CVar "Lune.Prelude.Nothing")])),CoreDecl "" (CInt 0),CoreDecl "Nova.eqProvider" (CLam [PVar "a",PVar "b"] (CApp (CApp (CVar "Lune.String.eq") (CApp (CVar "Nova.providerId") (CVar "a"))) (CApp (CVar "Nova.providerId") (CVar "b")))),CoreDecl "" (CInt 0),CoreDecl "Nova.defaultSettings" (CRecord [("baseUrl",CString ""),("apiKey",CVar "Lune.Prelude.Nothing"),("appName",CVar "Lune.Prelude.Nothing")]),CoreDecl "" (CInt 0),CoreDecl "Nova.getSettings" (CLam [PVar "provider",PVar "cfg"] (CCase (CApp (CApp (CApp (CVar "Nova.Core.dictGet") (CVar "Nova.eqProvider")) (CVar "provider")) (CVar "cfg")) [CoreAlt (PCon "Lune.Prelude.Just" [PVar "s"]) (CVar "s"),CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "Nova.defaultSettings")])),CoreDecl "" (CInt 0),CoreDecl "Nova.updateSettings" (CLam [PVar "provider",PVar "f",PVar "client"] (CLet "current" (CApp (CApp (CVar "Nova.getSettings") (CVar "provider")) (CSelect (CVar "client") "providerConfig")) (CLet "next" (CApp (CVar "f") (CVar "current")) (CRecord [("provider",CSelect (CVar "client") "provider"),("model",CSelect (CVar "client") "model"),("providerConfig",CApp (CApp (CApp (CApp (CVar "Nova.Core.dictInsert") (CVar "Nova.eqProvider")) (CVar "provider")) (CVar "next")) (CSelect (CVar "client") "providerConfig")),("providers",CSelect (CVar "client") "providers"),("hooks",CSelect (CVar "client") "hooks")])))),CoreDecl "" (CInt 0),CoreDecl "Nova.withOpenRouterKey" (CLam [PVar "key"] (CApp (CApp (CVar "Nova.updateSettings") (CVar "Nova.openrouter")) (CLam [PVar "s"] (CRecord [("baseUrl",CSelect (CVar "s") "baseUrl"),("apiKey",CApp (CVar "Lune.Prelude.Just") (CVar "key")),("appName",CSelect (CVar "s") "appName")])))),CoreDecl "" (CInt 0),CoreDecl "Nova.withOpenRouterBaseUrl" (CLam [PVar "url"] (CApp (CApp (CVar "Nova.updateSettings") (CVar "Nova.openrouter")) (CLam [PVar "s"] (CRecord [("baseUrl",CVar "url"),("apiKey",CSelect (CVar "s") "apiKey"),("appName",CSelect (CVar "s") "appName")])))),CoreDecl "" (CInt 0),CoreDecl "Nova.withOllamaBaseUrl" (CLam [PVar "url"] (CApp (CApp (CVar "Nova.updateSettings") (CVar "Nova.ollama")) (CLam [PVar "s"] (CRecord [("baseUrl",CVar "url"),("apiKey",CSelect (CVar "s") "apiKey"),("appName",CSelect (CVar "s") "appName")])))),CoreDecl "" (CInt 0),CoreDecl "Nova.toolPreamble" (CVar "Nova.Prompt.toolPreamble"),CoreDecl "" (CInt 0),CoreDecl "Nova.toolPostamble" (CVar "Nova.Prompt.toolPostamble"),CoreDecl "" (CInt 0),CoreDecl "Nova.extractJson" (CVar "Nova.Prompt.extractJson"),CoreDecl "" (CInt 0),CoreDecl "Nova.composeToolPrompt" (CVar "Nova.Prompt.composeToolPrompt"),CoreDecl "" (CInt 0),CoreDecl "Nova.askRaw" (CLam [PVar "client",PVar "prompt"] (CLet "request" (CRecord [("provider",CSelect (CVar "client") "provider"),("model",CSelect (CVar "client") "model"),("prompt",CVar "prompt")]) (CApp (CApp (CVar "Lune.Task.andThen") (CApp (CVar "Nova.liftResult") (CApp (CApp (CApp (CApp (CApp (CVar "Nova.Core.callProvider") (CSelect (CVar "client") "providers")) (CSelect (CVar "client") "providerConfig")) (CSelect (CVar "client") "provider")) (CSelect (CVar "client") "model")) (CVar "prompt")))) (CLam [PVar "response"] (CCase (CSelect (CVar "client") "hooks") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Task.succeed") (CVar "response")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "hooks"]) (CApp (CApp (CVar "Lune.Task.andThen") (CApp (CApp (CVar "Lune.Task.mapError") (CLam [PWildcard] (CApp (CVar "Nova.Core.ProviderError") (CString "hook failed")))) (CApp (CSelect (CVar "hooks") "onTurn") (CRecord [("request",CVar "request"),("response",CVar "response")])))) (CLam [PWildcard] (CApp (CVar "Lune.Task.succeed") (CVar "response"))))]))))),CoreDecl "" (CInt 0),CoreDecl "Nova.liftResult" (CLam [PVar "io"] (CApp (CVar "Lune.Prelude.Task") (CVar "io"))),CoreDecl "" (CInt 0),CoreDecl "Nova.ask" (CLam [PVar "client",PVar "prompt"] (CApp (CApp (CVar "Lune.Task.map") (CLam [PVar "response"] (CSelect (CVar "response") "text"))) (CApp (CApp (CVar "Nova.askRaw") (CVar "client")) (CVar "prompt")))),CoreDecl "" (CInt 0),CoreDecl "Nova.json" (CLam [PVar "$dictJson.Decode0",PVar "client",PVar "prompt"] (CApp (CApp (CVar "Lune.Task.andThen") (CApp (CApp (CVar "Nova.askRaw") (CVar "client")) (CVar "prompt"))) (CLam [PVar "response"] (CCase (CApp (CApp (CVar "Json.decodeDetailed") (CVar "$dictJson.Decode0")) (CSelect (CVar "response") "text")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Task.succeed") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "decodeErr"]) (CApp (CVar "Lune.Task.fail") (CApp (CVar "Nova.Core.DecodeError") (CApp (CVar "Nova.formatDecodeError") (CVar "decodeErr"))))])))),CoreDecl "" (CInt 0),CoreDecl "Nova.tool" (CLam [PVar "$dictJson.Decode0",PVar "client",PVar "prompt"] (CLet "wrapped" (CApp (CVar "Lune.String.unlines") (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "Nova.toolPreamble")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "prompt")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "Nova.toolPostamble")) (CVar "Lune.Prelude.Nil"))))))) (CApp (CApp (CVar "Lune.Task.andThen") (CApp (CApp (CVar "Nova.askRaw") (CVar "client")) (CVar "wrapped"))) (CLam [PVar "response"] (CCase (CApp (CVar "Nova.extractJson") (CSelect (CVar "response") "text")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Task.fail") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "rawJson"]) (CCase (CApp (CApp (CVar "Json.decodeDetailed") (CVar "$dictJson.Decode0")) (CVar "rawJson")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Task.succeed") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "decodeErr"]) (CApp (CVar "Lune.Task.fail") (CApp (CVar "Nova.Core.DecodeError") (CApp (CVar "Nova.formatDecodeError") (CVar "decodeErr"))))])]))))),CoreDecl "" (CInt 0),CoreDecl "Nova.formatDecodeError" (CLam [PVar "err"] (CCase (CSelect (CVar "err") "path") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CSelect (CVar "err") "message"),CoreAlt PWildcard (CApp (CApp (CVar "Lune.String.append") (CSelect (CVar "err") "message")) (CApp (CApp (CVar "Lune.String.append") (CString " at ")) (CApp (CVar "Nova.pathToString") (CSelect (CVar "err") "path"))))])),CoreDecl "" (CInt 0),CoreDecl "Nova.pathToString" (CLam [PVar "path"] (CApp (CApp (CVar "Nova.pathToStringGo") (CString "$")) (CVar "path"))),CoreDecl "" (CInt 0),CoreDecl "Nova.pathToStringGo" (CLam [PVar "acc",PVar "items"] (CCase (CVar "items") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "item",PVar "rest"]) (CApp (CApp (CVar "Nova.pathToStringGo") (CApp (CApp (CVar "Lune.String.append") (CVar "acc")) (CApp (CVar "Nova.pathItemToString") (CVar "item")))) (CVar "rest"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.pathItemToString" (CLam [PVar "item"] (CCase (CVar "item") [CoreAlt (PCon "Lune.Json.Decode.Field" [PVar "name"]) (CApp (CApp (CVar "Lune.String.append") (CString ".")) (CVar "name")),CoreAlt (PCon "Lune.Json.Decode.Index" [PVar "i"]) (CApp (CApp (CVar "Lune.String.append") (CString "[")) (CApp (CApp (CVar "Lune.String.append") (CApp (CVar "Lune.String.fromInt") (CVar "i"))) (CString "]")))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.next" (CLam [PVar "stream"] (CCase (CVar "stream") [CoreAlt (PCon "Nova.Stream" [PVar "io"]) (CVar "io")])),CoreDecl "" (CInt 0),CoreDecl "Nova.streamFromList" (CLam [PVar "xs"] (CApp (CVar "Nova.Stream") (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "Nova.stepFromList") (CVar "xs")))))),CoreDecl "" (CInt 0),CoreDecl "Nova.stepFromList" (CLam [PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Nova.StreamEnd"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CVar "Nova.StreamYield") (CVar "x")) (CApp (CVar "Nova.streamFromList") (CVar "rest")))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.showNovaEvent" (CLam [PVar "ev"] (CCase (CVar "ev") [CoreAlt (PCon "Nova.TextDelta" [PVar "s"]) (CApp (CApp (CVar "Lune.String.append") (CString "TextDelta ")) (CVar "s")),CoreAlt (PCon "Nova.ToolCallDelta" [PWildcard]) (CString "ToolCallDelta"),CoreAlt (PCon "Nova.ToolCallComplete" [PWildcard]) (CString "ToolCallComplete"),CoreAlt (PCon "Nova.UsageFinal" [PWildcard]) (CString "UsageFinal")])),CoreDecl "" (CInt 0),CoreDecl "Nova.showEvent" (CVar "Nova.showNovaEvent"),CoreDecl "" (CInt 0),CoreDecl "Nova.showStreamStep" (CLam [PVar "showA",PVar "step"] (CCase (CVar "step") [CoreAlt (PCon "Nova.StreamEnd" []) (CString "StreamEnd"),CoreAlt (PCon "Nova.StreamYield" [PVar "a",PWildcard]) (CApp (CApp (CVar "Lune.String.append") (CString "StreamYield ")) (CApp (CVar "showA") (CVar "a")))])),CoreDecl "" (CInt 0),CoreDecl "Nova.showStreamResult" (CLam [PVar "showE",PVar "showA",PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CApp (CVar "Lune.String.append") (CString "StreamErr ")) (CApp (CVar "showE") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "step"]) (CApp (CApp (CVar "Nova.showStreamStep") (CVar "showA")) (CVar "step"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.askStream" (CLam [PVar "client",PVar "prompt"] (CApp (CVar "Nova.Stream") (CApp (CApp (CVar "prim_ioBind") (CApp (CVar "Lune.Task.attempt") (CApp (CApp (CVar "Nova.askRaw") (CVar "client")) (CVar "prompt")))) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "response"]) (CApp (CVar "prim_ioPure") (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "Nova.stepFromList") (CApp (CVar "Nova.responseToEvents") (CVar "response")))))]))))),CoreDecl "" (CInt 0),CoreDecl "Nova.responseToEvents" (CLam [PVar "response"] (CLet "chunks" (CApp (CApp (CVar "Nova.chunkText") (CInt 24)) (CSelect (CVar "response") "text")) (CLet "textEvents" (CApp (CApp (CVar "Nova.listMap") (CVar "Nova.TextDelta")) (CVar "chunks")) (CCase (CSelect (CVar "response") "usage") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "textEvents"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "usage"]) (CApp (CApp (CVar "Nova.listAppend") (CVar "textEvents")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "Nova.UsageFinal") (CVar "usage"))) (CVar "Lune.Prelude.Nil")))])))),CoreDecl "" (CInt 0),CoreDecl "Nova.chunkText" (CLam [PVar "chunkSize",PVar "s"] (CCase (CApp (CApp (CVar "prim_leInt") (CVar "chunkSize")) (CInt 0)) [CoreAlt (PCon "Lune.Prelude.True" []) (CCase (CApp (CVar "Lune.String.isEmpty") (CVar "s")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "s")) (CVar "Lune.Prelude.Nil"))]),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "prim_leInt") (CApp (CVar "Lune.String.length") (CVar "s"))) (CVar "chunkSize")) [CoreAlt (PCon "Lune.Prelude.True" []) (CCase (CApp (CVar "Lune.String.isEmpty") (CVar "s")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "s")) (CVar "Lune.Prelude.Nil"))]),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CApp (CVar "Lune.String.take") (CVar "chunkSize")) (CVar "s"))) (CApp (CApp (CVar "Nova.chunkText") (CVar "chunkSize")) (CApp (CApp (CVar "Lune.String.drop") (CVar "chunkSize")) (CVar "s"))))])])),CoreDecl "" (CInt 0),CoreDecl "Nova.listMap" (CLam [PVar "f",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "f") (CVar "x"))) (CApp (CApp (CVar "Nova.listMap") (CVar "f")) (CVar "rest")))])),CoreDecl "" (CInt 0),CoreDecl "Nova.listAppend" (CLam [PVar "xs",PVar "ys"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "ys"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "x")) (CApp (CApp (CVar "Nova.listAppend") (CVar "rest")) (CVar "ys")))])),CoreDecl "" (CInt 0),CoreDecl "Nova.executeTool" (CLam [PVar "client",PVar "runtimeConfig",PVar "spec",PVar "encodeInput",PVar "encodeOutput",PVar "exec",PVar "input"] (CLet "inputJson" (CApp (CVar "encodeInput") (CVar "input")) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CCase (CSelect (CVar "client") "hooks") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Task.succeed") (CVar "Lune.Prelude.unit")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "hooks"]) (CApp (CApp (CVar "Lune.Task.mapError") (CLam [PWildcard] (CApp (CVar "Nova.Runtime.ToolFailed") (CString "hook failed")))) (CApp (CSelect (CVar "hooks") "onToolStart") (CRecord [("tool",CSelect (CVar "spec") "id"),("input",CVar "inputJson")])))])) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Task.fromIO") (CVar "prim_timeNowMicros"))) (CLam [PVar "t0"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Task.fromIO") (CApp (CVar "Lune.Task.attempt") (CApp (CApp (CApp (CApp (CVar "Nova.Runtime.executeWithGuardsUsing") (CVar "runtimeConfig")) (CVar "spec")) (CVar "exec")) (CVar "input"))))) (CLam [PVar "result"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Task.fromIO") (CVar "prim_timeNowMicros"))) (CLam [PVar "t1"] (CLet "durationMs" (CApp (CApp (CVar "Lune.Int.div") (CApp (CApp (CVar "Lune.Int.sub") (CVar "t1")) (CVar "t0"))) (CInt 1000)) (CLet "outputJson" (CCase (CVar "result") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CApp (CVar "encodeOutput") (CVar "b")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Nova.encodeToolExecError") (CVar "e"))]) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CCase (CSelect (CVar "client") "hooks") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Task.succeed") (CVar "Lune.Prelude.unit")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "hooks"]) (CApp (CApp (CVar "Lune.Task.mapError") (CLam [PWildcard] (CApp (CVar "Nova.Runtime.ToolFailed") (CString "hook failed")))) (CApp (CSelect (CVar "hooks") "onToolFinish") (CRecord [("tool",CSelect (CVar "spec") "id"),("output",CVar "outputJson"),("durationMs",CVar "durationMs")])))])) (CLam [PWildcard] (CCase (CVar "result") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CApp (CVar "Lune.Task.succeed") (CVar "b")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Task.fail") (CVar "e"))]))))))))))))))),CoreDecl "" (CInt 0),CoreDecl "Nova.encodeToolExecError" (CLam [PVar "e"] (CApp (CVar "Lune.Json.Encode.object") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "error"),("value",CApp (CVar "Lune.Json.Encode.string") (CApp (CVar "Nova.toolExecErrorToString") (CVar "e")))])) (CVar "Lune.Prelude.Nil")))),CoreDecl "" (CInt 0),CoreDecl "Nova.toolExecErrorToString" (CLam [PVar "e"] (CCase (CVar "e") [CoreAlt (PCon "Nova.Runtime.ToolNotAllowed" [PVar "id"]) (CApp (CApp (CVar "Lune.String.append") (CString "ToolNotAllowed ")) (CApp (CVar "Nova.Tool.toolIdToString") (CVar "id"))),CoreAlt (PCon "Nova.Runtime.ApprovalRequired" [PVar "id"]) (CApp (CApp (CVar "Lune.String.append") (CString "ApprovalRequired ")) (CApp (CVar "Nova.Tool.toolIdToString") (CVar "id"))),CoreAlt (PCon "Nova.Runtime.ToolTimedOut" [PVar "id"]) (CApp (CApp (CVar "Lune.String.append") (CString "ToolTimedOut ")) (CApp (CVar "Nova.Tool.toolIdToString") (CVar "id"))),CoreAlt (PCon "Nova.Runtime.MaxTurnsExceeded" [PVar "n"]) (CApp (CApp (CVar "Lune.String.append") (CString "MaxTurnsExceeded ")) (CApp (CVar "Lune.String.fromInt") (CVar "n"))),CoreAlt (PCon "Nova.Runtime.ToolNotImplemented" [PVar "id"]) (CApp (CApp (CVar "Lune.String.append") (CString "ToolNotImplemented ")) (CApp (CVar "Nova.Tool.toolIdToString") (CVar "id"))),CoreAlt (PCon "Nova.Runtime.ToolFailed" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "ToolFailed ")) (CVar "msg"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.showToolExecResult" (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "n"]) (CApp (CApp (CVar "Lune.String.append") (CString "Ok ")) (CApp (CVar "Lune.String.fromInt") (CVar "n"))),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CApp (CVar "Lune.String.append") (CString "Err ")) (CApp (CVar "Nova.showToolExecError") (CVar "e")))])),CoreDecl "" (CInt 0),CoreDecl "Nova.showToolExecError" (CVar "Nova.toolExecErrorToString"),CoreDecl "" (CInt 0),CoreDecl "NovaDemo.toResult" (CLam [PVar "task"] (CApp (CApp (CVar "Lune.Task.onError") (CApp (CApp (CVar "Lune.Task.map") (CVar "Lune.Prelude.Ok")) (CVar "task"))) (CLam [PVar "e"] (CApp (CVar "Lune.Task.succeed") (CApp (CVar "Lune.Prelude.Err") (CVar "e")))))),CoreDecl "" (CInt 0),CoreDecl "NovaDemo.showError" (CLam [PVar "e"] (CCase (CVar "e") [CoreAlt (PCon "Nova.Core.NetworkError" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "NetworkError ")) (CVar "msg")),CoreAlt (PCon "Nova.Core.RateLimited" []) (CString "RateLimited"),CoreAlt (PCon "Nova.Core.Unauthorized" []) (CString "Unauthorized"),CoreAlt (PCon "Nova.Core.BadRequest" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "BadRequest ")) (CVar "msg")),CoreAlt (PCon "Nova.Core.ProviderError" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "ProviderError ")) (CVar "msg")),CoreAlt (PCon "Nova.Core.DecodeError" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "DecodeError ")) (CVar "msg"))])),CoreDecl "" (CInt 0),CoreDecl "NovaDemo.showAskResult" (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "NovaDemo.showError") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "s"]) (CVar "s")])),CoreDecl "" (CInt 0),CoreDecl "NovaDemo.showJsonResult" (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "NovaDemo.showError") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "j"]) (CApp (CVar "Lune.Json.stringify") (CVar "j"))])),CoreDecl "" (CInt 0),CoreDecl "NovaDemo.main" (CLet "baseClient" (CApp (CApp (CVar "Nova.withOllamaBaseUrl") (CString "mock://")) (CVar "Nova.defaultClient")) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "routing_openrouter_missing_key:"))) (CLam [PWildcard] (CLet "openrouterClient" (CApp (CApp (CVar "Nova.withModel") (CString "x")) (CApp (CApp (CVar "Nova.withProvider") (CVar "Nova.openrouter")) (CVar "baseClient"))) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "NovaDemo.toResult") (CApp (CApp (CVar "Nova.ask") (CVar "openrouterClient")) (CString "hi")))) (CLam [PVar "r1"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CApp (CVar "NovaDemo.showAskResult") (CVar "r1")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "routing_ollama_mock:"))) (CLam [PWildcard] (CLet "pureClient" (CApp (CApp (CVar "Nova.withModel") (CString "mock-pure")) (CApp (CApp (CVar "Nova.withProvider") (CVar "Nova.ollama")) (CVar "baseClient"))) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "NovaDemo.toResult") (CApp (CApp (CVar "Nova.ask") (CVar "pureClient")) (CString "hi")))) (CLam [PVar "r2"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CApp (CVar "NovaDemo.showAskResult") (CVar "r2")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "tool_wrapper_counts:"))) (CLam [PWildcard] (CLet "toolWrapperClient" (CApp (CApp (CVar "Nova.withModel") (CString "mock-tool-wrapper")) (CApp (CApp (CVar "Nova.withProvider") (CVar "Nova.ollama")) (CVar "baseClient"))) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "NovaDemo.toResult") (CApp (CApp (CApp (CVar "Nova.tool") (CVar "$dictJson.Decode_Json")) (CVar "toolWrapperClient")) (CString "user")))) (CLam [PVar "countsR"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CApp (CVar "NovaDemo.showJsonResult") (CVar "countsR")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "json_pure:"))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "NovaDemo.toResult") (CApp (CApp (CApp (CVar "Nova.json") (CVar "$dictJson.Decode_Json")) (CVar "pureClient")) (CString "p")))) (CLam [PVar "jp"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CApp (CVar "NovaDemo.showJsonResult") (CVar "jp")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "tool_pure:"))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "NovaDemo.toResult") (CApp (CApp (CApp (CVar "Nova.tool") (CVar "$dictJson.Decode_Json")) (CVar "pureClient")) (CString "p")))) (CLam [PVar "tp"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CApp (CVar "NovaDemo.showJsonResult") (CVar "tp")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "json_prose_prefix:"))) (CLam [PWildcard] (CLet "prosePrefixClient" (CApp (CApp (CVar "Nova.withModel") (CString "mock-prose-prefix")) (CApp (CApp (CVar "Nova.withProvider") (CVar "Nova.ollama")) (CVar "baseClient"))) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "NovaDemo.toResult") (CApp (CApp (CApp (CVar "Nova.json") (CVar "$dictJson.Decode_Json")) (CVar "prosePrefixClient")) (CString "p")))) (CLam [PVar "jpp"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CApp (CVar "NovaDemo.showJsonResult") (CVar "jpp")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "tool_prose_prefix:"))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "NovaDemo.toResult") (CApp (CApp (CApp (CVar "Nova.tool") (CVar "$dictJson.Decode_Json")) (CVar "prosePrefixClient")) (CString "p")))) (CLam [PVar "tpp"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CApp (CVar "NovaDemo.showJsonResult") (CVar "tpp")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "json_prose_suffix:"))) (CLam [PWildcard] (CLet "proseSuffixClient" (CApp (CApp (CVar "Nova.withModel") (CString "mock-prose-suffix")) (CApp (CApp (CVar "Nova.withProvider") (CVar "Nova.ollama")) (CVar "baseClient"))) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "NovaDemo.toResult") (CApp (CApp (CApp (CVar "Nova.json") (CVar "$dictJson.Decode_Json")) (CVar "proseSuffixClient")) (CString "p")))) (CLam [PVar "jps"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CApp (CVar "NovaDemo.showJsonResult") (CVar "jps")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "tool_prose_suffix:"))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "NovaDemo.toResult") (CApp (CApp (CApp (CVar "Nova.tool") (CVar "$dictJson.Decode_Json")) (CVar "proseSuffixClient")) (CString "p")))) (CLam [PVar "tps"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CApp (CVar "NovaDemo.showJsonResult") (CVar "tps")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "tool_invalid:"))) (CLam [PWildcard] (CLet "invalidClient" (CApp (CApp (CVar "Nova.withModel") (CString "mock-invalid")) (CApp (CApp (CVar "Nova.withProvider") (CVar "Nova.ollama")) (CVar "baseClient"))) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "NovaDemo.toResult") (CApp (CApp (CApp (CVar "Nova.tool") (CVar "$dictJson.Decode_Json")) (CVar "invalidClient")) (CString "p")))) (CLam [PVar "ti"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CApp (CVar "NovaDemo.showJsonResult") (CVar "ti")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "tool_no_json:"))) (CLam [PWildcard] (CLet "noJsonClient" (CApp (CApp (CVar "Nova.withModel") (CString "mock-no-json")) (CApp (CApp (CVar "Nova.withProvider") (CVar "Nova.ollama")) (CVar "baseClient"))) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "NovaDemo.toResult") (CApp (CApp (CApp (CVar "Nova.tool") (CVar "$dictJson.Decode_Json")) (CVar "noJsonClient")) (CString "p")))) (CLam [PVar "tn"] (CApp (CVar "Lune.IO.println") (CApp (CVar "NovaDemo.showJsonResult") (CVar "tn")))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))]}
