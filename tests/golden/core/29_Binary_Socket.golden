CoreModule {coreName = "BinarySocketExample", coreDecls = [CoreDecl "$dictFunctor_IO" (CRecord [("map",CLam [PVar "f",PVar "ma"] (CApp (CApp (CVar "$primIOBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primIOPure") (CApp (CVar "f") (CVar "a"))))))]),CoreDecl "$dictApplicative_IO" (CRecord [("$superFunctor",CVar "$dictFunctor_IO"),("pure",CVar "$primIOPure"),("apply",CLam [PVar "mf",PVar "ma"] (CApp (CApp (CVar "$primIOBind") (CVar "mf")) (CLam [PVar "f"] (CApp (CApp (CVar "$primIOBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primIOPure") (CApp (CVar "f") (CVar "a"))))))))]),CoreDecl "$dictMonad_IO" (CRecord [("$superApplicative",CVar "$dictApplicative_IO"),("andThen",CVar "$primIOBind"),("then",CVar "$primIOThen")]),CoreDecl "$dictFunctor_Result" (CRecord [("map",CLam [PVar "f",PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a")))]))]),CoreDecl "$dictApplicative_Result" (CRecord [("$superFunctor",CVar "$dictFunctor_Result"),("pure",CLam [PVar "a"] (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))),("apply",CLam [PVar "rf",PVar "ra"] (CCase (CVar "rf") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "f"]) (CCase (CVar "ra") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a")))])]))]),CoreDecl "$dictMonad_Result" (CRecord [("$superApplicative",CVar "$dictApplicative_Result"),("andThen",CLam [PVar "m",PVar "k"] (CCase (CVar "m") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "k") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e"))])),("then",CLam [PVar "ra",PVar "rb"] (CCase (CVar "ra") [CoreAlt (PCon "Lune.Prelude.Ok" [PWildcard]) (CVar "rb"),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e"))]))]),CoreDecl "$dictFunctor_STM" (CRecord [("map",CLam [PVar "f",PVar "ma"] (CApp (CApp (CVar "$primSTMBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primSTMPure") (CApp (CVar "f") (CVar "a"))))))]),CoreDecl "$dictApplicative_STM" (CRecord [("$superFunctor",CVar "$dictFunctor_STM"),("pure",CVar "$primSTMPure"),("apply",CLam [PVar "mf",PVar "ma"] (CApp (CApp (CVar "$primSTMBind") (CVar "mf")) (CLam [PVar "f"] (CApp (CApp (CVar "$primSTMBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primSTMPure") (CApp (CVar "f") (CVar "a"))))))))]),CoreDecl "$dictMonad_STM" (CRecord [("$superApplicative",CVar "$dictApplicative_STM"),("andThen",CVar "$primSTMBind"),("then",CLam [PVar "ma",PVar "mb"] (CApp (CApp (CVar "$primSTMBind") (CVar "ma")) (CLam [PWildcard] (CVar "mb"))))]),CoreDecl "$dictFunctor_Api" (CRecord [("map",CLam [PVar "f",PVar "ma"] (CApp (CApp (CVar "prim_apiAndThen") (CLam [PVar "a"] (CApp (CVar "prim_apiPure") (CApp (CVar "f") (CVar "a"))))) (CVar "ma")))]),CoreDecl "$dictApplicative_Api" (CRecord [("$superFunctor",CVar "$dictFunctor_Api"),("pure",CVar "prim_apiPure"),("apply",CLam [PVar "mf",PVar "ma"] (CApp (CApp (CVar "prim_apiAndThen") (CLam [PVar "f"] (CApp (CApp (CVar "prim_apiAndThen") (CLam [PVar "a"] (CApp (CVar "prim_apiPure") (CApp (CVar "f") (CVar "a"))))) (CVar "ma")))) (CVar "mf")))]),CoreDecl "$dictMonad_Api" (CRecord [("$superApplicative",CVar "$dictApplicative_Api"),("andThen",CLam [PVar "ma",PVar "k"] (CApp (CApp (CVar "prim_apiAndThen") (CVar "k")) (CVar "ma"))),("then",CLam [PVar "ma",PVar "mb"] (CApp (CApp (CVar "prim_apiAndThen") (CLam [PWildcard] (CVar "mb"))) (CVar "ma")))]),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Prelude.unit" (CVar "Lune.Prelude.Unit"),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Prelude.fst" (CLam [PVar "p"] (CCase (CVar "p") [CoreAlt (PCon "Lune.Prelude.Pair" [PVar "x",PWildcard]) (CVar "x")])),CoreDecl "" (CInt 0),CoreDecl "Lune.Prelude.snd" (CLam [PVar "p"] (CCase (CVar "p") [CoreAlt (PCon "Lune.Prelude.Pair" [PWildcard,PVar "y"]) (CVar "y")])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.println" (CVar "prim_putStrLn"),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.readLine" (CVar "prim_readLine"),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.readInt" (CVar "prim_readInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.sleepMs" (CVar "prim_sleepMs"),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.readFile" (CVar "prim_readFile"),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.writeFile" (CVar "prim_writeFile"),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.pure" (CLam [PVar "x"] (CApp (CVar "prim_ioPure") (CVar "x"))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Bytes.empty" (CVar "prim_bytesEmpty"),CoreDecl "" (CInt 0),CoreDecl "Lune.Bytes.fromList" (CVar "prim_bytesFromList"),CoreDecl "" (CInt 0),CoreDecl "Lune.Bytes.toList" (CVar "prim_bytesToList"),CoreDecl "" (CInt 0),CoreDecl "Lune.Bytes.fromString" (CVar "prim_bytesFromString"),CoreDecl "" (CInt 0),CoreDecl "Lune.Bytes.toString" (CVar "prim_bytesToString"),CoreDecl "" (CInt 0),CoreDecl "Lune.Bytes.length" (CVar "prim_bytesLength"),CoreDecl "" (CInt 0),CoreDecl "Lune.Bytes.concat" (CVar "prim_bytesConcat"),CoreDecl "" (CInt 0),CoreDecl "Lune.Bytes.slice" (CVar "prim_bytesSlice"),CoreDecl "" (CInt 0),CoreDecl "Lune.Bytes.packInt32BE" (CVar "prim_bytesPackInt32BE"),CoreDecl "" (CInt 0),CoreDecl "Lune.Bytes.unpackInt32BE" (CVar "prim_bytesUnpackInt32BE"),CoreDecl "" (CInt 0),CoreDecl "Lune.Bytes.packInt16BE" (CVar "prim_bytesPackInt16BE"),CoreDecl "" (CInt 0),CoreDecl "Lune.Bytes.unpackInt16BE" (CVar "prim_bytesUnpackInt16BE"),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Net.Socket.listen" (CVar "prim_tcpListen"),CoreDecl "" (CInt 0),CoreDecl "Lune.Net.Socket.accept" (CVar "prim_tcpAccept"),CoreDecl "" (CInt 0),CoreDecl "Lune.Net.Socket.connect" (CVar "prim_tcpConnect"),CoreDecl "" (CInt 0),CoreDecl "Lune.Net.Socket.recv" (CVar "prim_connRecv"),CoreDecl "" (CInt 0),CoreDecl "Lune.Net.Socket.send" (CVar "prim_connSend"),CoreDecl "" (CInt 0),CoreDecl "Lune.Net.Socket.recvBytes" (CVar "prim_connRecvBytes"),CoreDecl "" (CInt 0),CoreDecl "Lune.Net.Socket.sendBytes" (CVar "prim_connSendBytes"),CoreDecl "" (CInt 0),CoreDecl "Lune.Net.Socket.closeConn" (CVar "prim_connClose"),CoreDecl "" (CInt 0),CoreDecl "Lune.Net.Socket.closeSocket" (CVar "prim_socketClose"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.append" (CVar "prim_appendString"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.eq" (CVar "prim_eqString"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.fromInt" (CVar "prim_showInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.fromFloat" (CVar "prim_showFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.toInt" (CVar "prim_parseInt"),CoreDecl "" (CInt 0),CoreDecl "BinarySocketExample.main" (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "=== Binary TCP Socket Example ==="))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString ""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "Binary sockets enable wire protocol implementations."))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString ""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "=== API Overview ==="))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString ""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "sendBytes : Connection -> Bytes -> IO (Result Error Unit)"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "  Send raw bytes over TCP connection"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString ""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "recvBytes : Connection -> Int -> IO (Result Error Bytes)"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "  Receive up to N bytes (returns when data available)"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString ""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "=== Example: Simple Protocol Client ==="))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString ""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "-- Connect to a server"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "result <- Socket.connect \"localhost\" 5000"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "case result of"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "  Err e -> IO.println \"Connection failed\""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "  Ok conn ->"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "    do"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "      -- Build a message with length prefix"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "      let payload = Bytes.fromList [72, 101, 108, 108, 111]  -- \"Hello\""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "      let lenPrefix = Bytes.packInt32BE (Bytes.length payload)"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "      let message = Bytes.concat lenPrefix payload"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString ""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "      -- Send the message"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "      _ <- Socket.sendBytes conn message"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString ""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "      -- Read response length (4 bytes)"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "      lenResult <- Socket.recvBytes conn 4"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "      case lenResult of"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "        Err e -> IO.println \"Read failed\""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "        Ok lenBytes ->"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "          case Bytes.unpackInt32BE lenBytes of"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "            Err e -> IO.println \"Invalid length\""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "            Ok len ->"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "              do"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "                -- Read response payload"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "                payloadResult <- Socket.recvBytes conn len"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "                -- Process response..."))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "                Socket.closeConn conn"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString ""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "=== Use Case: Wire Protocol Implementation ==="))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString ""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "Binary sockets + Bytes enable implementing protocols like:"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "- PostgreSQL wire protocol (message framing)"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "- Redis RESP protocol"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "- Custom binary protocols"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString ""))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString "For TLS-encrypted protocols, use Lune.Net.Tls instead."))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.IO.println") (CString ""))) (CApp (CVar "Lune.IO.println") (CString "Done!")))))))))))))))))))))))))))))))))))))))))))))))))))))]}
