CoreModule {coreName = "HealthAgent", coreDecls = [CoreDecl "$dictFunctor_IO" (CRecord [("map",CLam [PVar "f",PVar "ma"] (CApp (CApp (CVar "$primIOBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primIOPure") (CApp (CVar "f") (CVar "a"))))))]),CoreDecl "$dictApplicative_IO" (CRecord [("$superFunctor",CVar "$dictFunctor_IO"),("pure",CVar "$primIOPure"),("apply",CLam [PVar "mf",PVar "ma"] (CApp (CApp (CVar "$primIOBind") (CVar "mf")) (CLam [PVar "f"] (CApp (CApp (CVar "$primIOBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primIOPure") (CApp (CVar "f") (CVar "a"))))))))]),CoreDecl "$dictMonad_IO" (CRecord [("$superApplicative",CVar "$dictApplicative_IO"),("andThen",CVar "$primIOBind"),("then",CVar "$primIOThen")]),CoreDecl "$dictFunctor_Task" (CRecord [("map",CLam [PVar "f",PVar "ta"] (CCase (CVar "ta") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "$primIOBind") (CVar "io")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a"))))]))))]))]),CoreDecl "$dictApplicative_Task" (CRecord [("$superFunctor",CVar "$dictFunctor_Task"),("pure",CLam [PVar "a"] (CApp (CVar "Lune.Prelude.Task") (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))))),("apply",CLam [PVar "tf",PVar "ta"] (CCase (CVar "tf") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "ioF"]) (CCase (CVar "ta") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "ioA"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "$primIOBind") (CVar "ioF")) (CLam [PVar "rf"] (CCase (CVar "rf") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "f"]) (CApp (CApp (CVar "$primIOBind") (CVar "ioA")) (CLam [PVar "ra"] (CCase (CVar "ra") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a"))))])))]))))])]))]),CoreDecl "$dictMonad_Task" (CRecord [("$superApplicative",CVar "$dictApplicative_Task"),("andThen",CLam [PVar "ta",PVar "k"] (CCase (CVar "ta") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "$primIOBind") (CVar "io")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CVar "k") (CVar "a")) [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io2"]) (CVar "io2")])]))))])),("then",CLam [PVar "ta",PVar "tb"] (CCase (CVar "ta") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "ioA"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "$primIOBind") (CVar "ioA")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "$primIOPure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PWildcard]) (CCase (CVar "tb") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "ioB"]) (CVar "ioB")])]))))]))]),CoreDecl "$dictFunctor_Result" (CRecord [("map",CLam [PVar "f",PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a")))]))]),CoreDecl "$dictApplicative_Result" (CRecord [("$superFunctor",CVar "$dictFunctor_Result"),("pure",CLam [PVar "a"] (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))),("apply",CLam [PVar "rf",PVar "ra"] (CCase (CVar "rf") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "f"]) (CCase (CVar "ra") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a")))])]))]),CoreDecl "$dictMonad_Result" (CRecord [("$superApplicative",CVar "$dictApplicative_Result"),("andThen",CLam [PVar "m",PVar "k"] (CCase (CVar "m") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "k") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e"))])),("then",CLam [PVar "ra",PVar "rb"] (CCase (CVar "ra") [CoreAlt (PCon "Lune.Prelude.Ok" [PWildcard]) (CVar "rb"),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e"))]))]),CoreDecl "$dictFunctor_STM" (CRecord [("map",CLam [PVar "f",PVar "ma"] (CApp (CApp (CVar "$primSTMBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primSTMPure") (CApp (CVar "f") (CVar "a"))))))]),CoreDecl "$dictApplicative_STM" (CRecord [("$superFunctor",CVar "$dictFunctor_STM"),("pure",CVar "$primSTMPure"),("apply",CLam [PVar "mf",PVar "ma"] (CApp (CApp (CVar "$primSTMBind") (CVar "mf")) (CLam [PVar "f"] (CApp (CApp (CVar "$primSTMBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primSTMPure") (CApp (CVar "f") (CVar "a"))))))))]),CoreDecl "$dictMonad_STM" (CRecord [("$superApplicative",CVar "$dictApplicative_STM"),("andThen",CVar "$primSTMBind"),("then",CLam [PVar "ma",PVar "mb"] (CApp (CApp (CVar "$primSTMBind") (CVar "ma")) (CLam [PWildcard] (CVar "mb"))))]),CoreDecl "$dictJson.Decode_Bool" (CRecord [("decoder",CVar "Lune.Json.Decode.bool")]),CoreDecl "$dictJson.Decode_Float" (CRecord [("decoder",CVar "Lune.Json.Decode.float")]),CoreDecl "$dictJson.Decode_Int" (CRecord [("decoder",CVar "Lune.Json.Decode.int")]),CoreDecl "$dictJson.Decode_Json" (CRecord [("decoder",CLam [PVar "j"] (CApp (CVar "Lune.Prelude.Ok") (CVar "j")))]),CoreDecl "$dictJson.Decode_String" (CRecord [("decoder",CVar "Lune.Json.Decode.string")]),CoreDecl "$dictMonoid_Template" (CRecord [("$superSemigroup",CVar "$dictSemigroup_Template"),("mconcat",CLam [PVar "xs"] (CApp (CApp (CApp (CVar "Lune.List.foldl") (CSelect (CVar "$dictSemigroup_Template") "<>")) (CSelect (CVar "$dictMonoid_Template") "mempty")) (CVar "xs"))),("mempty",CVar "Template.empty")]),CoreDecl "$dictSemigroup_Template" (CRecord [("<>",CVar "Template.append")]),CoreDecl "$dictToTemplate_Bool" (CRecord [("toTemplate",CLam [PVar "b"] (CCase (CVar "b") [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Template.text") (CString "True")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Template.text") (CString "False"))]))]),CoreDecl "$dictToTemplate_Char" (CRecord [("toTemplate",CLam [PVar "c"] (CApp (CVar "Template.text") (CApp (CVar "Lune.String.fromChar") (CVar "c"))))]),CoreDecl "$dictToTemplate_Float" (CRecord [("toTemplate",CLam [PVar "n"] (CApp (CVar "Template.text") (CApp (CVar "prim_showFloat") (CVar "n"))))]),CoreDecl "$dictToTemplate_Int" (CRecord [("toTemplate",CLam [PVar "n"] (CApp (CVar "Template.text") (CApp (CVar "prim_showInt") (CVar "n"))))]),CoreDecl "$dictToTemplate_String" (CRecord [("toTemplate",CLam [PVar "s"] (CApp (CVar "Template.text") (CVar "s")))]),CoreDecl "$dictToTemplate_Template" (CRecord [("toTemplate",CLam [PVar "t"] (CVar "t"))]),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Prelude.unit" (CVar "Lune.Prelude.Unit"),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Prelude.fst" (CLam [PVar "p"] (CCase (CVar "p") [CoreAlt (PCon "Lune.Prelude.Pair" [PVar "x",PWildcard]) (CVar "x")])),CoreDecl "" (CInt 0),CoreDecl "Lune.Prelude.snd" (CLam [PVar "p"] (CCase (CVar "p") [CoreAlt (PCon "Lune.Prelude.Pair" [PWildcard,PVar "y"]) (CVar "y")])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.pure" (CLam [PVar "a"] (CApp (CVar "prim_ioPure") (CVar "a"))),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.andThen" (CLam [PVar "io",PVar "f"] (CApp (CApp (CVar "prim_ioBind") (CVar "io")) (CVar "f"))),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.println" (CLam [PVar "s"] (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "Lune.IO.andThen") (CApp (CVar "prim_putStrLn") (CVar "s"))) (CLam [PVar "u"] (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CVar "u"))))))),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.readLine" (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "Lune.IO.andThen") (CVar "prim_readLine")) (CLam [PVar "s"] (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CVar "s")))))),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.readInt" (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "Lune.IO.andThen") (CVar "prim_readInt")) (CLam [PVar "n"] (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CVar "n")))))),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.sleepMs" (CLam [PVar "ms"] (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "Lune.IO.andThen") (CApp (CVar "prim_sleepMs") (CVar "ms"))) (CLam [PVar "u"] (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CVar "u"))))))),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.readFile" (CLam [PVar "path"] (CApp (CVar "Lune.Prelude.Task") (CApp (CVar "prim_readFile") (CVar "path")))),CoreDecl "" (CInt 0),CoreDecl "Lune.IO.writeFile" (CLam [PVar "path",PVar "contents"] (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "prim_writeFile") (CVar "path")) (CVar "contents")))),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.succeed" (CLam [PVar "a"] (CApp (CVar "Lune.Prelude.Task") (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.fail" (CLam [PVar "e"] (CApp (CVar "Lune.Prelude.Task") (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.fromIO" (CLam [PVar "io"] (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "Lune.IO.andThen") (CVar "io")) (CLam [PVar "a"] (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))))))),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.fromResult" (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Task.succeed") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Task.fail") (CVar "e"))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.map" (CLam [PVar "f",PVar "task"] (CCase (CVar "task") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "Lune.IO.andThen") (CVar "io")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a"))))]))))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.andThen" (CLam [PVar "task",PVar "k"] (CCase (CVar "task") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "Lune.IO.andThen") (CVar "io")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CVar "k") (CVar "a")) [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io2"]) (CVar "io2")])]))))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.then" (CLam [PVar "ta",PVar "tb"] (CApp (CApp (CVar "Lune.Task.andThen") (CVar "ta")) (CLam [PWildcard] (CVar "tb")))),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.mapError" (CLam [PVar "f",PVar "task"] (CCase (CVar "task") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "Lune.IO.andThen") (CVar "io")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "f") (CVar "e")))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CVar "a")))]))))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.onError" (CLam [PVar "task",PVar "handler"] (CCase (CVar "task") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "Lune.IO.andThen") (CVar "io")) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CCase (CApp (CVar "handler") (CVar "e")) [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io2"]) (CVar "io2")])]))))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.attempt" (CLam [PVar "task"] (CCase (CVar "task") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CVar "io")])),CoreDecl "" (CInt 0),CoreDecl "Lune.Task.result" (CLam [PVar "task"] (CApp (CApp (CVar "Lune.Task.onError") (CApp (CApp (CVar "Lune.Task.map") (CVar "Lune.Prelude.Ok")) (CVar "task"))) (CLam [PVar "e"] (CApp (CVar "Lune.Task.succeed") (CApp (CVar "Lune.Prelude.Err") (CVar "e")))))),CoreDecl "" (CInt 0),CoreDecl "Lune.Char.toInt" (CVar "prim_charToInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Char.fromInt" (CVar "prim_intToChar"),CoreDecl "" (CInt 0),CoreDecl "Lune.Char.toLower" (CLam [PVar "c"] (CCase (CApp (CApp (CVar "prim_and") (CApp (CApp (CVar "prim_geInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 65))) (CApp (CApp (CVar "prim_leInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 90))) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Char.fromInt") (CApp (CApp (CVar "prim_addInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 32))),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "c")])),CoreDecl "" (CInt 0),CoreDecl "Lune.Char.toUpper" (CLam [PVar "c"] (CCase (CApp (CApp (CVar "prim_and") (CApp (CApp (CVar "prim_geInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 97))) (CApp (CApp (CVar "prim_leInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 122))) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Char.fromInt") (CApp (CApp (CVar "prim_subInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 32))),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "c")])),CoreDecl "" (CInt 0),CoreDecl "Lune.Char.isSpace" (CLam [PVar "c"] (CCase (CApp (CApp (CVar "prim_eqInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 32)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "prim_eqInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 9)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "prim_eqInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 10)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "prim_eqInt") (CApp (CVar "Lune.Char.toInt") (CVar "c"))) (CInt 13)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.False")])])])])),CoreDecl "" (CInt 0),CoreDecl "Lune.Char.eq" (CLam [PVar "a",PVar "b"] (CApp (CApp (CVar "prim_eqInt") (CApp (CVar "Lune.Char.toInt") (CVar "a"))) (CApp (CVar "Lune.Char.toInt") (CVar "b")))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.append" (CVar "prim_appendString"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.eq" (CVar "prim_eqString"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.fromInt" (CVar "prim_showInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.fromFloat" (CVar "prim_showFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.toInt" (CVar "prim_parseInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.toChars" (CVar "prim_stringToChars"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.fromChars" (CVar "prim_charsToString"),CoreDecl "" (CInt 0),CoreDecl "Lune.String.fromChar" (CLam [PVar "c"] (CApp (CVar "Lune.String.fromChars") (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "c")) (CVar "Lune.Prelude.Nil")))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.length" (CLam [PVar "s"] (CApp (CVar "Lune.String.listLength") (CApp (CVar "Lune.String.toChars") (CVar "s")))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.isEmpty" (CLam [PVar "s"] (CCase (CApp (CVar "Lune.String.toChars") (CVar "s")) [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.True"),CoreAlt PWildcard (CVar "Lune.Prelude.False")])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.toLower" (CLam [PVar "s"] (CApp (CVar "Lune.String.fromChars") (CApp (CApp (CVar "Lune.String.listMap") (CVar "Lune.Char.toLower")) (CApp (CVar "Lune.String.toChars") (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.toUpper" (CLam [PVar "s"] (CApp (CVar "Lune.String.fromChars") (CApp (CApp (CVar "Lune.String.listMap") (CVar "Lune.Char.toUpper")) (CApp (CVar "Lune.String.toChars") (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.startsWith" (CLam [PVar "prefix",PVar "s"] (CApp (CApp (CVar "Lune.String.charsStartsWith") (CApp (CVar "Lune.String.toChars") (CVar "prefix"))) (CApp (CVar "Lune.String.toChars") (CVar "s")))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.endsWith" (CLam [PVar "suffix",PVar "s"] (CApp (CApp (CVar "Lune.String.charsStartsWith") (CApp (CVar "Lune.String.listReverse") (CApp (CVar "Lune.String.toChars") (CVar "suffix")))) (CApp (CVar "Lune.String.listReverse") (CApp (CVar "Lune.String.toChars") (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.contains" (CLam [PVar "needle",PVar "haystack"] (CApp (CApp (CVar "Lune.String.charsContains") (CApp (CVar "Lune.String.toChars") (CVar "needle"))) (CApp (CVar "Lune.String.toChars") (CVar "haystack")))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.split" (CLam [PVar "delimiter",PVar "s"] (CCase (CApp (CVar "Lune.String.isEmpty") (CVar "delimiter")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "s")) (CVar "Lune.Prelude.Nil")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CVar "Lune.String.splitHelper") (CApp (CVar "Lune.String.toChars") (CVar "delimiter"))) (CApp (CVar "Lune.String.toChars") (CVar "s"))) (CVar "Lune.Prelude.Nil"))])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.join" (CLam [PVar "sep",PVar "parts"] (CCase (CVar "parts") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CString ""),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "first",PVar "rest"]) (CApp (CApp (CApp (CVar "Lune.String.listFoldl") (CLam [PVar "acc",PVar "x"] (CApp (CApp (CVar "Lune.String.append") (CApp (CApp (CVar "Lune.String.append") (CVar "acc")) (CVar "sep"))) (CVar "x")))) (CVar "first")) (CVar "rest"))])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.trim" (CLam [PVar "s"] (CApp (CVar "Lune.String.trimLeft") (CApp (CVar "Lune.String.trimRight") (CVar "s")))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.trimLeft" (CLam [PVar "s"] (CApp (CVar "Lune.String.fromChars") (CApp (CApp (CVar "Lune.String.dropWhileChars") (CVar "Lune.Char.isSpace")) (CApp (CVar "Lune.String.toChars") (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.trimRight" (CLam [PVar "s"] (CApp (CVar "Lune.String.fromChars") (CApp (CVar "Lune.String.listReverse") (CApp (CApp (CVar "Lune.String.dropWhileChars") (CVar "Lune.Char.isSpace")) (CApp (CVar "Lune.String.listReverse") (CApp (CVar "Lune.String.toChars") (CVar "s"))))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.drop" (CLam [PVar "n",PVar "s"] (CApp (CVar "Lune.String.fromChars") (CApp (CApp (CVar "Lune.String.listDrop") (CVar "n")) (CApp (CVar "Lune.String.toChars") (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.take" (CLam [PVar "n",PVar "s"] (CApp (CVar "Lune.String.fromChars") (CApp (CApp (CVar "Lune.String.listTake") (CVar "n")) (CApp (CVar "Lune.String.toChars") (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.indexOf" (CLam [PVar "needle",PVar "haystack"] (CApp (CApp (CApp (CVar "Lune.String.indexOfHelper") (CApp (CVar "Lune.String.toChars") (CVar "needle"))) (CApp (CVar "Lune.String.toChars") (CVar "haystack"))) (CInt 0))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.lines" (CLam [PVar "s"] (CApp (CApp (CVar "Lune.String.split") (CString "\n")) (CVar "s"))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.unlines" (CLam [PVar "ls"] (CApp (CApp (CVar "Lune.String.join") (CString "\n")) (CVar "ls"))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.charsStartsWith" (CLam [PVar "prefix",PVar "str"] (CCase (CVar "prefix") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "p",PVar "ps"]) (CCase (CVar "str") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.False"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "s",PVar "ss"]) (CCase (CApp (CApp (CVar "Lune.Char.eq") (CVar "p")) (CVar "s")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.String.charsStartsWith") (CVar "ps")) (CVar "ss")),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.False")])])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.charsContains" (CLam [PVar "needle",PVar "haystack"] (CCase (CVar "needle") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.True"),CoreAlt PWildcard (CCase (CVar "haystack") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.False"),CoreAlt (PCon "Lune.Prelude.Cons" [PWildcard,PVar "rest"]) (CCase (CApp (CApp (CVar "Lune.String.charsStartsWith") (CVar "needle")) (CVar "haystack")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.String.charsContains") (CVar "needle")) (CVar "rest"))])])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.splitHelper" (CLam [PVar "delim",PVar "chars",PVar "acc"] (CCase (CVar "chars") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "Lune.String.fromChars") (CApp (CVar "Lune.String.listReverse") (CVar "acc")))) (CVar "Lune.Prelude.Nil")),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "c",PVar "rest"]) (CCase (CApp (CApp (CVar "Lune.String.charsStartsWith") (CVar "delim")) (CVar "chars")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "Lune.String.fromChars") (CApp (CVar "Lune.String.listReverse") (CVar "acc")))) (CApp (CApp (CApp (CVar "Lune.String.splitHelper") (CVar "delim")) (CApp (CApp (CVar "Lune.String.listDrop") (CApp (CVar "Lune.String.listLength") (CVar "delim"))) (CVar "chars"))) (CVar "Lune.Prelude.Nil"))),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CVar "Lune.String.splitHelper") (CVar "delim")) (CVar "rest")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "c")) (CVar "acc")))])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.indexOfHelper" (CLam [PVar "needle",PVar "haystack",PVar "idx"] (CCase (CVar "needle") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CVar "Lune.Prelude.Just") (CVar "idx")),CoreAlt PWildcard (CCase (CVar "haystack") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nothing"),CoreAlt (PCon "Lune.Prelude.Cons" [PWildcard,PVar "rest"]) (CCase (CApp (CApp (CVar "Lune.String.charsStartsWith") (CVar "needle")) (CVar "haystack")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Just") (CVar "idx")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CVar "Lune.String.indexOfHelper") (CVar "needle")) (CVar "rest")) (CApp (CApp (CVar "prim_addInt") (CVar "idx")) (CInt 1)))])])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.dropWhileChars" (CLam [PVar "pred",PVar "chars"] (CCase (CVar "chars") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "c",PVar "rest"]) (CCase (CApp (CVar "pred") (CVar "c")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.String.dropWhileChars") (CVar "pred")) (CVar "rest")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "c")) (CVar "rest"))])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listLength" (CLam [PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CInt 0),CoreAlt (PCon "Lune.Prelude.Cons" [PWildcard,PVar "rest"]) (CApp (CApp (CVar "prim_addInt") (CInt 1)) (CApp (CVar "Lune.String.listLength") (CVar "rest")))])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listMap" (CLam [PVar "f",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "f") (CVar "x"))) (CApp (CApp (CVar "Lune.String.listMap") (CVar "f")) (CVar "rest")))])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listReverse" (CLam [PVar "xs"] (CApp (CApp (CVar "Lune.String.listReverseHelper") (CVar "xs")) (CVar "Lune.Prelude.Nil"))),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listReverseHelper" (CLam [PVar "xs",PVar "acc"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CVar "Lune.String.listReverseHelper") (CVar "rest")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "x")) (CVar "acc")))])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listDrop" (CLam [PVar "n",PVar "xs"] (CCase (CApp (CApp (CVar "prim_leInt") (CVar "n")) (CInt 0)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "xs"),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PWildcard,PVar "rest"]) (CApp (CApp (CVar "Lune.String.listDrop") (CApp (CApp (CVar "prim_subInt") (CVar "n")) (CInt 1))) (CVar "rest"))])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listTake" (CLam [PVar "n",PVar "xs"] (CCase (CApp (CApp (CVar "prim_leInt") (CVar "n")) (CInt 0)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "x")) (CApp (CApp (CVar "Lune.String.listTake") (CApp (CApp (CVar "prim_subInt") (CVar "n")) (CInt 1))) (CVar "rest")))])])),CoreDecl "" (CInt 0),CoreDecl "Lune.String.listFoldl" (CLam [PVar "f",PVar "acc",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CApp (CVar "Lune.String.listFoldl") (CVar "f")) (CApp (CApp (CVar "f") (CVar "acc")) (CVar "x"))) (CVar "rest"))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.add" (CVar "prim_addInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.sub" (CVar "prim_subInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.mul" (CVar "prim_mulInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.div" (CVar "prim_divInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.mod" (CVar "prim_modInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.eq" (CVar "prim_eqInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.gte" (CVar "prim_geInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Int.lte" (CVar "prim_leInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Float.add" (CVar "prim_addFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.Float.sub" (CVar "prim_subFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.Float.mul" (CVar "prim_mulFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.Float.div" (CVar "prim_divFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.Float.eq" (CVar "prim_eqFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.Float.gt" (CVar "prim_gtFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.Float.lt" (CVar "prim_ltFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.Float.gte" (CVar "prim_geFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.Float.lte" (CVar "prim_leFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.Float.fromInt" (CVar "prim_fromIntFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.Float.truncate" (CVar "prim_truncateFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.List.map" (CLam [PVar "f",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "xt"]) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "f") (CVar "x"))) (CApp (CApp (CVar "Lune.List.map") (CVar "f")) (CVar "xt")))])),CoreDecl "" (CInt 0),CoreDecl "Lune.List.foldl" (CLam [PVar "f",PVar "acc",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "xt"]) (CApp (CApp (CApp (CVar "Lune.List.foldl") (CVar "f")) (CApp (CApp (CVar "f") (CVar "acc")) (CVar "x"))) (CVar "xt"))])),CoreDecl "" (CInt 0),CoreDecl "Lune.List.length" (CLam [PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CInt 0),CoreAlt (PCon "Lune.Prelude.Cons" [PWildcard,PVar "xt"]) (CApp (CApp (CVar "Lune.Int.add") (CInt 1)) (CApp (CVar "Lune.List.length") (CVar "xt")))])),CoreDecl "" (CInt 0),CoreDecl "Lune.List.reverse" (CLam [PVar "xs"] (CApp (CApp (CVar "Lune.List.reverseHelper") (CVar "xs")) (CVar "Lune.Prelude.Nil"))),CoreDecl "" (CInt 0),CoreDecl "Lune.List.reverseHelper" (CLam [PVar "xs",PVar "acc"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "xt"]) (CApp (CApp (CVar "Lune.List.reverseHelper") (CVar "xt")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "x")) (CVar "acc")))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.parse" (CVar "prim_jsonParse"),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.stringify" (CVar "prim_jsonStringify"),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.decodeValue" (CLam [PVar "decoder",PVar "json"] (CApp (CVar "decoder") (CVar "json"))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.succeed" (CLam [PVar "value"] (CLam [PWildcard] (CApp (CVar "Lune.Prelude.Ok") (CVar "value")))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.fail" (CLam [PVar "message"] (CLam [PWildcard] (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "message"),("path",CVar "Lune.Prelude.Nil")])))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.bool" (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonToBool") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "b")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")]))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.int" (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonToInt") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "n"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "n")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")]))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.float" (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonToFloat") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "f"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "f")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")]))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.string" (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonToString") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "s"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "s")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")]))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.null" (CLam [PVar "defaultValue"] (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonIsNull") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CVar "defaultValue")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CString "expected null"),("path",CVar "Lune.Prelude.Nil")]))]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.list" (CLam [PVar "elemDecoder"] (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonToArray") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")])),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "elements"]) (CApp (CApp (CApp (CVar "Lune.Json.Decode.decodeList") (CVar "elemDecoder")) (CInt 0)) (CVar "elements"))]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.decodeList" (CLam [PVar "decoder",PVar "idx",PVar "elements"] (CCase (CVar "elements") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CVar "Lune.Prelude.Ok") (CVar "Lune.Prelude.Nil")),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "xs"]) (CCase (CApp (CVar "decoder") (CVar "x")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CApp (CApp (CVar "Lune.Json.Decode.prependPath") (CApp (CVar "Lune.Json.Decode.Index") (CVar "idx"))) (CVar "err"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CApp (CApp (CVar "Lune.Json.Decode.decodeList") (CVar "decoder")) (CApp (CApp (CVar "Lune.Int.add") (CVar "idx")) (CInt 1))) (CVar "xs")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "rest"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "a")) (CVar "rest")))])])])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.maybe" (CLam [PVar "decoder"] (CLam [PVar "json"] (CCase (CApp (CVar "prim_jsonIsNull") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CVar "Lune.Prelude.Nothing")),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CVar "decoder") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "Lune.Prelude.Just") (CVar "a"))),CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err"))])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.field" (CLam [PVar "name",PVar "decoder"] (CLam [PVar "json"] (CCase (CApp (CApp (CVar "prim_jsonGetField") (CVar "name")) (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "Lune.Json.Decode.Field") (CVar "name"))) (CVar "Lune.Prelude.Nil"))])),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "fieldJson"]) (CCase (CApp (CVar "decoder") (CVar "fieldJson")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CApp (CApp (CVar "Lune.Json.Decode.prependPath") (CApp (CVar "Lune.Json.Decode.Field") (CVar "name"))) (CVar "err"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.index" (CLam [PVar "idx",PVar "decoder"] (CLam [PVar "json"] (CCase (CApp (CApp (CVar "prim_jsonGetIndex") (CVar "idx")) (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "Lune.Json.Decode.Index") (CVar "idx"))) (CVar "Lune.Prelude.Nil"))])),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "elemJson"]) (CCase (CApp (CVar "decoder") (CVar "elemJson")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CApp (CApp (CVar "Lune.Json.Decode.prependPath") (CApp (CVar "Lune.Json.Decode.Index") (CVar "idx"))) (CVar "err"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.at" (CLam [PVar "path",PVar "decoder"] (CCase (CVar "path") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "decoder"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "name",PVar "rest"]) (CApp (CApp (CVar "Lune.Json.Decode.field") (CVar "name")) (CApp (CApp (CVar "Lune.Json.Decode.at") (CVar "rest")) (CVar "decoder")))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.map" (CLam [PVar "f",PVar "decoder"] (CLam [PVar "json"] (CCase (CApp (CVar "decoder") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a")))]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.map2" (CLam [PVar "f",PVar "decoderA",PVar "decoderB"] (CLam [PVar "json"] (CCase (CApp (CVar "decoderA") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CVar "decoderB") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CVar "f") (CVar "a")) (CVar "b")))])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.map3" (CLam [PVar "f",PVar "da",PVar "db",PVar "dc"] (CLam [PVar "json"] (CCase (CApp (CVar "da") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CVar "db") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CCase (CApp (CVar "dc") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "c"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CApp (CVar "f") (CVar "a")) (CVar "b")) (CVar "c")))])])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.map4" (CLam [PVar "f",PVar "da",PVar "db",PVar "dc",PVar "dd"] (CLam [PVar "json"] (CCase (CApp (CVar "da") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CVar "db") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CCase (CApp (CVar "dc") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "c"]) (CCase (CApp (CVar "dd") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "d"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CApp (CApp (CVar "f") (CVar "a")) (CVar "b")) (CVar "c")) (CVar "d")))])])])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.map5" (CLam [PVar "fn",PVar "da",PVar "db",PVar "dc",PVar "dd",PVar "de"] (CLam [PVar "json"] (CCase (CApp (CVar "da") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CCase (CApp (CVar "db") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CCase (CApp (CVar "dc") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "c"]) (CCase (CApp (CVar "dd") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "d"]) (CCase (CApp (CVar "de") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "e"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CApp (CApp (CApp (CVar "fn") (CVar "a")) (CVar "b")) (CVar "c")) (CVar "d")) (CVar "e")))])])])])]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.andThen" (CLam [PVar "continuation",PVar "decoder"] (CLam [PVar "json"] (CCase (CApp (CVar "decoder") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CVar "err")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CApp (CVar "continuation") (CVar "a")) (CVar "json"))]))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.oneOf" (CLam [PVar "decoders"] (CLam [PVar "json"] (CApp (CApp (CApp (CVar "Lune.Json.Decode.tryDecoders") (CVar "decoders")) (CRecord [("message",CString "oneOf: no decoders provided"),("path",CVar "Lune.Prelude.Nil")])) (CVar "json")))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.tryDecoders" (CLam [PVar "decoders",PVar "lastErr",PVar "json"] (CCase (CVar "decoders") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CVar "Lune.Prelude.Err") (CVar "lastErr")),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "decoder",PVar "rest"]) (CCase (CApp (CVar "decoder") (CVar "json")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CApp (CApp (CVar "Lune.Json.Decode.tryDecoders") (CVar "rest")) (CVar "err")) (CVar "json"))])])),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Decode.prependPath" (CLam [PVar "item",PVar "err"] (CRecord [("message",CSelect (CVar "err") "message"),("path",CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "item")) (CSelect (CVar "err") "path"))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.null" (CVar "prim_jsonNull"),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.bool" (CVar "prim_jsonBool"),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.int" (CVar "prim_jsonInt"),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.float" (CVar "prim_jsonFloat"),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.string" (CVar "prim_jsonString"),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.list" (CLam [PVar "encoder",PVar "items"] (CApp (CVar "prim_jsonArray") (CApp (CApp (CVar "Lune.List.map") (CVar "encoder")) (CVar "items")))),CoreDecl "" (CInt 0),CoreDecl "Lune.Json.Encode.object" (CLam [PVar "pairs"] (CApp (CVar "prim_jsonObject") (CVar "pairs"))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Template.empty" (CVar "prim_templateEmpty"),CoreDecl "" (CInt 0),CoreDecl "Template.text" (CVar "prim_templateText"),CoreDecl "" (CInt 0),CoreDecl "Template.line" (CVar "prim_templateLine"),CoreDecl "" (CInt 0),CoreDecl "Template.lines" (CVar "prim_templateLines"),CoreDecl "" (CInt 0),CoreDecl "Template.block" (CVar "prim_templateBlock"),CoreDecl "" (CInt 0),CoreDecl "Template.append" (CVar "prim_templateAppend"),CoreDecl "" (CInt 0),CoreDecl "Template.join" (CVar "prim_templateJoin"),CoreDecl "" (CInt 0),CoreDecl "Template.vcat" (CVar "prim_templateVcat"),CoreDecl "" (CInt 0),CoreDecl "Template.hcat" (CVar "prim_templateHcat"),CoreDecl "" (CInt 0),CoreDecl "Template.indent" (CVar "prim_templateIndent"),CoreDecl "" (CInt 0),CoreDecl "Template.ensureNL" (CVar "prim_templateEnsureNL"),CoreDecl "" (CInt 0),CoreDecl "Template.render" (CVar "prim_templateRender"),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.dictEmpty" (CVar "Lune.Prelude.Nil"),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.dictFromList" (CLam [PVar "pairs"] (CVar "pairs")),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.dictGet" (CLam [PVar "eq",PVar "key",PVar "dict"] (CCase (CVar "dict") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nothing"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "entry",PVar "rest"]) (CCase (CApp (CApp (CVar "eq") (CVar "key")) (CSelect (CVar "entry") "key")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Just") (CSelect (CVar "entry") "value")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CVar "Nova.Core.dictGet") (CVar "eq")) (CVar "key")) (CVar "rest"))])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.dictInsert" (CLam [PVar "eq",PVar "key",PVar "value",PVar "dict"] (CCase (CVar "dict") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CVar "key"),("value",CVar "value")])) (CVar "Lune.Prelude.Nil")),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "entry",PVar "rest"]) (CCase (CApp (CApp (CVar "eq") (CVar "key")) (CSelect (CVar "entry") "key")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CVar "key"),("value",CVar "value")])) (CVar "rest")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "entry")) (CApp (CApp (CApp (CApp (CVar "Nova.Core.dictInsert") (CVar "eq")) (CVar "key")) (CVar "value")) (CVar "rest")))])])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.setEmpty" (CVar "Lune.Prelude.Nil"),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.setFromList" (CLam [PVar "eq",PVar "xs"] (CApp (CApp (CApp (CVar "Nova.Core.setFromListGo") (CVar "eq")) (CVar "xs")) (CVar "Lune.Prelude.Nil"))),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.setFromListGo" (CLam [PVar "eq",PVar "xs",PVar "acc"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CCase (CApp (CApp (CApp (CVar "Nova.Core.setMember") (CVar "eq")) (CVar "x")) (CVar "acc")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CApp (CVar "Nova.Core.setFromListGo") (CVar "eq")) (CVar "rest")) (CVar "acc")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CVar "Nova.Core.setFromListGo") (CVar "eq")) (CVar "rest")) (CApp (CApp (CApp (CVar "Nova.Core.setInsert") (CVar "eq")) (CVar "x")) (CVar "acc")))])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.setMember" (CLam [PVar "eq",PVar "x",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.False"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "y",PVar "rest"]) (CCase (CApp (CApp (CVar "eq") (CVar "x")) (CVar "y")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CVar "Nova.Core.setMember") (CVar "eq")) (CVar "x")) (CVar "rest"))])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.setInsert" (CLam [PVar "eq",PVar "x",PVar "xs"] (CCase (CApp (CApp (CApp (CVar "Nova.Core.setMember") (CVar "eq")) (CVar "x")) (CVar "xs")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "xs"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "x")) (CVar "xs"))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.providerId" (CLam [PVar "p"] (CCase (CVar "p") [CoreAlt (PCon "Nova.Core.Provider" [PVar "s"]) (CVar "s")])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.eqProvider" (CLam [PVar "a",PVar "b"] (CApp (CApp (CVar "Lune.String.eq") (CApp (CVar "Nova.Core.providerId") (CVar "a"))) (CApp (CVar "Nova.Core.providerId") (CVar "b")))),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.openrouter" (CApp (CVar "Nova.Core.Provider") (CString "openrouter")),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.ollama" (CApp (CVar "Nova.Core.Provider") (CString "ollama")),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.defaultProviderConfig" (CApp (CVar "Nova.Core.dictFromList") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CVar "Nova.Core.openrouter"),("value",CRecord [("baseUrl",CString "https://openrouter.ai/api/v1"),("apiKey",CVar "Lune.Prelude.Nothing"),("appName",CVar "Lune.Prelude.Nothing")])])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CVar "Nova.Core.ollama"),("value",CRecord [("baseUrl",CString "http://localhost:11434"),("apiKey",CVar "Lune.Prelude.Nothing"),("appName",CVar "Lune.Prelude.Nothing")])])) (CVar "Lune.Prelude.Nil")))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.eqCapability" (CLam [PVar "a",PVar "b"] (CCase (CVar "a") [CoreAlt (PCon "Nova.Core.SupportsTools" []) (CCase (CVar "b") [CoreAlt (PCon "Nova.Core.SupportsTools" []) (CVar "Lune.Prelude.True"),CoreAlt PWildcard (CVar "Lune.Prelude.False")]),CoreAlt (PCon "Nova.Core.SupportsStreaming" []) (CCase (CVar "b") [CoreAlt (PCon "Nova.Core.SupportsStreaming" []) (CVar "Lune.Prelude.True"),CoreAlt PWildcard (CVar "Lune.Prelude.False")]),CoreAlt (PCon "Nova.Core.SupportsJsonMode" []) (CCase (CVar "b") [CoreAlt (PCon "Nova.Core.SupportsJsonMode" []) (CVar "Lune.Prelude.True"),CoreAlt PWildcard (CVar "Lune.Prelude.False")])])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.defaultProviderRegistry" (CApp (CVar "Nova.Core.dictFromList") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CVar "Nova.Core.openrouter"),("value",CVar "Nova.Core.openrouterImpl")])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CVar "Nova.Core.ollama"),("value",CVar "Nova.Core.ollamaImpl")])) (CVar "Lune.Prelude.Nil")))),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.callProvider" (CLam [PVar "registry",PVar "cfg",PVar "provider",PVar "model",PVar "prompt"] (CCase (CApp (CApp (CApp (CVar "Nova.Core.dictGet") (CVar "Nova.Core.eqProvider")) (CVar "provider")) (CVar "registry")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Core.ProviderError") (CApp (CApp (CVar "Lune.String.append") (CString "Unknown provider: ")) (CApp (CVar "Nova.Core.providerId") (CVar "provider")))))),CoreAlt (PCon "Lune.Prelude.Just" [PVar "impl"]) (CApp (CApp (CApp (CSelect (CVar "impl") "call") (CVar "cfg")) (CVar "model")) (CVar "prompt"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.getSettings" (CLam [PVar "provider",PVar "cfg"] (CCase (CApp (CApp (CApp (CVar "Nova.Core.dictGet") (CVar "Nova.Core.eqProvider")) (CVar "provider")) (CVar "cfg")) [CoreAlt (PCon "Lune.Prelude.Just" [PVar "s"]) (CVar "s"),CoreAlt (PCon "Lune.Prelude.Nothing" []) (CRecord [("baseUrl",CString ""),("apiKey",CVar "Lune.Prelude.Nothing"),("appName",CVar "Lune.Prelude.Nothing")])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.openrouterImpl" (CRecord [("id",CVar "Nova.Core.openrouter"),("call",CVar "Nova.Core.callOpenRouter"),("capabilities",CApp (CApp (CVar "Nova.Core.setFromList") (CVar "Nova.Core.eqCapability")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "Nova.Core.SupportsJsonMode")) (CVar "Lune.Prelude.Nil")))]),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.ollamaImpl" (CRecord [("id",CVar "Nova.Core.ollama"),("call",CVar "Nova.Core.callOllama"),("capabilities",CVar "Nova.Core.setEmpty")]),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.callOpenRouter" (CLam [PVar "cfg",PWildcard,PWildcard] (CLet "settings" (CApp (CApp (CVar "Nova.Core.getSettings") (CVar "Nova.Core.openrouter")) (CVar "cfg")) (CCase (CSelect (CVar "settings") "apiKey") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Err") (CVar "Nova.Core.Unauthorized"))),CoreAlt (PCon "Lune.Prelude.Just" [PWildcard]) (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Core.ProviderError") (CString "OpenRouter: HTTP client not implemented (v2)."))))]))),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.callOllama" (CLam [PVar "cfg",PVar "modelId",PVar "prompt"] (CLet "settings" (CApp (CApp (CVar "Nova.Core.getSettings") (CVar "Nova.Core.ollama")) (CVar "cfg")) (CCase (CApp (CApp (CVar "Lune.String.startsWith") (CString "mock://")) (CSelect (CVar "settings") "baseUrl")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.IO.pure") (CApp (CApp (CVar "Nova.Core.mockOllama") (CVar "modelId")) (CVar "prompt"))),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Core.ProviderError") (CString "Ollama: HTTP client not implemented (v2)."))))]))),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.mockOllama" (CLam [PVar "modelId",PVar "prompt"] (CCase (CApp (CApp (CVar "Lune.String.eq") (CVar "modelId")) (CString "mock-tool-wrapper")) [CoreAlt (PCon "Lune.Prelude.True" []) (CLet "pre" (CApp (CApp (CVar "Nova.Core.countOccurrences") (CString "You must output exactly one JSON value and nothing else.")) (CVar "prompt")) (CLet "post" (CApp (CApp (CVar "Nova.Core.countOccurrences") (CString "Output ONLY JSON now.")) (CVar "prompt")) (CApp (CVar "Lune.Prelude.Ok") (CRecord [("text",CApp (CApp (CVar "Lune.String.append") (CApp (CApp (CVar "Lune.String.append") (CString "[")) (CApp (CVar "Lune.String.fromInt") (CVar "pre")))) (CApp (CApp (CVar "Lune.String.append") (CApp (CApp (CVar "Lune.String.append") (CString ",")) (CApp (CVar "Lune.String.fromInt") (CVar "post")))) (CString "]"))),("usage",CVar "Lune.Prelude.Nothing")])))),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "Lune.String.eq") (CVar "modelId")) (CString "mock-pure")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CRecord [("text",CString "{\"n\":1}"),("usage",CVar "Lune.Prelude.Nothing")])),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "Lune.String.eq") (CVar "modelId")) (CString "mock-prose-prefix")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CRecord [("text",CString "Sure.\n{\"n\":1}"),("usage",CVar "Lune.Prelude.Nothing")])),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "Lune.String.eq") (CVar "modelId")) (CString "mock-prose-suffix")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CRecord [("text",CString "{\"n\":1}\nThanks!"),("usage",CVar "Lune.Prelude.Nothing")])),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "Lune.String.eq") (CVar "modelId")) (CString "mock-invalid")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CRecord [("text",CString "Ok: {not json}"),("usage",CVar "Lune.Prelude.Nothing")])),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "Lune.String.eq") (CVar "modelId")) (CString "mock-no-json")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CRecord [("text",CString "No JSON here."),("usage",CVar "Lune.Prelude.Nothing")])),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Core.ProviderError") (CString "Unknown mock model id.")))])])])])])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.countOccurrences" (CLam [PVar "needle",PVar "haystack"] (CCase (CApp (CVar "Lune.String.isEmpty") (CVar "needle")) [CoreAlt (PCon "Lune.Prelude.True" []) (CInt 0),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CApp (CVar "Nova.Core.countOccurrencesFrom") (CVar "needle")) (CApp (CVar "Lune.String.length") (CVar "needle"))) (CInt 0)) (CVar "haystack"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Core.countOccurrencesFrom" (CLam [PVar "needle",PVar "needleLen",PVar "acc",PVar "s"] (CCase (CApp (CApp (CVar "Lune.String.indexOf") (CVar "needle")) (CVar "s")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "i"]) (CLet "next" (CApp (CApp (CVar "Lune.String.drop") (CApp (CApp (CVar "Lune.Int.add") (CVar "i")) (CVar "needleLen"))) (CVar "s")) (CApp (CApp (CApp (CApp (CVar "Nova.Core.countOccurrencesFrom") (CVar "needle")) (CVar "needleLen")) (CApp (CApp (CVar "Lune.Int.add") (CVar "acc")) (CInt 1))) (CVar "next")))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Tool.toolId" (CLam [PVar "name",PVar "version"] (CRecord [("name",CVar "name"),("version",CVar "version")])),CoreDecl "" (CInt 0),CoreDecl "Nova.Tool.eqToolId" (CLam [PVar "a",PVar "b"] (CCase (CApp (CApp (CVar "Lune.String.eq") (CSelect (CVar "a") "name")) (CSelect (CVar "b") "name")) [CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.False"),CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.String.eq") (CSelect (CVar "a") "version")) (CSelect (CVar "b") "version"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Tool.toolIdToString" (CLam [PVar "id"] (CApp (CApp (CVar "Lune.String.append") (CSelect (CVar "id") "name")) (CApp (CApp (CVar "Lune.String.append") (CString "@")) (CSelect (CVar "id") "version")))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Tool.decodeJsonString" (CLam [PVar "decoder",PVar "raw"] (CCase (CApp (CVar "Lune.Json.parse") (CVar "raw")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")])),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "json"]) (CApp (CApp (CVar "Lune.Json.Decode.decodeValue") (CVar "decoder")) (CVar "json"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.toolPreamble" (CApp (CVar "Lune.String.unlines") (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "You must output exactly one JSON value and nothing else.")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "Rules:")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "- Output ONLY valid JSON.")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "- No markdown.")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "- No code fences.")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "- No prose or explanations.")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "- No leading or trailing text.")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "- Do not add extra keys beyond the requested schema.")) (CVar "Lune.Prelude.Nil"))))))))))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.toolPostamble" (CApp (CVar "Lune.String.unlines") (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "Output ONLY JSON now.")) (CVar "Lune.Prelude.Nil"))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.composeToolPrompt" (CLam [PVar "spec",PVar "userPrompt"] (CApp (CVar "Lune.String.unlines") (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "Nova.Prompt.toolPreamble")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CApp (CVar "Lune.String.append") (CString "Tool: ")) (CApp (CVar "Nova.Tool.toolIdToString") (CSelect (CVar "spec") "id")))) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CApp (CVar "Lune.String.append") (CString "Description: ")) (CSelect (CVar "spec") "description"))) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CApp (CVar "Lune.String.append") (CString "Schema: ")) (CApp (CVar "Lune.Json.stringify") (CSelect (CVar "spec") "schema")))) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "User:")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "userPrompt")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "Nova.Prompt.toolPostamble")) (CVar "Lune.Prelude.Nil"))))))))))))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.extractJson" (CLam [PVar "s"] (CCase (CApp (CVar "Nova.Prompt.extractJsonTrimmed") (CApp (CVar "Lune.String.trim") (CVar "s"))) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "raw"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "raw")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Core.DecodeError") (CVar "msg")))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.extractJsonTrimmed" (CLam [PVar "t"] (CCase (CApp (CVar "Nova.Prompt.startsLikeJsonContainer") (CVar "t")) [CoreAlt (PCon "Lune.Prelude.True" []) (CCase (CApp (CVar "Nova.Prompt.validateJson") (CVar "t")) [CoreAlt (PCon "Lune.Prelude.Ok" [PWildcard]) (CApp (CVar "Lune.Prelude.Ok") (CVar "t")),CoreAlt (PCon "Lune.Prelude.Err" [PWildcard]) (CApp (CVar "Nova.Prompt.extractViaSlice") (CVar "t"))]),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Nova.Prompt.extractViaSlice") (CVar "t"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.startsLikeJsonContainer" (CLam [PVar "t"] (CCase (CApp (CApp (CVar "Lune.String.startsWith") (CString "{")) (CVar "t")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.True"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.String.startsWith") (CString "[")) (CVar "t"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.extractViaSlice" (CLam [PVar "t"] (CCase (CApp (CVar "Nova.Prompt.findJsonSlice") (CVar "t")) [CoreAlt (PCon "Lune.Prelude.Err" [PWildcard]) (CApp (CVar "Lune.Prelude.Err") (CApp (CApp (CVar "Lune.String.append") (CString "Could not find JSON in response: ")) (CApp (CApp (CVar "Nova.Prompt.snippet") (CInt 240)) (CVar "t")))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "raw"]) (CCase (CApp (CVar "Nova.Prompt.validateJson") (CVar "raw")) [CoreAlt (PCon "Lune.Prelude.Ok" [PWildcard]) (CApp (CVar "Lune.Prelude.Ok") (CVar "raw")),CoreAlt (PCon "Lune.Prelude.Err" [PWildcard]) (CApp (CVar "Lune.Prelude.Err") (CApp (CApp (CVar "Lune.String.append") (CString "Could not parse JSON in response: ")) (CApp (CApp (CVar "Nova.Prompt.snippet") (CInt 240)) (CVar "raw"))))])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.validateJson" (CLam [PVar "raw"] (CApp (CVar "Lune.Json.parse") (CVar "raw"))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.findJsonSlice" (CLam [PVar "t"] (CCase (CApp (CVar "Nova.Prompt.firstJsonStart") (CVar "t")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Prelude.Err") (CString "no start")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "start"]) (CCase (CApp (CVar "Nova.Prompt.lastJsonEnd") (CVar "t")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Prelude.Err") (CString "no end")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "end"]) (CCase (CApp (CApp (CVar "Nova.Prompt.ltInt") (CVar "start")) (CVar "end")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CApp (CVar "Nova.Prompt.sliceInclusive") (CVar "start")) (CVar "end")) (CVar "t"))),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Err") (CString "invalid slice"))])])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.firstJsonStart" (CLam [PVar "t"] (CApp (CApp (CVar "Nova.Prompt.minMaybe") (CApp (CApp (CVar "Lune.String.indexOf") (CString "{")) (CVar "t"))) (CApp (CApp (CVar "Lune.String.indexOf") (CString "[")) (CVar "t")))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.lastJsonEnd" (CLam [PVar "t"] (CApp (CApp (CVar "Nova.Prompt.maxMaybe") (CApp (CApp (CVar "Nova.Prompt.lastIndexOfChar") (CApp (CVar "prim_intToChar") (CInt 125))) (CVar "t"))) (CApp (CApp (CVar "Nova.Prompt.lastIndexOfChar") (CApp (CVar "prim_intToChar") (CInt 93))) (CVar "t")))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.lastIndexOfChar" (CLam [PVar "c",PVar "s"] (CApp (CApp (CApp (CApp (CVar "Nova.Prompt.lastIndexOfCharGo") (CVar "c")) (CApp (CVar "Lune.String.toChars") (CVar "s"))) (CInt 0)) (CVar "Lune.Prelude.Nothing"))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.lastIndexOfCharGo" (CLam [PVar "c",PVar "chars",PVar "idx",PVar "last"] (CCase (CVar "chars") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "last"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "xs"]) (CCase (CApp (CApp (CVar "prim_eqInt") (CApp (CVar "prim_charToInt") (CVar "x"))) (CApp (CVar "prim_charToInt") (CVar "c"))) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CApp (CApp (CVar "Nova.Prompt.lastIndexOfCharGo") (CVar "c")) (CVar "xs")) (CApp (CApp (CVar "Lune.Int.add") (CVar "idx")) (CInt 1))) (CApp (CVar "Lune.Prelude.Just") (CVar "idx"))),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CApp (CVar "Nova.Prompt.lastIndexOfCharGo") (CVar "c")) (CVar "xs")) (CApp (CApp (CVar "Lune.Int.add") (CVar "idx")) (CInt 1))) (CVar "last"))])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.minMaybe" (CLam [PVar "a",PVar "b"] (CCase (CVar "a") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "b"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "x"]) (CCase (CVar "b") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "a"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "y"]) (CCase (CApp (CApp (CVar "prim_leInt") (CVar "x")) (CVar "y")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Just") (CVar "x")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Just") (CVar "y"))])])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.maxMaybe" (CLam [PVar "a",PVar "b"] (CCase (CVar "a") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "b"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "x"]) (CCase (CVar "b") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "a"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "y"]) (CCase (CApp (CApp (CVar "prim_leInt") (CVar "x")) (CVar "y")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Just") (CVar "y")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Just") (CVar "x"))])])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.sliceInclusive" (CLam [PVar "start",PVar "end",PVar "s"] (CLet "len" (CApp (CApp (CVar "Lune.Int.add") (CApp (CApp (CVar "Lune.Int.sub") (CVar "end")) (CVar "start"))) (CInt 1)) (CApp (CApp (CVar "Lune.String.take") (CVar "len")) (CApp (CApp (CVar "Lune.String.drop") (CVar "start")) (CVar "s"))))),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.ltInt" (CLam [PVar "a",PVar "b"] (CCase (CApp (CApp (CVar "prim_leInt") (CVar "a")) (CVar "b")) [CoreAlt (PCon "Lune.Prelude.True" []) (CCase (CApp (CApp (CVar "prim_eqInt") (CVar "a")) (CVar "b")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.False"),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.True")]),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.False")])),CoreDecl "" (CInt 0),CoreDecl "Nova.Prompt.snippet" (CLam [PVar "n",PVar "s"] (CCase (CApp (CApp (CVar "prim_leInt") (CApp (CVar "Lune.String.length") (CVar "s"))) (CVar "n")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "s"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.String.append") (CApp (CApp (CVar "Lune.String.take") (CVar "n")) (CVar "s"))) (CString "\8230"))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Fiber.spawn" (CLam [PVar "task"] (CCase (CVar "task") [CoreAlt (PCon "Lune.Prelude.Task" [PVar "io"]) (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "Lune.IO.andThen") (CApp (CVar "prim_spawn") (CVar "io"))) (CLam [PVar "fib"] (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CVar "fib"))))))])),CoreDecl "" (CInt 0),CoreDecl "Lune.Fiber.await" (CLam [PVar "fib"] (CApp (CVar "Lune.Prelude.Task") (CApp (CVar "prim_await") (CVar "fib")))),CoreDecl "" (CInt 0),CoreDecl "Lune.Fiber.yield" (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "Lune.IO.andThen") (CVar "prim_yield")) (CLam [PVar "u"] (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CVar "u")))))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Lune.Atomic.commit" (CLam [PVar "ma"] (CApp (CVar "Lune.Prelude.Task") (CApp (CApp (CVar "Lune.IO.andThen") (CApp (CVar "prim_atomically") (CVar "ma"))) (CLam [PVar "a"] (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))))))),CoreDecl "" (CInt 0),CoreDecl "Lune.Atomic.new" (CVar "prim_newTVar"),CoreDecl "" (CInt 0),CoreDecl "Lune.Atomic.read" (CVar "prim_readTVar"),CoreDecl "" (CInt 0),CoreDecl "Lune.Atomic.write" (CVar "prim_writeTVar"),CoreDecl "" (CInt 0),CoreDecl "Lune.Atomic.wait" (CVar "prim_retry"),CoreDecl "" (CInt 0),CoreDecl "Lune.Atomic.orElse" (CVar "prim_orElse"),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.executeWithGuards" (CLam [PVar "cfg",PVar "spec",PVar "input"] (CApp (CApp (CApp (CApp (CVar "Nova.Runtime.executeWithGuardsUsing") (CVar "cfg")) (CVar "spec")) (CLam [PWildcard] (CApp (CVar "Lune.Task.fail") (CApp (CVar "Nova.Runtime.ToolNotImplemented") (CSelect (CVar "spec") "id"))))) (CVar "input"))),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.executeWithGuardsUsing" (CLam [PVar "cfg",PVar "spec",PVar "exec",PVar "input"] (CCase (CApp (CApp (CVar "Nova.Runtime.guardTool") (CVar "cfg")) (CSelect (CVar "spec") "id")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Task.fail") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PWildcard]) (CApp (CApp (CApp (CVar "Nova.Runtime.withTimeout") (CSelect (CVar "cfg") "toolTimeoutMs")) (CSelect (CVar "spec") "id")) (CApp (CVar "exec") (CVar "input")))])),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.guardTool" (CLam [PVar "cfg",PVar "toolId"] (CCase (CApp (CApp (CVar "prim_leInt") (CSelect (CVar "cfg") "maxTurns")) (CInt 0)) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Runtime.MaxTurnsExceeded") (CSelect (CVar "cfg") "maxTurns"))),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CApp (CVar "Nova.Core.setMember") (CVar "Nova.Tool.eqToolId")) (CVar "toolId")) (CSelect (CVar "cfg") "allowedTools")) [CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Runtime.ToolNotAllowed") (CVar "toolId"))),CoreAlt (PCon "Lune.Prelude.True" []) (CCase (CApp (CApp (CApp (CVar "Nova.Core.setMember") (CVar "Nova.Tool.eqToolId")) (CVar "toolId")) (CSelect (CVar "cfg") "requireApproval")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Runtime.ApprovalRequired") (CVar "toolId"))),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CVar "Lune.Prelude.Ok") (CVar "Lune.Prelude.unit"))])])])),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.withTimeout" (CLam [PVar "timeoutMs",PVar "toolId",PVar "task"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Atomic.commit") (CApp (CVar "Lune.Atomic.new") (CVar "Lune.Prelude.Nothing")))) (CLam [PVar "resultVar"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Fiber.spawn") (CApp (CApp (CVar "Nova.Runtime.writeToolResult") (CVar "resultVar")) (CVar "task")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Fiber.spawn") (CApp (CApp (CApp (CVar "Nova.Runtime.writeTimeoutResult") (CVar "resultVar")) (CVar "timeoutMs")) (CVar "toolId")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Atomic.commit") (CApp (CVar "Nova.Runtime.awaitJust") (CVar "resultVar")))) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Task.succeed") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Task.fail") (CVar "e"))])))))))))),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.writeToolResult" (CLam [PVar "resultVar",PVar "task"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Task.fromIO") (CApp (CVar "Lune.Task.attempt") (CVar "task")))) (CLam [PVar "r"] (CApp (CVar "Lune.Atomic.commit") (CApp (CApp (CVar "Nova.Runtime.writeIfNothing") (CVar "resultVar")) (CVar "r")))))),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.writeTimeoutResult" (CLam [PVar "resultVar",PVar "timeoutMs",PVar "toolId"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.sleepMs") (CVar "timeoutMs"))) (CLam [PWildcard] (CApp (CVar "Lune.Atomic.commit") (CApp (CApp (CVar "Nova.Runtime.writeIfNothing") (CVar "resultVar")) (CApp (CVar "Lune.Prelude.Err") (CApp (CVar "Nova.Runtime.ToolTimedOut") (CVar "toolId")))))))),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.writeIfNothing" (CLam [PVar "var",PVar "value"] (CApp (CApp (CSelect (CVar "$dictMonad_STM") "andThen") (CApp (CVar "Lune.Atomic.read") (CVar "var"))) (CLam [PVar "current"] (CCase (CVar "current") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CApp (CVar "Lune.Atomic.write") (CVar "var")) (CApp (CVar "Lune.Prelude.Just") (CVar "value"))),CoreAlt (PCon "Lune.Prelude.Just" [PWildcard]) (CApp (CSelect (CVar "$dictApplicative_STM") "pure") (CVar "Lune.Prelude.unit"))])))),CoreDecl "" (CInt 0),CoreDecl "Nova.Runtime.awaitJust" (CLam [PVar "var"] (CApp (CApp (CSelect (CVar "$dictMonad_STM") "andThen") (CApp (CVar "Lune.Atomic.read") (CVar "var"))) (CLam [PVar "v"] (CCase (CVar "v") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "Lune.Atomic.wait"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "x"]) (CApp (CSelect (CVar "$dictApplicative_STM") "pure") (CVar "x"))])))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Json.decode" (CLam [PVar "$dictJson.Decode0",PVar "s"] (CCase (CApp (CApp (CVar "Json.decodeDetailed") (CVar "$dictJson.Decode0")) (CVar "s")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "err"]) (CApp (CVar "Lune.Prelude.Err") (CSelect (CVar "err") "message"))])),CoreDecl "" (CInt 0),CoreDecl "Json.decodeDetailed" (CLam [PVar "$dictJson.Decode0",PVar "s"] (CCase (CApp (CVar "Lune.Json.parse") (CVar "s")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CRecord [("message",CVar "msg"),("path",CVar "Lune.Prelude.Nil")])),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "json"]) (CApp (CApp (CVar "Lune.Json.Decode.decodeValue") (CSelect (CVar "$dictJson.Decode0") "decoder")) (CVar "json"))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.openrouter" (CVar "Nova.Core.openrouter"),CoreDecl "" (CInt 0),CoreDecl "Nova.ollama" (CVar "Nova.Core.ollama"),CoreDecl "" (CInt 0),CoreDecl "Nova.provider" (CLam [PVar "s"] (CApp (CVar "Nova.Core.Provider") (CVar "s"))),CoreDecl "" (CInt 0),CoreDecl "Nova.providerId" (CVar "Nova.Core.providerId"),CoreDecl "" (CInt 0),CoreDecl "Nova.providerEq" (CVar "Nova.eqProvider"),CoreDecl "" (CInt 0),CoreDecl "Nova.showProvider" (CVar "Nova.providerId"),CoreDecl "" (CInt 0),CoreDecl "Nova.showError" (CLam [PVar "e"] (CCase (CVar "e") [CoreAlt (PCon "Nova.Core.NetworkError" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "NetworkError ")) (CVar "msg")),CoreAlt (PCon "Nova.Core.RateLimited" []) (CString "RateLimited"),CoreAlt (PCon "Nova.Core.Unauthorized" []) (CString "Unauthorized"),CoreAlt (PCon "Nova.Core.BadRequest" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "BadRequest ")) (CVar "msg")),CoreAlt (PCon "Nova.Core.ProviderError" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "ProviderError ")) (CVar "msg")),CoreAlt (PCon "Nova.Core.DecodeError" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "DecodeError ")) (CVar "msg"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.showAskResult" (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Nova.showError") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "s"]) (CVar "s")])),CoreDecl "" (CInt 0),CoreDecl "Nova.showJsonResult" (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Nova.showError") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "j"]) (CApp (CVar "Lune.Json.stringify") (CVar "j"))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.newClient" (CLam [PVar "providers",PVar "provider",PVar "model"] (CRecord [("provider",CVar "provider"),("model",CVar "model"),("providerConfig",CVar "Nova.Core.defaultProviderConfig"),("providers",CVar "providers"),("hooks",CVar "Lune.Prelude.Nothing")])),CoreDecl "" (CInt 0),CoreDecl "Nova.defaultClient" (CApp (CApp (CApp (CVar "Nova.newClient") (CVar "Nova.Core.defaultProviderRegistry")) (CVar "Nova.ollama")) (CString "llama3")),CoreDecl "" (CInt 0),CoreDecl "Nova.withProvider" (CLam [PVar "provider",PVar "client"] (CRecord [("provider",CVar "provider"),("model",CSelect (CVar "client") "model"),("providerConfig",CSelect (CVar "client") "providerConfig"),("providers",CSelect (CVar "client") "providers"),("hooks",CSelect (CVar "client") "hooks")])),CoreDecl "" (CInt 0),CoreDecl "Nova.withModel" (CLam [PVar "model",PVar "client"] (CRecord [("provider",CSelect (CVar "client") "provider"),("model",CVar "model"),("providerConfig",CSelect (CVar "client") "providerConfig"),("providers",CSelect (CVar "client") "providers"),("hooks",CSelect (CVar "client") "hooks")])),CoreDecl "" (CInt 0),CoreDecl "Nova.withHooks" (CLam [PVar "hooks",PVar "client"] (CRecord [("provider",CSelect (CVar "client") "provider"),("model",CSelect (CVar "client") "model"),("providerConfig",CSelect (CVar "client") "providerConfig"),("providers",CSelect (CVar "client") "providers"),("hooks",CApp (CVar "Lune.Prelude.Just") (CVar "hooks"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.withoutHooks" (CLam [PVar "client"] (CRecord [("provider",CSelect (CVar "client") "provider"),("model",CSelect (CVar "client") "model"),("providerConfig",CSelect (CVar "client") "providerConfig"),("providers",CSelect (CVar "client") "providers"),("hooks",CVar "Lune.Prelude.Nothing")])),CoreDecl "" (CInt 0),CoreDecl "Nova.eqProvider" (CLam [PVar "a",PVar "b"] (CApp (CApp (CVar "Lune.String.eq") (CApp (CVar "Nova.providerId") (CVar "a"))) (CApp (CVar "Nova.providerId") (CVar "b")))),CoreDecl "" (CInt 0),CoreDecl "Nova.defaultSettings" (CRecord [("baseUrl",CString ""),("apiKey",CVar "Lune.Prelude.Nothing"),("appName",CVar "Lune.Prelude.Nothing")]),CoreDecl "" (CInt 0),CoreDecl "Nova.getSettings" (CLam [PVar "provider",PVar "cfg"] (CCase (CApp (CApp (CApp (CVar "Nova.Core.dictGet") (CVar "Nova.eqProvider")) (CVar "provider")) (CVar "cfg")) [CoreAlt (PCon "Lune.Prelude.Just" [PVar "s"]) (CVar "s"),CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "Nova.defaultSettings")])),CoreDecl "" (CInt 0),CoreDecl "Nova.updateSettings" (CLam [PVar "provider",PVar "f",PVar "client"] (CLet "current" (CApp (CApp (CVar "Nova.getSettings") (CVar "provider")) (CSelect (CVar "client") "providerConfig")) (CLet "next" (CApp (CVar "f") (CVar "current")) (CRecord [("provider",CSelect (CVar "client") "provider"),("model",CSelect (CVar "client") "model"),("providerConfig",CApp (CApp (CApp (CApp (CVar "Nova.Core.dictInsert") (CVar "Nova.eqProvider")) (CVar "provider")) (CVar "next")) (CSelect (CVar "client") "providerConfig")),("providers",CSelect (CVar "client") "providers"),("hooks",CSelect (CVar "client") "hooks")])))),CoreDecl "" (CInt 0),CoreDecl "Nova.withOpenRouterKey" (CLam [PVar "key"] (CApp (CApp (CVar "Nova.updateSettings") (CVar "Nova.openrouter")) (CLam [PVar "s"] (CRecord [("baseUrl",CSelect (CVar "s") "baseUrl"),("apiKey",CApp (CVar "Lune.Prelude.Just") (CVar "key")),("appName",CSelect (CVar "s") "appName")])))),CoreDecl "" (CInt 0),CoreDecl "Nova.withOpenRouterBaseUrl" (CLam [PVar "url"] (CApp (CApp (CVar "Nova.updateSettings") (CVar "Nova.openrouter")) (CLam [PVar "s"] (CRecord [("baseUrl",CVar "url"),("apiKey",CSelect (CVar "s") "apiKey"),("appName",CSelect (CVar "s") "appName")])))),CoreDecl "" (CInt 0),CoreDecl "Nova.withOllamaBaseUrl" (CLam [PVar "url"] (CApp (CApp (CVar "Nova.updateSettings") (CVar "Nova.ollama")) (CLam [PVar "s"] (CRecord [("baseUrl",CVar "url"),("apiKey",CSelect (CVar "s") "apiKey"),("appName",CSelect (CVar "s") "appName")])))),CoreDecl "" (CInt 0),CoreDecl "Nova.toolPreamble" (CVar "Nova.Prompt.toolPreamble"),CoreDecl "" (CInt 0),CoreDecl "Nova.toolPostamble" (CVar "Nova.Prompt.toolPostamble"),CoreDecl "" (CInt 0),CoreDecl "Nova.extractJson" (CVar "Nova.Prompt.extractJson"),CoreDecl "" (CInt 0),CoreDecl "Nova.composeToolPrompt" (CVar "Nova.Prompt.composeToolPrompt"),CoreDecl "" (CInt 0),CoreDecl "Nova.askRaw" (CLam [PVar "client",PVar "prompt"] (CLet "request" (CRecord [("provider",CSelect (CVar "client") "provider"),("model",CSelect (CVar "client") "model"),("prompt",CVar "prompt")]) (CApp (CApp (CVar "Lune.Task.andThen") (CApp (CVar "Nova.liftResult") (CApp (CApp (CApp (CApp (CApp (CVar "Nova.Core.callProvider") (CSelect (CVar "client") "providers")) (CSelect (CVar "client") "providerConfig")) (CSelect (CVar "client") "provider")) (CSelect (CVar "client") "model")) (CVar "prompt")))) (CLam [PVar "response"] (CCase (CSelect (CVar "client") "hooks") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Task.succeed") (CVar "response")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "hooks"]) (CApp (CApp (CVar "Lune.Task.andThen") (CApp (CApp (CVar "Lune.Task.mapError") (CLam [PWildcard] (CApp (CVar "Nova.Core.ProviderError") (CString "hook failed")))) (CApp (CSelect (CVar "hooks") "onTurn") (CRecord [("request",CVar "request"),("response",CVar "response")])))) (CLam [PWildcard] (CApp (CVar "Lune.Task.succeed") (CVar "response"))))]))))),CoreDecl "" (CInt 0),CoreDecl "Nova.liftResult" (CLam [PVar "io"] (CApp (CVar "Lune.Prelude.Task") (CVar "io"))),CoreDecl "" (CInt 0),CoreDecl "Nova.ask" (CLam [PVar "client",PVar "prompt"] (CApp (CApp (CVar "Lune.Task.map") (CLam [PVar "response"] (CSelect (CVar "response") "text"))) (CApp (CApp (CVar "Nova.askRaw") (CVar "client")) (CVar "prompt")))),CoreDecl "" (CInt 0),CoreDecl "Nova.json" (CLam [PVar "$dictJson.Decode0",PVar "client",PVar "prompt"] (CApp (CApp (CVar "Lune.Task.andThen") (CApp (CApp (CVar "Nova.askRaw") (CVar "client")) (CVar "prompt"))) (CLam [PVar "response"] (CCase (CApp (CApp (CVar "Json.decodeDetailed") (CVar "$dictJson.Decode0")) (CSelect (CVar "response") "text")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Task.succeed") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "decodeErr"]) (CApp (CVar "Lune.Task.fail") (CApp (CVar "Nova.Core.DecodeError") (CApp (CVar "Nova.formatDecodeError") (CVar "decodeErr"))))])))),CoreDecl "" (CInt 0),CoreDecl "Nova.tool" (CLam [PVar "$dictJson.Decode0",PVar "client",PVar "prompt"] (CLet "wrapped" (CApp (CVar "Lune.String.unlines") (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "Nova.toolPreamble")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "prompt")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CString "")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "Nova.toolPostamble")) (CVar "Lune.Prelude.Nil"))))))) (CApp (CApp (CVar "Lune.Task.andThen") (CApp (CApp (CVar "Nova.askRaw") (CVar "client")) (CVar "wrapped"))) (CLam [PVar "response"] (CCase (CApp (CVar "Nova.extractJson") (CSelect (CVar "response") "text")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Task.fail") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "rawJson"]) (CCase (CApp (CApp (CVar "Json.decodeDetailed") (CVar "$dictJson.Decode0")) (CVar "rawJson")) [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Task.succeed") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "decodeErr"]) (CApp (CVar "Lune.Task.fail") (CApp (CVar "Nova.Core.DecodeError") (CApp (CVar "Nova.formatDecodeError") (CVar "decodeErr"))))])]))))),CoreDecl "" (CInt 0),CoreDecl "Nova.formatDecodeError" (CLam [PVar "err"] (CCase (CSelect (CVar "err") "path") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CSelect (CVar "err") "message"),CoreAlt PWildcard (CApp (CApp (CVar "Lune.String.append") (CSelect (CVar "err") "message")) (CApp (CApp (CVar "Lune.String.append") (CString " at ")) (CApp (CVar "Nova.pathToString") (CSelect (CVar "err") "path"))))])),CoreDecl "" (CInt 0),CoreDecl "Nova.pathToString" (CLam [PVar "path"] (CApp (CApp (CVar "Nova.pathToStringGo") (CString "$")) (CVar "path"))),CoreDecl "" (CInt 0),CoreDecl "Nova.pathToStringGo" (CLam [PVar "acc",PVar "items"] (CCase (CVar "items") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "acc"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "item",PVar "rest"]) (CApp (CApp (CVar "Nova.pathToStringGo") (CApp (CApp (CVar "Lune.String.append") (CVar "acc")) (CApp (CVar "Nova.pathItemToString") (CVar "item")))) (CVar "rest"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.pathItemToString" (CLam [PVar "item"] (CCase (CVar "item") [CoreAlt (PCon "Lune.Json.Decode.Field" [PVar "name"]) (CApp (CApp (CVar "Lune.String.append") (CString ".")) (CVar "name")),CoreAlt (PCon "Lune.Json.Decode.Index" [PVar "i"]) (CApp (CApp (CVar "Lune.String.append") (CString "[")) (CApp (CApp (CVar "Lune.String.append") (CApp (CVar "Lune.String.fromInt") (CVar "i"))) (CString "]")))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.next" (CLam [PVar "stream"] (CCase (CVar "stream") [CoreAlt (PCon "Nova.Stream" [PVar "io"]) (CVar "io")])),CoreDecl "" (CInt 0),CoreDecl "Nova.streamFromList" (CLam [PVar "xs"] (CApp (CVar "Nova.Stream") (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "Nova.stepFromList") (CVar "xs")))))),CoreDecl "" (CInt 0),CoreDecl "Nova.stepFromList" (CLam [PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Nova.StreamEnd"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CVar "Nova.StreamYield") (CVar "x")) (CApp (CVar "Nova.streamFromList") (CVar "rest")))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "Nova.showNovaEvent" (CLam [PVar "ev"] (CCase (CVar "ev") [CoreAlt (PCon "Nova.TextDelta" [PVar "s"]) (CApp (CApp (CVar "Lune.String.append") (CString "TextDelta ")) (CVar "s")),CoreAlt (PCon "Nova.ToolCallDelta" [PWildcard]) (CString "ToolCallDelta"),CoreAlt (PCon "Nova.ToolCallComplete" [PWildcard]) (CString "ToolCallComplete"),CoreAlt (PCon "Nova.UsageFinal" [PWildcard]) (CString "UsageFinal")])),CoreDecl "" (CInt 0),CoreDecl "Nova.showEvent" (CVar "Nova.showNovaEvent"),CoreDecl "" (CInt 0),CoreDecl "Nova.showStreamStep" (CLam [PVar "showA",PVar "step"] (CCase (CVar "step") [CoreAlt (PCon "Nova.StreamEnd" []) (CString "StreamEnd"),CoreAlt (PCon "Nova.StreamYield" [PVar "a",PWildcard]) (CApp (CApp (CVar "Lune.String.append") (CString "StreamYield ")) (CApp (CVar "showA") (CVar "a")))])),CoreDecl "" (CInt 0),CoreDecl "Nova.showStreamResult" (CLam [PVar "showE",PVar "showA",PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CApp (CVar "Lune.String.append") (CString "StreamErr ")) (CApp (CVar "showE") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "step"]) (CApp (CApp (CVar "Nova.showStreamStep") (CVar "showA")) (CVar "step"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.askStream" (CLam [PVar "client",PVar "prompt"] (CApp (CVar "Nova.Stream") (CApp (CApp (CVar "Lune.IO.andThen") (CApp (CVar "Lune.Task.attempt") (CApp (CApp (CVar "Nova.askRaw") (CVar "client")) (CVar "prompt")))) (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Err") (CVar "e"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "response"]) (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "Nova.stepFromList") (CApp (CVar "Nova.responseToEvents") (CVar "response")))))]))))),CoreDecl "" (CInt 0),CoreDecl "Nova.responseToEvents" (CLam [PVar "response"] (CLet "chunks" (CApp (CApp (CVar "Nova.chunkText") (CInt 24)) (CSelect (CVar "response") "text")) (CLet "textEvents" (CApp (CApp (CVar "Nova.listMap") (CVar "Nova.TextDelta")) (CVar "chunks")) (CCase (CSelect (CVar "response") "usage") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "textEvents"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "usage"]) (CApp (CApp (CVar "Nova.listAppend") (CVar "textEvents")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "Nova.UsageFinal") (CVar "usage"))) (CVar "Lune.Prelude.Nil")))])))),CoreDecl "" (CInt 0),CoreDecl "Nova.chunkText" (CLam [PVar "chunkSize",PVar "s"] (CCase (CApp (CApp (CVar "prim_leInt") (CVar "chunkSize")) (CInt 0)) [CoreAlt (PCon "Lune.Prelude.True" []) (CCase (CApp (CVar "Lune.String.isEmpty") (CVar "s")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "s")) (CVar "Lune.Prelude.Nil"))]),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CApp (CApp (CVar "prim_leInt") (CApp (CVar "Lune.String.length") (CVar "s"))) (CVar "chunkSize")) [CoreAlt (PCon "Lune.Prelude.True" []) (CCase (CApp (CVar "Lune.String.isEmpty") (CVar "s")) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "s")) (CVar "Lune.Prelude.Nil"))]),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CApp (CVar "Lune.String.take") (CVar "chunkSize")) (CVar "s"))) (CApp (CApp (CVar "Nova.chunkText") (CVar "chunkSize")) (CApp (CApp (CVar "Lune.String.drop") (CVar "chunkSize")) (CVar "s"))))])])),CoreDecl "" (CInt 0),CoreDecl "Nova.listMap" (CLam [PVar "f",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "f") (CVar "x"))) (CApp (CApp (CVar "Nova.listMap") (CVar "f")) (CVar "rest")))])),CoreDecl "" (CInt 0),CoreDecl "Nova.listAppend" (CLam [PVar "xs",PVar "ys"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "ys"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "x")) (CApp (CApp (CVar "Nova.listAppend") (CVar "rest")) (CVar "ys")))])),CoreDecl "" (CInt 0),CoreDecl "Nova.executeTool" (CLam [PVar "client",PVar "runtimeConfig",PVar "spec",PVar "encodeInput",PVar "encodeOutput",PVar "exec",PVar "input"] (CLet "inputJson" (CApp (CVar "encodeInput") (CVar "input")) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CCase (CSelect (CVar "client") "hooks") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Task.succeed") (CVar "Lune.Prelude.unit")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "hooks"]) (CApp (CApp (CVar "Lune.Task.mapError") (CLam [PWildcard] (CApp (CVar "Nova.Runtime.ToolFailed") (CString "hook failed")))) (CApp (CSelect (CVar "hooks") "onToolStart") (CRecord [("tool",CSelect (CVar "spec") "id"),("input",CVar "inputJson")])))])) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Task.fromIO") (CVar "prim_timeNowMicros"))) (CLam [PVar "t0"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Task.fromIO") (CApp (CVar "Lune.Task.attempt") (CApp (CApp (CApp (CApp (CVar "Nova.Runtime.executeWithGuardsUsing") (CVar "runtimeConfig")) (CVar "spec")) (CVar "exec")) (CVar "input"))))) (CLam [PVar "result"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Task.fromIO") (CVar "prim_timeNowMicros"))) (CLam [PVar "t1"] (CLet "durationMs" (CApp (CApp (CVar "Lune.Int.div") (CApp (CApp (CVar "Lune.Int.sub") (CVar "t1")) (CVar "t0"))) (CInt 1000)) (CLet "outputJson" (CCase (CVar "result") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CApp (CVar "encodeOutput") (CVar "b")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Nova.encodeToolExecError") (CVar "e"))]) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CCase (CSelect (CVar "client") "hooks") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Task.succeed") (CVar "Lune.Prelude.unit")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "hooks"]) (CApp (CApp (CVar "Lune.Task.mapError") (CLam [PWildcard] (CApp (CVar "Nova.Runtime.ToolFailed") (CString "hook failed")))) (CApp (CSelect (CVar "hooks") "onToolFinish") (CRecord [("tool",CSelect (CVar "spec") "id"),("output",CVar "outputJson"),("durationMs",CVar "durationMs")])))])) (CLam [PWildcard] (CCase (CVar "result") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "b"]) (CApp (CVar "Lune.Task.succeed") (CVar "b")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Task.fail") (CVar "e"))]))))))))))))))),CoreDecl "" (CInt 0),CoreDecl "Nova.encodeToolExecError" (CLam [PVar "e"] (CApp (CVar "Lune.Json.Encode.object") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "error"),("value",CApp (CVar "Lune.Json.Encode.string") (CApp (CVar "Nova.toolExecErrorToString") (CVar "e")))])) (CVar "Lune.Prelude.Nil")))),CoreDecl "" (CInt 0),CoreDecl "Nova.toolExecErrorToString" (CLam [PVar "e"] (CCase (CVar "e") [CoreAlt (PCon "Nova.Runtime.ToolNotAllowed" [PVar "id"]) (CApp (CApp (CVar "Lune.String.append") (CString "ToolNotAllowed ")) (CApp (CVar "Nova.Tool.toolIdToString") (CVar "id"))),CoreAlt (PCon "Nova.Runtime.ApprovalRequired" [PVar "id"]) (CApp (CApp (CVar "Lune.String.append") (CString "ApprovalRequired ")) (CApp (CVar "Nova.Tool.toolIdToString") (CVar "id"))),CoreAlt (PCon "Nova.Runtime.ToolTimedOut" [PVar "id"]) (CApp (CApp (CVar "Lune.String.append") (CString "ToolTimedOut ")) (CApp (CVar "Nova.Tool.toolIdToString") (CVar "id"))),CoreAlt (PCon "Nova.Runtime.MaxTurnsExceeded" [PVar "n"]) (CApp (CApp (CVar "Lune.String.append") (CString "MaxTurnsExceeded ")) (CApp (CVar "Lune.String.fromInt") (CVar "n"))),CoreAlt (PCon "Nova.Runtime.ToolNotImplemented" [PVar "id"]) (CApp (CApp (CVar "Lune.String.append") (CString "ToolNotImplemented ")) (CApp (CVar "Nova.Tool.toolIdToString") (CVar "id"))),CoreAlt (PCon "Nova.Runtime.ToolFailed" [PVar "msg"]) (CApp (CApp (CVar "Lune.String.append") (CString "ToolFailed ")) (CVar "msg"))])),CoreDecl "" (CInt 0),CoreDecl "Nova.showToolExecResult" (CLam [PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "n"]) (CApp (CApp (CVar "Lune.String.append") (CString "Ok ")) (CApp (CVar "Lune.String.fromInt") (CVar "n"))),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CApp (CVar "Lune.String.append") (CString "Err ")) (CApp (CVar "Nova.showToolExecError") (CVar "e")))])),CoreDecl "" (CInt 0),CoreDecl "Nova.showToolExecError" (CVar "Nova.toolExecErrorToString"),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.diskUsageDecoder" (CApp (CApp (CApp (CApp (CApp (CVar "Lune.Json.Decode.map4") (CLam [PVar "mountPoint",PVar "totalGb",PVar "usedGb",PVar "percentUsed"] (CRecord [("mountPoint",CVar "mountPoint"),("totalGb",CVar "totalGb"),("usedGb",CVar "usedGb"),("percentUsed",CVar "percentUsed")]))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "mountPoint")) (CVar "Lune.Json.Decode.string"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "totalGb")) (CVar "Lune.Json.Decode.float"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "usedGb")) (CVar "Lune.Json.Decode.float"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "percentUsed")) (CVar "Lune.Json.Decode.int"))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.diskUsageEncoder" (CLam [PVar "d"] (CApp (CVar "Lune.Json.Encode.object") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "mountPoint"),("value",CApp (CVar "Lune.Json.Encode.string") (CSelect (CVar "d") "mountPoint"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "totalGb"),("value",CApp (CVar "Lune.Json.Encode.float") (CSelect (CVar "d") "totalGb"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "usedGb"),("value",CApp (CVar "Lune.Json.Encode.float") (CSelect (CVar "d") "usedGb"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "percentUsed"),("value",CApp (CVar "Lune.Json.Encode.int") (CSelect (CVar "d") "percentUsed"))])) (CVar "Lune.Prelude.Nil"))))))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.memoryUsageDecoder" (CApp (CApp (CApp (CApp (CApp (CVar "Lune.Json.Decode.map4") (CLam [PVar "totalMb",PVar "usedMb",PVar "availableMb",PVar "swapUsedMb"] (CRecord [("totalMb",CVar "totalMb"),("usedMb",CVar "usedMb"),("availableMb",CVar "availableMb"),("swapUsedMb",CVar "swapUsedMb")]))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "totalMb")) (CVar "Lune.Json.Decode.int"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "usedMb")) (CVar "Lune.Json.Decode.int"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "availableMb")) (CVar "Lune.Json.Decode.int"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "swapUsedMb")) (CVar "Lune.Json.Decode.int"))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.memoryUsageEncoder" (CLam [PVar "m"] (CApp (CVar "Lune.Json.Encode.object") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "totalMb"),("value",CApp (CVar "Lune.Json.Encode.int") (CSelect (CVar "m") "totalMb"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "usedMb"),("value",CApp (CVar "Lune.Json.Encode.int") (CSelect (CVar "m") "usedMb"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "availableMb"),("value",CApp (CVar "Lune.Json.Encode.int") (CSelect (CVar "m") "availableMb"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "swapUsedMb"),("value",CApp (CVar "Lune.Json.Encode.int") (CSelect (CVar "m") "swapUsedMb"))])) (CVar "Lune.Prelude.Nil"))))))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.processInfoDecoder" (CApp (CApp (CApp (CApp (CApp (CVar "Lune.Json.Decode.map4") (CLam [PVar "pid",PVar "name",PVar "cpuPercent",PVar "memoryPercent"] (CRecord [("pid",CVar "pid"),("name",CVar "name"),("cpuPercent",CVar "cpuPercent"),("memoryPercent",CVar "memoryPercent")]))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "pid")) (CVar "Lune.Json.Decode.int"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "name")) (CVar "Lune.Json.Decode.string"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "cpuPercent")) (CVar "Lune.Json.Decode.float"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "memoryPercent")) (CVar "Lune.Json.Decode.float"))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.processInfoEncoder" (CLam [PVar "p"] (CApp (CVar "Lune.Json.Encode.object") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "pid"),("value",CApp (CVar "Lune.Json.Encode.int") (CSelect (CVar "p") "pid"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "name"),("value",CApp (CVar "Lune.Json.Encode.string") (CSelect (CVar "p") "name"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "cpuPercent"),("value",CApp (CVar "Lune.Json.Encode.float") (CSelect (CVar "p") "cpuPercent"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "memoryPercent"),("value",CApp (CVar "Lune.Json.Encode.float") (CSelect (CVar "p") "memoryPercent"))])) (CVar "Lune.Prelude.Nil"))))))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.serviceStatusDecoder" (CApp (CApp (CApp (CApp (CVar "Lune.Json.Decode.map3") (CLam [PVar "name",PVar "isRunning",PVar "uptime"] (CRecord [("name",CVar "name"),("isRunning",CVar "isRunning"),("uptime",CVar "uptime")]))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "name")) (CVar "Lune.Json.Decode.string"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "isRunning")) (CVar "Lune.Json.Decode.bool"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "uptime")) (CApp (CVar "Lune.Json.Decode.maybe") (CVar "Lune.Json.Decode.string")))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.serviceStatusEncoder" (CLam [PVar "s"] (CApp (CVar "Lune.Json.Encode.object") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "name"),("value",CApp (CVar "Lune.Json.Encode.string") (CSelect (CVar "s") "name"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "isRunning"),("value",CApp (CVar "Lune.Json.Encode.bool") (CSelect (CVar "s") "isRunning"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "uptime"),("value",CApp (CLam [PVar "v"] (CCase (CVar "v") [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "Lune.Json.Encode.null"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "x"]) (CApp (CVar "Lune.Json.Encode.string") (CVar "x"))])) (CSelect (CVar "s") "uptime"))])) (CVar "Lune.Prelude.Nil")))))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.healthReportDecoder" (CApp (CApp (CApp (CApp (CApp (CVar "Lune.Json.Decode.map4") (CLam [PVar "disks",PVar "memory",PVar "topProcesses",PVar "services"] (CRecord [("disks",CVar "disks"),("memory",CVar "memory"),("topProcesses",CVar "topProcesses"),("services",CVar "services")]))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "disks")) (CApp (CVar "Lune.Json.Decode.list") (CVar "HealthAgent.diskUsageDecoder")))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "memory")) (CVar "HealthAgent.memoryUsageDecoder"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "topProcesses")) (CApp (CVar "Lune.Json.Decode.list") (CVar "HealthAgent.processInfoDecoder")))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "services")) (CApp (CVar "Lune.Json.Decode.list") (CVar "HealthAgent.serviceStatusDecoder")))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.healthReportEncoder" (CLam [PVar "h"] (CApp (CVar "Lune.Json.Encode.object") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "disks"),("value",CApp (CApp (CVar "Lune.Json.Encode.list") (CVar "HealthAgent.diskUsageEncoder")) (CSelect (CVar "h") "disks"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "memory"),("value",CApp (CVar "HealthAgent.memoryUsageEncoder") (CSelect (CVar "h") "memory"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "topProcesses"),("value",CApp (CApp (CVar "Lune.Json.Encode.list") (CVar "HealthAgent.processInfoEncoder")) (CSelect (CVar "h") "topProcesses"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "services"),("value",CApp (CApp (CVar "Lune.Json.Encode.list") (CVar "HealthAgent.serviceStatusEncoder")) (CSelect (CVar "h") "services"))])) (CVar "Lune.Prelude.Nil"))))))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.severityDecoder" (CApp (CApp (CVar "Lune.Json.Decode.andThen") (CLam [PVar "tag"] (CCase (CVar "tag") [CoreAlt (PString "Critical") (CApp (CVar "Lune.Json.Decode.succeed") (CVar "HealthAgent.Critical")),CoreAlt (PString "Warning") (CApp (CVar "Lune.Json.Decode.succeed") (CVar "HealthAgent.Warning")),CoreAlt (PString "Info") (CApp (CVar "Lune.Json.Decode.succeed") (CVar "HealthAgent.Info")),CoreAlt (PVar "other") (CApp (CVar "Lune.Json.Decode.fail") (CApp (CApp (CVar "prim_appendString") (CString "Unknown tag: ")) (CVar "other")))]))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "tag")) (CVar "Lune.Json.Decode.string"))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.severityEncoder" (CLam [PVar "s"] (CCase (CVar "s") [CoreAlt (PCon "HealthAgent.Critical" []) (CApp (CVar "Lune.Json.Encode.object") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "tag"),("value",CApp (CVar "Lune.Json.Encode.string") (CString "Critical"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "fields"),("value",CApp (CApp (CVar "Lune.Json.Encode.list") (CLam [PVar "x"] (CVar "x"))) (CVar "Lune.Prelude.Nil"))])) (CVar "Lune.Prelude.Nil")))),CoreAlt (PCon "HealthAgent.Warning" []) (CApp (CVar "Lune.Json.Encode.object") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "tag"),("value",CApp (CVar "Lune.Json.Encode.string") (CString "Warning"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "fields"),("value",CApp (CApp (CVar "Lune.Json.Encode.list") (CLam [PVar "x"] (CVar "x"))) (CVar "Lune.Prelude.Nil"))])) (CVar "Lune.Prelude.Nil")))),CoreAlt (PCon "HealthAgent.Info" []) (CApp (CVar "Lune.Json.Encode.object") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "tag"),("value",CApp (CVar "Lune.Json.Encode.string") (CString "Info"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "fields"),("value",CApp (CApp (CVar "Lune.Json.Encode.list") (CLam [PVar "x"] (CVar "x"))) (CVar "Lune.Prelude.Nil"))])) (CVar "Lune.Prelude.Nil"))))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.issueDecoder" (CApp (CApp (CApp (CApp (CVar "Lune.Json.Decode.map3") (CLam [PVar "severity",PVar "summary",PVar "details"] (CRecord [("severity",CVar "severity"),("summary",CVar "summary"),("details",CVar "details")]))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "severity")) (CVar "HealthAgent.severityDecoder"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "summary")) (CVar "Lune.Json.Decode.string"))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "details")) (CVar "Lune.Json.Decode.string"))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.issueEncoder" (CLam [PVar "i"] (CApp (CVar "Lune.Json.Encode.object") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "severity"),("value",CApp (CVar "HealthAgent.severityEncoder") (CSelect (CVar "i") "severity"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "summary"),("value",CApp (CVar "Lune.Json.Encode.string") (CSelect (CVar "i") "summary"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "details"),("value",CApp (CVar "Lune.Json.Encode.string") (CSelect (CVar "i") "details"))])) (CVar "Lune.Prelude.Nil")))))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.proposedActionDecoder" (CApp (CApp (CVar "Lune.Json.Decode.andThen") (CLam [PVar "id"] (CApp (CApp (CVar "Lune.Json.Decode.andThen") (CLam [PVar "issue"] (CApp (CApp (CVar "Lune.Json.Decode.andThen") (CLam [PVar "action"] (CApp (CApp (CVar "Lune.Json.Decode.andThen") (CLam [PVar "command"] (CApp (CApp (CVar "Lune.Json.Decode.andThen") (CLam [PVar "risk"] (CApp (CApp (CVar "Lune.Json.Decode.andThen") (CLam [PVar "expectedOutcome"] (CApp (CVar "Lune.Json.Decode.succeed") (CRecord [("id",CVar "id"),("issue",CVar "issue"),("action",CVar "action"),("command",CVar "command"),("risk",CVar "risk"),("expectedOutcome",CVar "expectedOutcome")])))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "expectedOutcome")) (CVar "Lune.Json.Decode.string"))))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "risk")) (CVar "Lune.Json.Decode.string"))))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "command")) (CVar "Lune.Json.Decode.string"))))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "action")) (CVar "Lune.Json.Decode.string"))))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "issue")) (CVar "Lune.Json.Decode.string"))))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "id")) (CVar "Lune.Json.Decode.int"))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.proposedActionEncoder" (CLam [PVar "p"] (CApp (CVar "Lune.Json.Encode.object") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "id"),("value",CApp (CVar "Lune.Json.Encode.int") (CSelect (CVar "p") "id"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "issue"),("value",CApp (CVar "Lune.Json.Encode.string") (CSelect (CVar "p") "issue"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "action"),("value",CApp (CVar "Lune.Json.Encode.string") (CSelect (CVar "p") "action"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "command"),("value",CApp (CVar "Lune.Json.Encode.string") (CSelect (CVar "p") "command"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "risk"),("value",CApp (CVar "Lune.Json.Encode.string") (CSelect (CVar "p") "risk"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "expectedOutcome"),("value",CApp (CVar "Lune.Json.Encode.string") (CSelect (CVar "p") "expectedOutcome"))])) (CVar "Lune.Prelude.Nil"))))))))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.healthAnalysisDecoder" (CApp (CApp (CApp (CVar "Lune.Json.Decode.map2") (CLam [PVar "issues",PVar "actions"] (CRecord [("issues",CVar "issues"),("actions",CVar "actions")]))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "issues")) (CApp (CVar "Lune.Json.Decode.list") (CVar "HealthAgent.issueDecoder")))) (CApp (CApp (CVar "Lune.Json.Decode.field") (CString "actions")) (CApp (CVar "Lune.Json.Decode.list") (CVar "HealthAgent.proposedActionDecoder")))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.healthAnalysisEncoder" (CLam [PVar "h"] (CApp (CVar "Lune.Json.Encode.object") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "issues"),("value",CApp (CApp (CVar "Lune.Json.Encode.list") (CVar "HealthAgent.issueEncoder")) (CSelect (CVar "h") "issues"))])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("key",CString "actions"),("value",CApp (CApp (CVar "Lune.Json.Encode.list") (CVar "HealthAgent.proposedActionEncoder")) (CSelect (CVar "h") "actions"))])) (CVar "Lune.Prelude.Nil"))))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.procReadFile" (CLam [PVar "path"] (CApp (CApp (CVar "Lune.Task.mapError") (CLam [PWildcard] (CApp (CVar "HealthAgent.SystemError") (CApp (CApp (CVar "Lune.String.append") (CString "Failed to read ")) (CVar "path"))))) (CApp (CVar "Lune.IO.readFile") (CVar "path")))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.diskCheck" (CApp (CVar "Lune.Task.succeed") (CVar "Lune.Prelude.Nil")),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.memoryCheck" (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "HealthAgent.procReadFile") (CString "/proc/meminfo"))) (CLam [PVar "contents"] (CCase (CApp (CVar "HealthAgent.parseMeminfo") (CVar "contents")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Task.fail") (CApp (CVar "HealthAgent.SystemError") (CVar "msg"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "m"]) (CApp (CVar "Lune.Task.succeed") (CVar "m"))]))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.processCheck" (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "HealthAgent.procReadFile") (CString "/proc/meminfo"))) (CLam [PVar "meminfo"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CCase (CApp (CApp (CVar "HealthAgent.meminfoValueKb") (CString "MemTotal")) (CVar "meminfo")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Task.fail") (CApp (CVar "HealthAgent.SystemError") (CString "meminfo: missing MemTotal"))),CoreAlt (PCon "Lune.Prelude.Just" [PVar "kb"]) (CApp (CVar "Lune.Task.succeed") (CVar "kb"))])) (CLam [PVar "memTotalKb"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CApp (CVar "Lune.Task.map") (CVar "Lune.String.trim")) (CApp (CVar "HealthAgent.procReadFile") (CString "/proc/self/comm")))) (CLam [PVar "name"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "HealthAgent.procReadFile") (CString "/proc/self/status"))) (CLam [PVar "status"] (CLet "rssKb" (CCase (CApp (CApp (CVar "HealthAgent.lineFirstInt") (CString "VmRSS:")) (CVar "status")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CInt 0),CoreAlt (PCon "Lune.Prelude.Just" [PVar "kb"]) (CVar "kb")]) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CVar "HealthAgent.sampleSelfCpu")) (CLam [PVar "sample0"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.sleepMs") (CInt 200))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CVar "HealthAgent.sampleSelfCpu")) (CLam [PVar "sample1"] (CLet "cpuPercent" (CApp (CApp (CVar "HealthAgent.cpuPercentFromSamples") (CVar "sample0")) (CVar "sample1")) (CLet "memoryPercent" (CApp (CApp (CVar "HealthAgent.percentOf") (CVar "rssKb")) (CVar "memTotalKb")) (CApp (CVar "Lune.Task.succeed") (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("pid",CSelect (CVar "sample0") "pid"),("name",CVar "name"),("cpuPercent",CVar "cpuPercent"),("memoryPercent",CVar "memoryPercent")])) (CVar "Lune.Prelude.Nil")))))))))))))))))))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.serviceCheck" (CApp (CVar "Lune.Task.succeed") (CVar "Lune.Prelude.Nil")),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.collectHealthReport" (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CVar "HealthAgent.diskCheck")) (CLam [PVar "disks"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CVar "HealthAgent.memoryCheck")) (CLam [PVar "memory"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CVar "HealthAgent.processCheck")) (CLam [PVar "processes"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CVar "HealthAgent.serviceCheck")) (CLam [PVar "services"] (CApp (CVar "Lune.Task.succeed") (CRecord [("disks",CVar "disks"),("memory",CVar "memory"),("topProcesses",CVar "processes"),("services",CVar "services")])))))))))),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.sampleSelfCpu" (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "HealthAgent.procReadFile") (CString "/proc/stat"))) (CLam [PVar "sys"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "HealthAgent.procReadFile") (CString "/proc/self/stat"))) (CLam [PVar "self"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CCase (CApp (CVar "HealthAgent.procTotalJiffies") (CVar "sys")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Task.fail") (CApp (CVar "HealthAgent.SystemError") (CVar "msg"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "n"]) (CApp (CVar "Lune.Task.succeed") (CVar "n"))])) (CLam [PVar "totalJiffies"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CCase (CApp (CVar "HealthAgent.procPidAndJiffies") (CVar "self")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Task.fail") (CApp (CVar "HealthAgent.SystemError") (CVar "msg"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "r"]) (CApp (CVar "Lune.Task.succeed") (CVar "r"))])) (CLam [PVar "pidAndJiffies"] (CCase (CVar "pidAndJiffies") [CoreAlt (PCon "Lune.Prelude.Pair" [PVar "pid",PVar "procJiffies"]) (CApp (CVar "Lune.Task.succeed") (CRecord [("pid",CVar "pid"),("procJiffies",CVar "procJiffies"),("totalJiffies",CVar "totalJiffies"),("cpuCount",CApp (CVar "HealthAgent.ensureAtLeast1") (CApp (CVar "HealthAgent.procCpuCount") (CVar "sys")))]))]))))))))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.cpuPercentFromSamples" (CLam [PVar "a",PVar "b"] (CLet "dp" (CApp (CVar "HealthAgent.clampNonNegative") (CApp (CApp (CVar "Lune.Int.sub") (CSelect (CVar "b") "procJiffies")) (CSelect (CVar "a") "procJiffies"))) (CLet "dt" (CApp (CVar "HealthAgent.clampNonNegative") (CApp (CApp (CVar "Lune.Int.sub") (CSelect (CVar "b") "totalJiffies")) (CSelect (CVar "a") "totalJiffies"))) (CCase (CApp (CApp (CVar "Lune.Int.lte") (CVar "dt")) (CInt 0)) [CoreAlt (PCon "Lune.Prelude.True" []) (CFloat 0.0),CoreAlt (PCon "Lune.Prelude.False" []) (CLet "ratio" (CApp (CApp (CVar "Lune.Float.div") (CApp (CVar "Lune.Float.fromInt") (CVar "dp"))) (CApp (CVar "Lune.Float.fromInt") (CVar "dt"))) (CApp (CApp (CVar "Lune.Float.mul") (CApp (CVar "Lune.Float.fromInt") (CSelect (CVar "a") "cpuCount"))) (CApp (CApp (CVar "Lune.Float.mul") (CFloat 100.0)) (CVar "ratio"))))])))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.percentOf" (CLam [PVar "part",PVar "total"] (CCase (CApp (CApp (CVar "Lune.Int.lte") (CVar "total")) (CInt 0)) [CoreAlt (PCon "Lune.Prelude.True" []) (CFloat 0.0),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.Float.mul") (CFloat 100.0)) (CApp (CApp (CVar "Lune.Float.div") (CApp (CVar "Lune.Float.fromInt") (CApp (CVar "HealthAgent.clampNonNegative") (CVar "part")))) (CApp (CVar "Lune.Float.fromInt") (CVar "total"))))])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.parseMeminfo" (CLam [PVar "contents"] (CCase (CApp (CApp (CVar "HealthAgent.meminfoValueKb") (CString "MemTotal")) (CVar "contents")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Prelude.Err") (CString "meminfo: missing MemTotal")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "totalKb"]) (CCase (CApp (CApp (CVar "HealthAgent.meminfoValueKb") (CString "MemAvailable")) (CVar "contents")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Prelude.Err") (CString "meminfo: missing MemAvailable")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "availableKb"]) (CCase (CApp (CApp (CVar "HealthAgent.meminfoValueKb") (CString "SwapTotal")) (CVar "contents")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Prelude.Err") (CString "meminfo: missing SwapTotal")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "swapTotalKb"]) (CCase (CApp (CApp (CVar "HealthAgent.meminfoValueKb") (CString "SwapFree")) (CVar "contents")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Prelude.Err") (CString "meminfo: missing SwapFree")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "swapFreeKb"]) (CLet "totalMb" (CApp (CApp (CVar "Lune.Int.div") (CVar "totalKb")) (CInt 1024)) (CLet "availableMb" (CApp (CApp (CVar "Lune.Int.div") (CVar "availableKb")) (CInt 1024)) (CLet "usedMb" (CApp (CVar "HealthAgent.clampNonNegative") (CApp (CApp (CVar "Lune.Int.sub") (CVar "totalMb")) (CVar "availableMb"))) (CLet "swapUsedMb" (CApp (CVar "HealthAgent.clampNonNegative") (CApp (CApp (CVar "Lune.Int.div") (CApp (CApp (CVar "Lune.Int.sub") (CVar "swapTotalKb")) (CVar "swapFreeKb"))) (CInt 1024))) (CApp (CVar "Lune.Prelude.Ok") (CRecord [("totalMb",CVar "totalMb"),("usedMb",CVar "usedMb"),("availableMb",CVar "availableMb"),("swapUsedMb",CVar "swapUsedMb")]))))))])])])])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.meminfoValueKb" (CLam [PVar "key",PVar "contents"] (CLet "prefix" (CApp (CApp (CVar "Lune.String.append") (CVar "key")) (CString ":")) (CApp (CApp (CVar "HealthAgent.lineFirstInt") (CVar "prefix")) (CVar "contents")))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.lineFirstInt" (CLam [PVar "prefix",PVar "contents"] (CCase (CApp (CApp (CVar "HealthAgent.findFirst") (CLam [PVar "line"] (CApp (CApp (CVar "Lune.String.startsWith") (CVar "prefix")) (CVar "line")))) (CApp (CVar "Lune.String.lines") (CVar "contents"))) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CVar "Lune.Prelude.Nothing"),CoreAlt (PCon "Lune.Prelude.Just" [PVar "line"]) (CApp (CVar "HealthAgent.extractFirstInt") (CVar "line"))])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.extractFirstInt" (CLam [PVar "s"] (CLet "chars" (CApp (CVar "Lune.String.toChars") (CVar "s")) (CLet "after" (CApp (CApp (CVar "HealthAgent.dropWhile") (CLam [PVar "c"] (CApp (CVar "HealthAgent.not") (CApp (CVar "HealthAgent.isDigit") (CVar "c"))))) (CVar "chars")) (CCase (CVar "after") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nothing"),CoreAlt PWildcard (CLet "digits" (CApp (CApp (CVar "HealthAgent.takeWhile") (CVar "HealthAgent.isDigit")) (CVar "after")) (CCase (CApp (CVar "Lune.String.toInt") (CApp (CVar "Lune.String.fromChars") (CVar "digits"))) [CoreAlt (PCon "Lune.Prelude.Err" [PWildcard]) (CVar "Lune.Prelude.Nothing"),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "n"]) (CApp (CVar "Lune.Prelude.Just") (CVar "n"))]))])))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.procTotalJiffies" (CLam [PVar "sys"] (CCase (CApp (CVar "Lune.String.lines") (CVar "sys")) [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CVar "Lune.Prelude.Err") (CString "proc/stat: empty")),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "first",PWildcard]) (CCase (CApp (CVar "HealthAgent.words") (CVar "first")) [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CVar "Lune.Prelude.Err") (CString "proc/stat: malformed cpu line")),CoreAlt (PCon "Lune.Prelude.Cons" [PWildcard,PVar "rest"]) (CApp (CVar "HealthAgent.sumInts") (CVar "rest"))])])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.procCpuCount" (CLam [PVar "sys"] (CApp (CApp (CApp (CVar "Lune.List.foldl") (CVar "HealthAgent.countCpuCoreLine")) (CInt 0)) (CApp (CVar "Lune.String.lines") (CVar "sys")))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.countCpuCoreLine" (CLam [PVar "n",PVar "line"] (CCase (CApp (CVar "HealthAgent.isCpuCoreLine") (CVar "line")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.Int.add") (CVar "n")) (CInt 1)),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "n")])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.isCpuCoreLine" (CLam [PVar "line"] (CCase (CApp (CApp (CVar "Lune.String.startsWith") (CString "cpu")) (CVar "line")) [CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.False"),CoreAlt (PCon "Lune.Prelude.True" []) (CCase (CApp (CVar "Lune.String.toChars") (CApp (CApp (CVar "Lune.String.drop") (CInt 3)) (CVar "line"))) [CoreAlt (PCon "Lune.Prelude.Cons" [PVar "c",PWildcard]) (CApp (CVar "HealthAgent.isDigit") (CVar "c")),CoreAlt PWildcard (CVar "Lune.Prelude.False")])])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.procPidAndJiffies" (CLam [PVar "statLine"] (CCase (CApp (CVar "HealthAgent.words") (CVar "statLine")) [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CVar "Lune.Prelude.Err") (CString "proc/self/stat: missing pid")),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "pidToken",PWildcard]) (CCase (CApp (CVar "Lune.String.toInt") (CVar "pidToken")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CApp (CApp (CVar "Lune.String.append") (CString "proc/self/stat: invalid pid: ")) (CVar "msg"))),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "pid"]) (CCase (CApp (CApp (CVar "Lune.String.indexOf") (CString ") ")) (CVar "statLine")) [CoreAlt (PCon "Lune.Prelude.Nothing" []) (CApp (CVar "Lune.Prelude.Err") (CString "proc/self/stat: missing ') ' delimiter")),CoreAlt (PCon "Lune.Prelude.Just" [PVar "idx"]) (CLet "rest" (CApp (CApp (CVar "Lune.String.drop") (CApp (CApp (CVar "Lune.Int.add") (CVar "idx")) (CInt 2))) (CVar "statLine")) (CLet "fields" (CApp (CVar "HealthAgent.words") (CVar "rest")) (CCase (CApp (CApp (CVar "Lune.Prelude.Pair") (CApp (CApp (CVar "HealthAgent.listGet") (CInt 11)) (CVar "fields"))) (CApp (CApp (CVar "HealthAgent.listGet") (CInt 12)) (CVar "fields"))) [CoreAlt (PCon "Lune.Prelude.Pair" [PCon "Lune.Prelude.Just" [PVar "ut"],PCon "Lune.Prelude.Just" [PVar "st"]]) (CCase (CApp (CApp (CVar "Lune.Prelude.Pair") (CApp (CVar "Lune.String.toInt") (CVar "ut"))) (CApp (CVar "Lune.String.toInt") (CVar "st"))) [CoreAlt (PCon "Lune.Prelude.Pair" [PCon "Lune.Prelude.Ok" [PVar "utime"],PCon "Lune.Prelude.Ok" [PVar "stime"]]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CVar "Lune.Prelude.Pair") (CVar "pid")) (CApp (CApp (CVar "Lune.Int.add") (CVar "utime")) (CVar "stime")))),CoreAlt PWildcard (CApp (CVar "Lune.Prelude.Err") (CString "proc/self/stat: invalid utime/stime"))]),CoreAlt PWildcard (CApp (CVar "Lune.Prelude.Err") (CString "proc/self/stat: missing utime/stime fields"))])))])])])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.sumInts" (CLam [PVar "xs"] (CApp (CApp (CApp (CVar "Lune.List.foldl") (CVar "HealthAgent.sumIntsStep")) (CApp (CVar "Lune.Prelude.Ok") (CInt 0))) (CVar "xs"))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.sumIntsStep" (CLam [PVar "acc",PVar "s"] (CCase (CVar "acc") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CVar "msg")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "n"]) (CCase (CApp (CVar "Lune.String.toInt") (CVar "s")) [CoreAlt (PCon "Lune.Prelude.Err" [PVar "msg"]) (CApp (CVar "Lune.Prelude.Err") (CVar "msg")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "m"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CApp (CVar "Lune.Int.add") (CVar "n")) (CVar "m")))])])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.words" (CLam [PVar "s"] (CApp (CApp (CApp (CVar "HealthAgent.wordsFromChars") (CApp (CVar "Lune.String.toChars") (CVar "s"))) (CVar "Lune.Prelude.Nil")) (CVar "Lune.Prelude.Nil"))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.wordsFromChars" (CLam [PVar "chars",PVar "currentRev",PVar "accRev"] (CCase (CVar "chars") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CCase (CVar "currentRev") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CVar "Lune.List.reverse") (CVar "accRev")),CoreAlt PWildcard (CApp (CVar "Lune.List.reverse") (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "Lune.String.fromChars") (CApp (CVar "Lune.List.reverse") (CVar "currentRev")))) (CVar "accRev")))]),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "c",PVar "rest"]) (CCase (CApp (CVar "Lune.Char.isSpace") (CVar "c")) [CoreAlt (PCon "Lune.Prelude.True" []) (CCase (CVar "currentRev") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CApp (CApp (CVar "HealthAgent.wordsFromChars") (CVar "rest")) (CVar "Lune.Prelude.Nil")) (CVar "accRev")),CoreAlt PWildcard (CApp (CApp (CApp (CVar "HealthAgent.wordsFromChars") (CVar "rest")) (CVar "Lune.Prelude.Nil")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CApp (CVar "Lune.String.fromChars") (CApp (CVar "Lune.List.reverse") (CVar "currentRev")))) (CVar "accRev")))]),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CApp (CVar "HealthAgent.wordsFromChars") (CVar "rest")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "c")) (CVar "currentRev"))) (CVar "accRev"))])])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.findFirst" (CLam [PVar "pred",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nothing"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CCase (CApp (CVar "pred") (CVar "x")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.Prelude.Just") (CVar "x")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "HealthAgent.findFirst") (CVar "pred")) (CVar "rest"))])])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.listGet" (CLam [PVar "n",PVar "xs"] (CCase (CApp (CApp (CVar "Lune.Int.lte") (CVar "n")) (CInt 0)) [CoreAlt (PCon "Lune.Prelude.True" []) (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nothing"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PWildcard]) (CApp (CVar "Lune.Prelude.Just") (CVar "x"))]),CoreAlt (PCon "Lune.Prelude.False" []) (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nothing"),CoreAlt (PCon "Lune.Prelude.Cons" [PWildcard,PVar "rest"]) (CApp (CApp (CVar "HealthAgent.listGet") (CApp (CApp (CVar "Lune.Int.sub") (CVar "n")) (CInt 1))) (CVar "rest"))])])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.takeWhile" (CLam [PVar "pred",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CCase (CApp (CVar "pred") (CVar "x")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "x")) (CApp (CApp (CVar "HealthAgent.takeWhile") (CVar "pred")) (CVar "rest"))),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.Nil")])])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.dropWhile" (CLam [PVar "pred",PVar "xs"] (CCase (CVar "xs") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CVar "Lune.Prelude.Nil"),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "x",PVar "rest"]) (CCase (CApp (CVar "pred") (CVar "x")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "HealthAgent.dropWhile") (CVar "pred")) (CVar "rest")),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "xs")])])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.not" (CLam [PVar "b"] (CCase (CVar "b") [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "Lune.Prelude.False"),CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.True")])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.isDigit" (CLam [PVar "c"] (CLet "n" (CApp (CVar "Lune.Char.toInt") (CVar "c")) (CCase (CApp (CApp (CVar "Lune.Int.gte") (CVar "n")) (CInt 48)) [CoreAlt (PCon "Lune.Prelude.False" []) (CVar "Lune.Prelude.False"),CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.Int.lte") (CVar "n")) (CInt 57))]))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.clampNonNegative" (CLam [PVar "n"] (CCase (CApp (CApp (CVar "Lune.Int.gte") (CVar "n")) (CInt 0)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "n"),CoreAlt (PCon "Lune.Prelude.False" []) (CInt 0)])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.ensureAtLeast1" (CLam [PVar "n"] (CCase (CApp (CApp (CVar "Lune.Int.gte") (CVar "n")) (CInt 1)) [CoreAlt (PCon "Lune.Prelude.True" []) (CVar "n"),CoreAlt (PCon "Lune.Prelude.False" []) (CInt 1)])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.showSeverity" (CLam [PVar "sev"] (CCase (CVar "sev") [CoreAlt (PCon "HealthAgent.Critical" []) (CString "CRITICAL"),CoreAlt (PCon "HealthAgent.Warning" []) (CString "WARNING"),CoreAlt (PCon "HealthAgent.Info" []) (CString "INFO")])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.showIssue" (CLam [PVar "iss"] (CApp (CVar "Template.render") (CTemplate False [CTemplateText "  * [",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CApp (CVar "HealthAgent.showSeverity") (CSelect (CVar "iss") "severity"))),CTemplateText "] ",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CSelect (CVar "iss") "summary"))]))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.showIssuesHeader" (CString "Issues found:"),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.showIssues" (CLam [PVar "issues"] (CCase (CVar "issues") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CString "No issues found."),CoreAlt PWildcard (CApp (CApp (CVar "Lune.String.join") (CString "\n")) (CApp (CApp (CVar "Lune.Prelude.Cons") (CVar "HealthAgent.showIssuesHeader")) (CApp (CApp (CVar "Lune.List.map") (CVar "HealthAgent.showIssue")) (CVar "issues"))))])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.showAction" (CLam [PVar "current",PVar "total",PVar "act"] (CApp (CVar "Template.render") (CTemplate True [CTemplateText "+-------------------------------------------------+\n| Action ",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CApp (CVar "Lune.String.fromInt") (CVar "current"))),CTemplateText " of ",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CApp (CVar "Lune.String.fromInt") (CVar "total"))),CTemplateText " [",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CSelect (CVar "act") "risk")),CTemplateText " risk]\n|\n| Issue: ",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CSelect (CVar "act") "issue")),CTemplateText "\n|\n| Proposed: ",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CSelect (CVar "act") "action")),CTemplateText "\n| Command:  ",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CSelect (CVar "act") "command")),CTemplateText "\n| Expected: ",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CSelect (CVar "act") "expectedOutcome")),CTemplateText "\n+-------------------------------------------------+"]))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.mockHealthProvider" (CApp (CVar "Nova.provider") (CString "mock-health")),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.mockHealthCall" (CLam [PWildcard,PWildcard,PWildcard] (CApp (CVar "Lune.IO.pure") (CApp (CVar "Lune.Prelude.Ok") (CRecord [("text",CVar "HealthAgent.mockHealthAnalysisJson"),("usage",CApp (CVar "Lune.Prelude.Just") (CRecord [("inputTokens",CInt 100),("outputTokens",CInt 50),("totalTokens",CInt 150)]))])))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.mockHealthAnalysis" (CRecord [("issues",CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("severity",CVar "HealthAgent.Critical"),("summary",CString "Disk /var is 94% full"),("details",CString "Only 1.2GB remaining on /var partition")])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("severity",CVar "HealthAgent.Warning"),("summary",CString "High memory usage"),("details",CString "Process 'node' using 78% of available memory")])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("severity",CVar "HealthAgent.Warning"),("summary",CString "Service redis is down"),("details",CString "Redis service is not running")])) (CVar "Lune.Prelude.Nil")))),("actions",CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("id",CInt 1),("issue",CString "Disk /var is 94% full"),("action",CString "Clear journal logs older than 7 days"),("command",CString "journalctl --vacuum-time=7d"),("risk",CString "low"),("expectedOutcome",CString "Free approximately 1-2GB")])) (CApp (CApp (CVar "Lune.Prelude.Cons") (CRecord [("id",CInt 2),("issue",CString "Service redis is down"),("action",CString "Restart redis service"),("command",CString "systemctl restart redis"),("risk",CString "medium"),("expectedOutcome",CString "Redis service will be available")])) (CVar "Lune.Prelude.Nil")))]),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.mockHealthAnalysisJson" (CApp (CVar "Lune.Json.stringify") (CApp (CVar "HealthAgent.healthAnalysisEncoder") (CVar "HealthAgent.mockHealthAnalysis"))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.mockHealthProviderImpl" (CRecord [("id",CVar "HealthAgent.mockHealthProvider"),("call",CVar "HealthAgent.mockHealthCall"),("capabilities",CVar "Nova.Core.setEmpty")]),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.analysisSystemPrompt" (CApp (CVar "Template.render") (CTemplate True [CTemplateText "You are a Linux sysadmin assistant. Analyze these system\nhealth metrics and identify issues that need attention.\n\nSeverity guidelines:\n- Critical: System at risk of failure (disk >90%, OOM imminent)\n- Warning: Degraded performance or trending toward critical\n- Info: Notable but not actionable\n\nFor each issue, propose a concrete remediation action with\nthe exact command to run. Assess risk level:\n- low: Safe, no service impact (clear caches, rotate logs)\n- medium: Brief impact (restart service, kill process)\n- high: Potential data loss or extended downtime\n\nReturn actions in priority order (most urgent first)."])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.buildAnalysisPrompt" (CLam [PVar "report"] (CApp (CVar "Template.render") (CTemplate True [CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CVar "HealthAgent.analysisSystemPrompt")),CTemplateText "\n\nHealth Report:\n",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CApp (CVar "Lune.Json.stringify") (CApp (CVar "HealthAgent.healthReportEncoder") (CVar "report"))))]))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.mockProviderRegistry" (CApp (CApp (CApp (CApp (CVar "Nova.Core.dictInsert") (CVar "Nova.providerEq")) (CVar "HealthAgent.mockHealthProvider")) (CVar "HealthAgent.mockHealthProviderImpl")) (CVar "Nova.Core.defaultProviderRegistry")),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.makeClient" (CApp (CApp (CApp (CVar "Nova.newClient") (CVar "HealthAgent.mockProviderRegistry")) (CVar "HealthAgent.mockHealthProvider")) (CString "health-analyzer")),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.analyzeHealth" (CLam [PVar "report"] (CLet "prompt" (CApp (CVar "HealthAgent.buildAnalysisPrompt") (CVar "report")) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CApp (CVar "Lune.Task.mapError") (CVar "HealthAgent.LlmError")) (CApp (CApp (CApp (CVar "Nova.tool") (CVar "$dictJson.Decode_Json")) (CVar "HealthAgent.makeClient")) (CVar "prompt")))) (CLam [PVar "analysisJson"] (CApp (CApp (CVar "Lune.Task.mapError") (CLam [PVar "d"] (CApp (CVar "HealthAgent.DecodeError") (CSelect (CVar "d") "message")))) (CApp (CVar "Lune.Task.fromResult") (CApp (CApp (CVar "Lune.Json.Decode.decodeValue") (CVar "HealthAgent.healthAnalysisDecoder")) (CVar "analysisJson")))))))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.displayAnalysis" (CLam [PVar "analysis"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString ""))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CApp (CVar "HealthAgent.showIssues") (CSelect (CVar "analysis") "issues")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString ""))) (CLam [PWildcard] (CCase (CSelect (CVar "analysis") "actions") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CVar "Lune.IO.println") (CString "No remediation actions proposed.")),CoreAlt PWildcard (CLet "count" (CApp (CVar "Lune.List.length") (CSelect (CVar "analysis") "actions")) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CApp (CVar "Template.render") (CTemplate False [CTemplateText "Proposed ",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CApp (CVar "Lune.String.fromInt") (CVar "count"))),CTemplateText " remediation actions:"])))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString ""))) (CLam [PWildcard] (CApp (CApp (CVar "HealthAgent.processActions") (CVar "count")) (CSelect (CVar "analysis") "actions")))))))])))))))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.showAgentError" (CLam [PVar "err"] (CCase (CVar "err") [CoreAlt (PCon "HealthAgent.LlmError" [PVar "e"]) (CApp (CVar "Template.render") (CTemplate False [CTemplateText "LLM analysis failed: ",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CApp (CVar "Nova.showError") (CVar "e")))])),CoreAlt (PCon "HealthAgent.DecodeError" [PVar "msg"]) (CApp (CVar "Template.render") (CTemplate False [CTemplateText "Failed to decode response: ",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CVar "msg"))])),CoreAlt (PCon "HealthAgent.SystemError" [PVar "msg"]) (CApp (CVar "Template.render") (CTemplate False [CTemplateText "System check failed: ",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CVar "msg"))]))])),CoreDecl "" (CInt 0),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.promptForApproval" (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "Approve this action (record command to approved-commands.sh)? [y/n/q] "))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CVar "Lune.IO.readLine")) (CLam [PVar "input"] (CCase (CVar "input") [CoreAlt (PString "y") (CApp (CVar "Lune.Task.succeed") (CVar "HealthAgent.Approved")),CoreAlt (PString "n") (CApp (CVar "Lune.Task.succeed") (CVar "HealthAgent.Skipped")),CoreAlt (PString "q") (CApp (CVar "Lune.Task.succeed") (CVar "HealthAgent.Quit")),CoreAlt PWildcard (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "Please enter y, n, or q"))) (CLam [PWildcard] (CVar "HealthAgent.promptForApproval")))]))))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.approvedCommandsPath" (CString "approved-commands.sh"),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.recordApprovedCommand" (CLam [PVar "cmd"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CApp (CVar "Lune.Task.onError") (CApp (CVar "Lune.IO.readFile") (CVar "HealthAgent.approvedCommandsPath"))) (CLam [PWildcard] (CApp (CVar "Lune.Task.succeed") (CString ""))))) (CLam [PVar "existing"] (CLet "line" (CApp (CApp (CVar "Lune.String.append") (CVar "cmd")) (CString "\n")) (CLet "updated" (CCase (CApp (CVar "Lune.String.isEmpty") (CVar "existing")) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CApp (CVar "Lune.String.append") (CString "#!/usr/bin/env sh\n\n")) (CVar "line")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CVar "Lune.String.append") (CVar "existing")) (CVar "line"))]) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CApp (CVar "Lune.Task.onError") (CApp (CApp (CVar "Lune.IO.writeFile") (CVar "HealthAgent.approvedCommandsPath")) (CVar "updated"))) (CLam [PWildcard] (CApp (CVar "Lune.Task.succeed") (CVar "Lune.Prelude.unit"))))) (CLam [PWildcard] (CApp (CVar "Lune.Task.succeed") (CApp (CVar "Template.render") (CTemplate False [CTemplateText "Recorded: ",CTemplateHole (TCon "String") (CApp (CSelect (CVar "$dictToTemplate_String") "toTemplate") (CVar "cmd"))])))))))))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.processActions" (CLam [PVar "total",PVar "actions"] (CApp (CApp (CApp (CVar "HealthAgent.processActionsGo") (CInt 1)) (CVar "total")) (CVar "actions"))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.processActionsGo" (CLam [PVar "current",PVar "total",PVar "actions"] (CCase (CVar "actions") [CoreAlt (PCon "Lune.Prelude.Nil" []) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "All actions processed."))) (CLam [PWildcard] (CApp (CVar "Lune.Task.succeed") (CVar "Lune.Prelude.unit")))),CoreAlt (PCon "Lune.Prelude.Cons" [PVar "act",PVar "rest"]) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CApp (CApp (CApp (CVar "HealthAgent.showAction") (CVar "current")) (CVar "total")) (CVar "act")))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CVar "HealthAgent.promptForApproval")) (CLam [PVar "approval"] (CCase (CVar "approval") [CoreAlt (PCon "HealthAgent.Quit" []) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "Quitting. Remaining actions skipped."))) (CLam [PWildcard] (CApp (CVar "Lune.Task.succeed") (CVar "Lune.Prelude.unit")))),CoreAlt (PCon "HealthAgent.Skipped" []) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "Action skipped."))) (CLam [PWildcard] (CApp (CApp (CApp (CVar "HealthAgent.processActionsGo") (CApp (CApp (CVar "Lune.Int.add") (CVar "current")) (CInt 1))) (CVar "total")) (CVar "rest")))),CoreAlt (PCon "HealthAgent.Approved" []) (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "HealthAgent.recordApprovedCommand") (CSelect (CVar "act") "command"))) (CLam [PVar "result"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CVar "result"))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "Action recorded."))) (CLam [PWildcard] (CApp (CApp (CApp (CVar "HealthAgent.processActionsGo") (CApp (CApp (CVar "Lune.Int.add") (CVar "current")) (CInt 1))) (CVar "total")) (CVar "rest"))))))))])))))])),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.runAgent" (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "Collecting system health data..."))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CVar "HealthAgent.collectHealthReport")) (CLam [PVar "report"] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "Health data collected."))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString ""))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "Analyzing with LLM..."))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "HealthAgent.analyzeHealth") (CVar "report"))) (CLam [PVar "analysis"] (CApp (CVar "HealthAgent.displayAnalysis") (CVar "analysis")))))))))))))),CoreDecl "" (CInt 0),CoreDecl "HealthAgent.main" (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString "=== Health Agent ==="))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.IO.println") (CString ""))) (CLam [PWildcard] (CApp (CApp (CSelect (CVar "$dictMonad_Task") "andThen") (CApp (CVar "Lune.Task.result") (CVar "HealthAgent.runAgent"))) (CLam [PVar "result"] (CCase (CVar "result") [CoreAlt (PCon "Lune.Prelude.Ok" [PWildcard]) (CApp (CVar "Lune.Task.succeed") (CVar "Lune.Prelude.unit")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.IO.println") (CApp (CVar "HealthAgent.showAgentError") (CVar "e")))])))))))]}
