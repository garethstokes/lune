CoreModule {coreName = "STMExample", coreDecls = [CoreDecl "$dictFunctor_IO" (CRecord [("map",CLam [PVar "f",PVar "ma"] (CApp (CApp (CVar "$primIOBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primIOPure") (CApp (CVar "f") (CVar "a"))))))]),CoreDecl "$dictApplicative_IO" (CRecord [("$superFunctor",CVar "$dictFunctor_IO"),("pure",CVar "$primIOPure"),("apply",CLam [PVar "mf",PVar "ma"] (CApp (CApp (CVar "$primIOBind") (CVar "mf")) (CLam [PVar "f"] (CApp (CApp (CVar "$primIOBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primIOPure") (CApp (CVar "f") (CVar "a"))))))))]),CoreDecl "$dictMonad_IO" (CRecord [("$superApplicative",CVar "$dictApplicative_IO"),("andThen",CVar "$primIOBind"),("then",CVar "$primIOThen")]),CoreDecl "$dictFunctor_Result" (CRecord [("map",CLam [PVar "f",PVar "r"] (CCase (CVar "r") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a")))]))]),CoreDecl "$dictApplicative_Result" (CRecord [("$superFunctor",CVar "$dictFunctor_Result"),("pure",CLam [PVar "a"] (CApp (CVar "Lune.Prelude.Ok") (CVar "a"))),("apply",CLam [PVar "rf",PVar "ra"] (CCase (CVar "rf") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "f"]) (CCase (CVar "ra") [CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e")),CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "Lune.Prelude.Ok") (CApp (CVar "f") (CVar "a")))])]))]),CoreDecl "$dictMonad_Result" (CRecord [("$superApplicative",CVar "$dictApplicative_Result"),("andThen",CLam [PVar "m",PVar "k"] (CCase (CVar "m") [CoreAlt (PCon "Lune.Prelude.Ok" [PVar "a"]) (CApp (CVar "k") (CVar "a")),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e"))])),("then",CLam [PVar "ra",PVar "rb"] (CCase (CVar "ra") [CoreAlt (PCon "Lune.Prelude.Ok" [PWildcard]) (CVar "rb"),CoreAlt (PCon "Lune.Prelude.Err" [PVar "e"]) (CApp (CVar "Lune.Prelude.Err") (CVar "e"))]))]),CoreDecl "$dictFunctor_STM" (CRecord [("map",CLam [PVar "f",PVar "ma"] (CApp (CApp (CVar "$primSTMBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primSTMPure") (CApp (CVar "f") (CVar "a"))))))]),CoreDecl "$dictApplicative_STM" (CRecord [("$superFunctor",CVar "$dictFunctor_STM"),("pure",CVar "$primSTMPure"),("apply",CLam [PVar "mf",PVar "ma"] (CApp (CApp (CVar "$primSTMBind") (CVar "mf")) (CLam [PVar "f"] (CApp (CApp (CVar "$primSTMBind") (CVar "ma")) (CLam [PVar "a"] (CApp (CVar "$primSTMPure") (CApp (CVar "f") (CVar "a"))))))))]),CoreDecl "$dictMonad_STM" (CRecord [("$superApplicative",CVar "$dictApplicative_STM"),("andThen",CVar "$primSTMBind"),("then",CLam [PVar "ma",PVar "mb"] (CApp (CApp (CVar "$primSTMBind") (CVar "ma")) (CLam [PWildcard] (CVar "mb"))))]),CoreDecl "$dictFunctor_Api" (CRecord [("map",CLam [PVar "f",PVar "ma"] (CApp (CApp (CVar "prim_apiAndThen") (CLam [PVar "a"] (CApp (CVar "prim_apiPure") (CApp (CVar "f") (CVar "a"))))) (CVar "ma")))]),CoreDecl "$dictApplicative_Api" (CRecord [("$superFunctor",CVar "$dictFunctor_Api"),("pure",CVar "prim_apiPure"),("apply",CLam [PVar "mf",PVar "ma"] (CApp (CApp (CVar "prim_apiAndThen") (CLam [PVar "f"] (CApp (CApp (CVar "prim_apiAndThen") (CLam [PVar "a"] (CApp (CVar "prim_apiPure") (CApp (CVar "f") (CVar "a"))))) (CVar "ma")))) (CVar "mf")))]),CoreDecl "$dictMonad_Api" (CRecord [("$superApplicative",CVar "$dictApplicative_Api"),("andThen",CLam [PVar "ma",PVar "k"] (CApp (CApp (CVar "prim_apiAndThen") (CVar "k")) (CVar "ma"))),("then",CLam [PVar "ma",PVar "mb"] (CApp (CApp (CVar "prim_apiAndThen") (CLam [PWildcard] (CVar "mb"))) (CVar "ma")))]),CoreDecl "Lune.Prelude.unit" (CVar "Lune.Prelude.Unit"),CoreDecl "Lune.IO.println" (CVar "prim_putStrLn"),CoreDecl "Lune.IO.readLine" (CVar "prim_readLine"),CoreDecl "Lune.IO.readInt" (CVar "prim_readInt"),CoreDecl "Lune.IO.sleepMs" (CVar "prim_sleepMs"),CoreDecl "Lune.IO.readFile" (CVar "prim_readFile"),CoreDecl "Lune.IO.writeFile" (CVar "prim_writeFile"),CoreDecl "Lune.Atomic.commit" (CVar "prim_atomically"),CoreDecl "Lune.Atomic.new" (CVar "prim_newTVar"),CoreDecl "Lune.Atomic.read" (CVar "prim_readTVar"),CoreDecl "Lune.Atomic.write" (CVar "prim_writeTVar"),CoreDecl "Lune.Atomic.wait" (CVar "prim_retry"),CoreDecl "Lune.Atomic.orElse" (CVar "prim_orElse"),CoreDecl "Lune.Task.start" (CVar "prim_spawn"),CoreDecl "Lune.Task.await" (CVar "prim_await"),CoreDecl "Lune.Task.yield" (CVar "prim_yield"),CoreDecl "Lune.String.append" (CVar "prim_appendString"),CoreDecl "Lune.String.eq" (CVar "prim_eqString"),CoreDecl "Lune.String.fromInt" (CVar "prim_showInt"),CoreDecl "Lune.String.toInt" (CVar "prim_parseInt"),CoreDecl "Lune.Int.add" (CVar "prim_addInt"),CoreDecl "Lune.Int.sub" (CVar "prim_subInt"),CoreDecl "Lune.Int.mul" (CVar "prim_mulInt"),CoreDecl "Lune.Int.eq" (CVar "prim_eqInt"),CoreDecl "Lune.Int.gte" (CVar "prim_geInt"),CoreDecl "Lune.Int.lte" (CVar "prim_leInt"),CoreDecl "STMExample.main" (CApp (CApp (CSelect (CVar "$dictMonad_IO") "andThen") (CApp (CVar "Lune.Atomic.commit") (CApp (CVar "Lune.Atomic.new") (CInt 0)))) (CLam [PVar "tv"] (CApp (CApp (CSelect (CVar "$dictMonad_IO") "andThen") (CApp (CVar "Lune.Task.start") (CApp (CApp (CVar "STMExample.incrementN") (CVar "tv")) (CInt 5)))) (CLam [PVar "t1"] (CApp (CApp (CSelect (CVar "$dictMonad_IO") "andThen") (CApp (CVar "Lune.Task.start") (CApp (CApp (CVar "STMExample.incrementN") (CVar "tv")) (CInt 5)))) (CLam [PVar "t2"] (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CVar "Lune.Task.yield")) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CVar "Lune.Task.yield")) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.Task.await") (CVar "t1"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.Task.await") (CVar "t2"))) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "andThen") (CApp (CVar "Lune.Atomic.commit") (CApp (CVar "Lune.Atomic.read") (CVar "tv")))) (CLam [PVar "n"] (CApp (CVar "Lune.IO.println") (CApp (CApp (CVar "Lune.String.append") (CString "counter=")) (CApp (CVar "Lune.String.fromInt") (CVar "n")))))))))))))))),CoreDecl "STMExample.incrementN" (CLam [PVar "tv",PVar "count"] (CApp (CApp (CVar "STMExample.incrementLoop") (CVar "tv")) (CVar "count"))),CoreDecl "STMExample.incrementLoop" (CLam [PVar "tv",PVar "remaining"] (CCase (CApp (CApp (CVar "Lune.Int.lte") (CVar "remaining")) (CInt 0)) [CoreAlt (PCon "Lune.Prelude.True" []) (CApp (CVar "Lune.IO.println") (CString "Worker done")),CoreAlt (PCon "Lune.Prelude.False" []) (CApp (CApp (CSelect (CVar "$dictMonad_IO") "then") (CApp (CVar "Lune.Atomic.commit") (CApp (CApp (CSelect (CVar "$dictMonad_STM") "andThen") (CApp (CVar "Lune.Atomic.read") (CVar "tv"))) (CLam [PVar "n"] (CApp (CApp (CVar "Lune.Atomic.write") (CVar "tv")) (CApp (CApp (CVar "Lune.Int.add") (CVar "n")) (CInt 1))))))) (CApp (CApp (CVar "STMExample.incrementLoop") (CVar "tv")) (CApp (CApp (CVar "Lune.Int.sub") (CVar "remaining")) (CInt 1))))]))]}
